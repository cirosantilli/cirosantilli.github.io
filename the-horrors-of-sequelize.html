<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>The horrors of Sequelize - Ciro Santilli</title>
<meta property="og:title" content="The horrors of Sequelize - Ciro Santilli">
<meta property="og:type" content="website">
<meta property="og:image" content="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_square_398.jpg">
<meta property="og:url" content="https://cirosantilli.com/the-horrors-of-sequelize">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.1/css/all.min.css" integrity="sha512-9my9Mb2+0YO+I4PUCSwUYO7sEK21Y0STBAiFEYoWtd2VzLEZZ4QARDrZ30hdM1GlioHJ8o8cWQiy8IAb1hy/Hg==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="canonical" href="https://ourbigbook.com/cirosantilli/the-horrors-of-sequelize">
<style>@import "_obb/dist/ourbigbook.css";

</style>
<link rel="stylesheet" type="text/css" href="_raw/main.css">
<link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_square_398.jpg">
</head>
<body>
<header>
<div class="brand-group">
<a href="." class="brand"><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_right_eye_200_100.jpg" loading="lazy" alt="ID photo of Ciro Santilli taken in 2013 right eye">Ciro Santilli</a>
<a href="https://ourbigbook.com/cirosantilli"><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ourbigbook-logo-v1.svg" loading="lazy" alt="OurBigBook logo">OurBigBook.com</a>
<a class="font-awesome-container" href="https://stackoverflow.com/users/895245"><i class="fab fa-stack-overflow fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://github.com/cirosantilli"><i class="fab fa-github fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.linkedin.com/in/cirosantilli"><i class="fab fa-linkedin fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.youtube.com/c/CiroSantilli"><i class="fab fa-youtube fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://twitter.com/cirosantilli"><i class="fab fa-twitter fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.zhihu.com/people/cirosantilli/activities"><i class="fab fa-zhihu fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.weibo.com/p/1005055601627311"><i class="fab fa-weibo fa-fw icon"></i></a>
<a href="sponsor"><span class="icon">$£</span>&nbsp;Sponsor</a>
<a href="https://github.com/cirosantilli/china-dictatorship"><span class="icon">中国</span>独裁统治&nbsp;China Dictatorship 新疆改造中心、六四事件、法轮功、郝海东、709大抓捕、2015巴拿马文件 邓家贵、低端人口、西藏骚乱</a>
</div>
</header>
<main class="ourbigbook">
<div class="h top" id="the-horrors-of-sequelize"><div class="notnav"><h1><a href="">The horrors of Sequelize</a></h1></div><nav class="h-nav h-nav-toplevel"><div class="nav ancestors"><a  href="#_ancestors">&nbsp;...</a><a href="programming-language#list-of-programming-languages"> List of programming languages</a><a href="programming-language#javascript"> JavaScript</a><a href="node-js"> Node.js</a><a href="node-js#node-js-library"> Node.js library</a><a href="node-js#node-js-orm-library"> Node.js ORM library</a><a href="sequelize"> Sequelize</a></div><div class="nav"><a href="https://ourbigbook.com/cirosantilli/the-horrors-of-sequelize"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><a class="nosplit" href="sequelize#the-horrors-of-sequelize"></a><span class="metrics"><span class="wcntr"> Words: 362</span></span></div></nav></div><div class="list"><ul id="_17"><li id="_18">foreign keys are capitalized:<div class="list"><ul id="_19"><li id="_20"><a href="https://stackoverflow.com/questions/55273091/why-use-the-uppercase-key-when-creating-association-model-in-sequelize">stackoverflow.com/questions/55273091/why-use-the-uppercase-key-when-creating-association-model-in-sequelize</a></li><li id="_21"><a href="https://github.com/sequelize/sequelize/issues/5828">github.com/sequelize/sequelize/issues/5828</a></li></ul></div></li><li id="_22">you must give <code>foreignKey</code> when using aliases, otherwise it fails subtely. That would be derived automatically.</li><li id="_23"><a href="https://stackoverflow.com/questions/41502699/return-flat-object-from-sequelize-with-association">stackoverflow.com/questions/41502699/return-flat-object-from-sequelize-with-association</a> can't auto-flatten to reuse the database's <code>ORDER</code></li><li id="_24"><code>limit</code> and <code>offset</code> don't work without <code>subQuery: false</code> when doing includes! It is just too buggy. Examples of this can be found e.g. under <a href="_raw/nodejs/sequelize/many_to_many_same_model.js">nodejs/sequelize/many_to_many_same_model.js</a>.</li><li id="_25"><a href="https://stackoverflow.com/questions/34059081/how-do-i-reference-an-association-when-creating-a-row-in-sequelize-without-assum">stackoverflow.com/questions/34059081/how-do-i-reference-an-association-when-creating-a-row-in-sequelize-without-assum</a> hard to not duplicate foreign keys values everywhere</li><li id="_26">stack traces permanently broken or requiring non-obvious configs:<div class="list"><ul id="_27"><li id="_28"><a href="https://github.com/sequelize/sequelize/issues/8199#issuecomment-863943835">github.com/sequelize/sequelize/issues/8199#issuecomment-863943835</a></li><li id="_29"><a href="https://github.com/sequelize/sequelize/issues/12044">github.com/sequelize/sequelize/issues/12044</a></li><li id="_30"><a href="https://stackoverflow.com/questions/28231970/bluebird-shows-broken-stacktrace-when-using-with-sequelize-mysql">stackoverflow.com/questions/28231970/bluebird-shows-broken-stacktrace-when-using-with-sequelize-mysql</a></li></ul></div></li><li id="_31">does not automatically update fields on hooks: <a href="https://github.com/sequelize/sequelize/issues/8586#issuecomment-422877555">github.com/sequelize/sequelize/issues/8586#issuecomment-422877555</a></li><li id="_32">cannot change columns when other columns have constraints due to the backup table?<div class="list"><ul id="_33"><li id="_34"><a href="https://stackoverflow.com/questions/64533732/process-of-changing-a-table-with-sequelize-migration-if-foreign-key-constraint-i">stackoverflow.com/questions/64533732/process-of-changing-a-table-with-sequelize-migration-if-foreign-key-constraint-i</a></li></ul></div></li><li id="_35">you have to use <code>.get()</code> for <code>attribute</code> aliased fields, why? <a href="https://stackoverflow.com/questions/32649218/how-do-i-select-a-column-using-an-alias/69890944#69890944">stackoverflow.com/questions/32649218/how-do-i-select-a-column-using-an-alias/69890944#69890944</a></li><li id="_36"><code>.id</code> gets added to <code>SELECT</code> no matter what, breaking <code>GROUP BY</code> unless you do horrible workarounds:<div class="list"><ul id="_37"><li id="_38"><a href="https://github.com/sequelize/sequelize/issues/3256">github.com/sequelize/sequelize/issues/3256</a></li><li id="_39"><a href="https://github.com/sequelize/sequelize/issues/5481">github.com/sequelize/sequelize/issues/5481</a></li></ul></div></li><li id="_40">no simple built-in mechanism for transaction retries: <a href="sequelize#sequelize-transaction-retry">Sequelize transaction retries</a></li><li id="_41">impossible to do subqueries in general. Docs just tell you to use literals. This in particular prevents single query deletes with join as done at <a href="_raw/nodejs/sequelize/raw/many_to_many.js">nodejs/sequelize/raw/many_to_many.js</a>:<div class="list"><ul id="_42"><li id="_43"><a href="https://sequelize.org/master/manual/sub-queries.html">sequelize.org/master/manual/sub-queries.html</a>: the docs actually just tell you to use literals, lol</li><li id="_44"><a href="https://stackoverflow.com/questions/45354001/nodejs-sequelize-delete-with-nested-select-query">stackoverflow.com/questions/45354001/nodejs-sequelize-delete-with-nested-select-query</a></li></ul></div>Also, you can't get query strings either: <a href="https://github.com/sequelize/sequelize/issues/2325">github.com/sequelize/sequelize/issues/2325</a></li><li id="_45">migrations. Generally speaking, anything but the simplest migrations are exceedingly hard to get right, as you have to go very low level when doing migrations. Syntax can be very different from regular DB operations.<div class="list"><ul id="_46"><li id="_47"><div class="p" id="_48">no way to do (non-raw) queries during migrations, e.g. to update fields based on other fields in a complex way?<div class="list"><ul id="_49"><li id="_50"><a href="https://github.com/sequelize/cli/issues/862">github.com/sequelize/cli/issues/862</a></li><li id="_51"><a href="https://stackoverflow.com/questions/18742962/add-data-in-sequelize-migration-script">stackoverflow.com/questions/18742962/add-data-in-sequelize-migration-script</a></li><li id="_52"><a href="https://stackoverflow.com/questions/38671483/sequelize-migration-update-model-after-updating-column-attributes">stackoverflow.com/questions/38671483/sequelize-migration-update-model-after-updating-column-attributes</a></li><li id="_53"><a href="https://stackoverflow.com/questions/38998397/can-i-use-sequelize-models-in-migration-scripts">stackoverflow.com/questions/38998397/can-i-use-sequelize-models-in-migration-scripts</a></li><li id="_54"><a href="https://stackoverflow.com/questions/45286429/custom-query-on-sequelize-seeder">stackoverflow.com/questions/45286429/custom-query-on-sequelize-seeder</a></li></ul></div><code>queryInterface.sequelize.models</code> contains only <code>SequelizeMeta</code>. Not sure why they have this limitation.</div><div class="p" id="_55">Edit: actually things will likely just work if immediately after making table changes you just instantiate a new sequelize and do any data changes.</div></li><li id="_56"><a href="https://stackoverflow.com/questions/56043246/node-js-sequelize-no-primary-keys-when-migrating/56046101#56046101">stackoverflow.com/questions/56043246/node-js-sequelize-no-primary-keys-when-migrating/56046101#56046101</a></li><li id="_57"><a href="sql#sqlite">SQLite</a> <code>changeColumn</code> migrations do on delete cascades of other tables. SQLite does not have change column statements, so they have to drop and recreate tables, but they don't temporarily remove cascades, so you lose data: <a href="https://stackoverflow.com/questions/62667269/sequelize-js-how-do-we-change-column-type-in-migration/70486686#70486686">stackoverflow.com/questions/62667269/sequelize-js-how-do-we-change-column-type-in-migration/70486686#70486686</a></li><li id="_58">associations require full explicit index construction: <a href="https://stackoverflow.com/questions/39651853/how-to-create-join-table-with-foreign-keys-with-sequelize-or-sequelize-cli">stackoverflow.com/questions/39651853/how-to-create-join-table-with-foreign-keys-with-sequelize-or-sequelize-cli</a></li></ul></div></li><li id="_59">ability to iterate over a large result without blowing up memory and without using limit + offset (which is inneficient e.g. when looping over recursive queries). This is also known as cursor or streaming interfaces:<div class="list"><ul id="_60"><li id="_61">stack overflow<div class="list"><ul id="_62"><li id="_63"><a href="https://stackoverflow.com/questions/28787889/how-can-i-set-up-sequelize-js-to-stream-data-instead-of-a-promise-callback">stackoverflow.com/questions/28787889/how-can-i-set-up-sequelize-js-to-stream-data-instead-of-a-promise-callback</a></li><li id="_64"><a href="https://stackoverflow.com/questions/43964067/how-to-implement-cursor-pagination-using-sequelize">stackoverflow.com/questions/43964067/how-to-implement-cursor-pagination-using-sequelize</a></li><li id="_65"><a href="https://stackoverflow.com/questions/57164242/perform-sequelize-findall-in-a-huge-array">stackoverflow.com/questions/57164242/perform-sequelize-findall-in-a-huge-array</a></li><li id="_66"><a href="https://stackoverflow.com/questions/55191891/how-to-loop-through-result-in-sequelize">stackoverflow.com/questions/55191891/how-to-loop-through-result-in-sequelize</a> generic loop</li></ul></div></li><li id="_67">issue tracker<div class="list"><ul id="_68"><li id="_69"><a href="https://github.com/sequelize/sequelize/issues/15827">github.com/sequelize/sequelize/issues/15827</a></li><li id="_70"><a href="https://github.com/sequelize/sequelize/issues/10347">github.com/sequelize/sequelize/issues/10347</a></li><li id="_71"><a href="https://github.com/sequelize/sequelize/issues/4286">github.com/sequelize/sequelize/issues/4286</a></li><li id="_72"><a href="https://github.com/sequelize/sequelize/issues/2454">github.com/sequelize/sequelize/issues/2454</a></li></ul></div></li></ul></div>E.g. the <a href="programming-language#python-programming-language">Python</a> <a href="sql#sqlite">SQLite</a> interface supports this just fine: <a href="https://stackoverflow.com/questions/29582736/python3-is-there-a-way-to-iterate-row-by-row-over-a-very-large-sqlite-table-wi">stackoverflow.com/questions/29582736/python3-is-there-a-way-to-iterate-row-by-row-over-a-very-large-sqlite-table-wi</a></li><li id="_73">empty <code>attributes: []</code> breaks some nested queries: <a href="https://github.com/sequelize/sequelize/issues/16436">github.com/sequelize/sequelize/issues/16436</a></li><li id="_74">does not expose a iteration API that supports large arrays?<div class="list"><ul id="_75"><li id="_76"><a href="https://github.com/sequelize/sequelize/issues/8550">github.com/sequelize/sequelize/issues/8550</a></li><li id="_77"><a href="https://stackoverflow.com/questions/57164242/perform-sequelize-findall-in-a-huge-array">stackoverflow.com/questions/57164242/perform-sequelize-findall-in-a-huge-array</a></li></ul></div>E.g. <a href="programming-language#python-programming-language">Python</a> <a href="sql#sqlite">SQLite</a> does: <a href="https://stackoverflow.com/questions/29582736/python3-is-there-a-way-to-iterate-row-by-row-over-a-very-large-sqlite-table-wi">stackoverflow.com/questions/29582736/python3-is-there-a-way-to-iterate-row-by-row-over-a-very-large-sqlite-table-wi</a></li></ul></div><h2 id="_ancestors"><a href="#_ancestors"><span class="fa-solid-900 icon"></span> Ancestors <span class="meta">(13)</span></a></h2><div class="list"><ol><li><a href="sequelize">Sequelize</a></li><li><a href="node-js#node-js-orm-library">Node.js ORM library</a></li><li><a href="node-js#node-js-library">Node.js library</a></li><li><a href="node-js">Node.js</a></li><li><a href="programming-language#javascript">JavaScript</a></li><li><a href="programming-language#list-of-programming-languages">List of programming languages</a></li><li><a href="programming-language">Programming language</a></li><li><a href="software">Software</a></li><li><a href="computer">Computer</a></li><li><a href="technology#information-technology">Information technology</a></li><li><a href="technology#area-of-technology">Area of technology</a></li><li><a href="technology">Technology</a></li><li><a href="."><span title="Home" class="fa-solid-900 icon"></span> Home</a></li></ol></div><h2 id="_incoming-links"><a href="#_incoming-links"><span title="Incoming links" class="fa-solid-900 icon"></span> Incoming links <span class="meta">(1)</span></a></h2><div class="list"><ul><li><a href="sequelize">Sequelize</a></li></ul></div>
</main>
<footer>
<div>Powered by <a href="https://docs.ourbigbook.com">OurBigBook</a></div>
<div>License: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> unless noted</div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io/issues">Suggestions and corrections</a></div>
<div><a href="contact">Contact Ciro Santilli</a></div>
<div><a href="_dir">Website source code</a></div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io">Website source code on GitHub</a></div>
<div><a href="_file/sequelize.bigb">Source code for this page: sequelize.bigb</a></div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io/blob/f7dac29d5224c15015eee520ccee15a3adb07b98/sequelize.bigb">Source code for this page on GitHub</a></div>
<div>Cite with: <a href="https://zenodo.org/badge/latestdoi/16453261">this DOI</a></div>
<div><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_left_eye_200_100.jpg" loading="lazy" alt="ID photo of Ciro Santilli taken in 2013 right eye"></div>
</footer>
<script>
window.ourbigbook_split_headers = true;
window.ourbigbook_html_x_extension = false;
window.ourbigbook_redirect_prefix = "";
</script>
<script src="_obb/dist/ourbigbook_runtime.js"></script><script>ourbigbook_runtime.ourbigbook_runtime()</script><script src="_raw/main.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-47867706-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DEE2HEJW9X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DEE2HEJW9X');
</script>
<script src="https://giscus.app/client.js"
        data-repo="cirosantilli/cirosantilli.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNjQ1MzI2MQ=="
        data-category="giscus"
        data-category-id="DIC_kwDOAPsOjc4CZ6zZ"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark_high_contrast"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</body>
</html>
