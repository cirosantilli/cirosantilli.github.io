<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>x86 Paging Tutorial / Single level paging scheme numerical translation example - Ciro Santilli</title>
<meta property="og:title" content="x86 Paging Tutorial / Single level paging scheme numerical translation example - Ciro Santilli">
<meta property="og:type" content="website">
<meta property="og:image" content="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_square_398.jpg">
<meta property="og:url" content="https://cirosantilli.com/x86-paging/single-level-paging-scheme-numerical-translation-example">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.1/css/all.min.css" integrity="sha512-9my9Mb2+0YO+I4PUCSwUYO7sEK21Y0STBAiFEYoWtd2VzLEZZ4QARDrZ30hdM1GlioHJ8o8cWQiy8IAb1hy/Hg==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="canonical" href="https://ourbigbook.com/cirosantilli/x86-paging/single-level-paging-scheme-numerical-translation-example">
<style>@import "../_obb/dist/ourbigbook.css";

</style>
<link rel="stylesheet" type="text/css" href="../_raw/main.css">
<link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_square_398.jpg">
</head>
<body>
<header>
<div class="brand-group">
<a href="../" class="brand"><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_right_eye_200_100.jpg" loading="lazy" alt="ID photo of Ciro Santilli taken in 2013 right eye">Ciro Santilli</a>
<a href="https://ourbigbook.com/cirosantilli"><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ourbigbook-logo-v1.svg" loading="lazy" alt="OurBigBook logo">OurBigBook.com</a>
<a class="font-awesome-container" href="https://stackoverflow.com/users/895245"><i class="fab fa-stack-overflow fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://github.com/cirosantilli"><i class="fab fa-github fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.linkedin.com/in/cirosantilli"><i class="fab fa-linkedin fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.youtube.com/c/CiroSantilli"><i class="fab fa-youtube fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://twitter.com/cirosantilli"><i class="fab fa-twitter fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.zhihu.com/people/cirosantilli/activities"><i class="fab fa-zhihu fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.weibo.com/p/1005055601627311"><i class="fab fa-weibo fa-fw icon"></i></a>
<a href="../sponsor"><span class="icon">$£</span>&nbsp;Sponsor</a>
<a href="https://github.com/cirosantilli/china-dictatorship"><span class="icon">中国</span>独裁统治&nbsp;China Dictatorship 新疆改造中心、六四事件、法轮功、郝海东、709大抓捕、2015巴拿马文件 邓家贵、低端人口、西藏骚乱</a>
</div>
</header>
<main class="ourbigbook">
<div class="h top" id="single-level-paging-scheme-numerical-translation-example"><div class="notnav"><h1><a href="../x86-paging">x86 Paging Tutorial</a><span class="meta"> / </span><a href="">Single level paging scheme numerical translation example</a></h1></div><nav class="h-nav h-nav-toplevel"><div class="nav ancestors"><a  href="#_ancestors">&nbsp;...</a><a href="../computer-hardware#processor-computing"> Processor (computing)</a><a href="../computer-hardware#instruction-set-architecture"> Instruction set architecture</a><a href="../computer-hardware#list-of-instruction-set-architectures"> List of instruction set architectures</a><a href="../computer-hardware#x86"> x86</a><a href="../x86-paging"> x86 Paging Tutorial</a><a href="../x86-paging#example-simplified-single-level-paging-scheme"> Example: simplified single-level paging scheme</a></div><div class="nav"><a href="https://ourbigbook.com/cirosantilli/x86-paging/single-level-paging-scheme-numerical-translation-example"><img src="../_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><a class="nosplit" href="../x86-paging#single-level-paging-scheme-numerical-translation-example"></a><span class="metrics"><span class="wcntr"> Words: 563</span></span></div></nav></div><div class="p" id="_93">Suppose that the OS has setup the following page tables for process 1:<div class="code" id="_94"><div><pre><code>entry index   entry address       page address   present
-----------   ------------------  ------------   -------
0             CR3_1 + 0      * 4  0x00001        1
1             CR3_1 + 1      * 4  0x00000        1
2             CR3_1 + 2      * 4  0x00003        1
3             CR3_1 + 3      * 4                 0
...
2^20-1        CR3_1 + 2^20-1 * 4  0x00005        1</code></pre></div></div>and for process 2:<div class="code" id="_95"><div><pre><code>entry index   entry address       page address   present
-----------   -----------------   ------------   -------
0             CR3_2 + 0      * 4  0x0000A        1
1             CR3_2 + 1      * 4  0x12345        1
2             CR3_2 + 2      * 4                 0
3             CR3_2 + 3      * 4  0x00003        1
...
2^20-1        CR3_2 + 2^20-1 * 4  0xFFFFF        1</code></pre></div></div></div><div class="p" id="_96">Before process 1 starts running, the OS sets its <code>cr3</code> to point to the page table 1 at <code>CR3_1</code>.</div><div class="p" id="_97">When process 1 tries to access a linear address, this is the physical addresses that will be actually accessed:<div class="code" id="_98"><div><pre><code>linear     physical
---------  ---------
00000 001  00001 001
00000 002  00001 002
00000 003  00001 003
00000 FFF  00001 FFF
00001 000  00000 000
00001 001  00000 001
00001 FFF  00000 FFF
00002 000  00003 000
FFFFF 000  00005 000</code></pre></div></div></div><div class="p" id="_99">To switch to process 2, the OS simply sets <code>cr3</code> to <code>CR3_2</code>, and now the following translations would happen:<div class="code" id="_100"><div><pre><code>linear     physical
---------  ---------
00000 002  0000A 002
00000 003  0000A 003
00000 FFF  0000A FFF
00001 000  12345 000
00001 001  12345 001
00001 FFF  12345 FFF
00004 000  00003 000
FFFFF 000  FFFFF 000</code></pre></div></div></div><div class="p" id="_101">Step-by-step translation for process 1 of logical address <code>0x00000001</code> to physical address <code>0x00001001</code>:<div class="list"><ul id="_102"><li id="_103"><div class="p" id="_104">split the linear address into two parts:</div><div class="code" id="_105"><div><pre><code>| page (20 bits) | offset (12 bits) |</code></pre></div></div><div class="p" id="_106">So in this case we would have:<br>*page = 0x00000. This part must be translated to a physical location.<br>*offset = 0x001. This part is added directly to the page address, and is not translated: it contains the position within the page.</div></li><li id="_107">look into Page table 1 because <code>cr3</code> points to it.</li><li id="_108">The hardware knows that this entry is located at RAM address <code>CR3 + 0x00000 * 4 = CR3</code>:<br>*<code>0x00000</code> because the page part of the logical address is <code>0x00000</code><br>*<code>4</code> because that is the fixed size in bytes of every page table entry</li><li id="_109">since it is present, the access is valid</li><li id="_110">by the page table, the location of page number <code>0x00000</code> is at <code>0x00001 * 4K = 0x00001000</code>.</li><li id="_111"><div class="p" id="_112">to find the final physical address we just need to add the offset:</div><div class="code" id="_113"><div><pre><code>  00001 000
+ 00000 001
  ---------
  00001 001</code></pre></div></div><div class="p" id="_114">because <code>00001</code> is the physical address of the page looked up on the table and <code>001</code> is the offset.</div><div class="p" id="_115">We shift <code>00001</code> by 12 bits because the pages are always aligned to 4 KiB.</div><div class="p" id="_116">The offset is always simply added the physical address of the page.</div></li><li id="_117">the hardware then gets the memory at that physical location and puts it in a register.</li></ul></div></div><div class="p" id="_118">Another example: for logical address <code>0x00001001</code>:<div class="list"><ul id="_119"><li id="_120">the page part is <code>00001</code>, and the offset part is <code>001</code></li><li id="_121">the hardware knows that its page table entry is located at RAM address: <code>CR3 + 1 * 4</code> (<code>1</code> because of the page part), and that is where it will look for it</li><li id="_122">it finds the page address <code>0x00000</code> there</li><li id="_123">so the final address is <code>0x00000 * 4k + 0x001 = 0x00000001</code></li></ul></div></div><h2 id="_ancestors"><a href="#_ancestors"><span class="fa-solid-900 icon"></span> Ancestors <span class="meta">(13)</span></a></h2><div class="list"><ol><li><a href="../x86-paging#example-simplified-single-level-paging-scheme">Example: simplified single-level paging scheme</a></li><li><a href="../x86-paging">x86 Paging Tutorial</a></li><li><a href="../computer-hardware#x86">x86</a></li><li><a href="../computer-hardware#list-of-instruction-set-architectures">List of instruction set architectures</a></li><li><a href="../computer-hardware#instruction-set-architecture">Instruction set architecture</a></li><li><a href="../computer-hardware#processor-computing">Processor (computing)</a></li><li><a href="../computer-hardware#computer-hardware-component-type">Computer hardware component type</a></li><li><a href="../computer-hardware">Computer hardware</a></li><li><a href="../computer">Computer</a></li><li><a href="../technology#information-technology">Information technology</a></li><li><a href="../technology#area-of-technology">Area of technology</a></li><li><a href="../technology">Technology</a></li><li><a href=".."><span title="Home" class="fa-solid-900 icon"></span> Home</a></li></ol></div>
</main>
<footer>
<div>Powered by <a href="https://docs.ourbigbook.com">OurBigBook</a></div>
<div>License: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> unless noted</div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io/issues">Suggestions and corrections</a></div>
<div><a href="../contact">Contact Ciro Santilli</a></div>
<div><a href="../_dir">Website source code</a></div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io">Website source code on GitHub</a></div>
<div><a href="../_file/x86-paging.bigb">Source code for this page: x86-paging.bigb</a></div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io/blob/f7dac29d5224c15015eee520ccee15a3adb07b98/x86-paging.bigb">Source code for this page on GitHub</a></div>
<div>Cite with: <a href="https://zenodo.org/badge/latestdoi/16453261">this DOI</a></div>
<div><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_left_eye_200_100.jpg" loading="lazy" alt="ID photo of Ciro Santilli taken in 2013 right eye"></div>
</footer>
<script>
window.ourbigbook_split_headers = true;
window.ourbigbook_html_x_extension = false;
window.ourbigbook_redirect_prefix = "x86-paging/";
</script>
<script src="../_obb/dist/ourbigbook_runtime.js"></script><script>ourbigbook_runtime.ourbigbook_runtime()</script><script src="../_raw/main.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-47867706-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DEE2HEJW9X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DEE2HEJW9X');
</script>
<script src="https://giscus.app/client.js"
        data-repo="cirosantilli/cirosantilli.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNjQ1MzI2MQ=="
        data-category="giscus"
        data-category-id="DIC_kwDOAPsOjc4CZ6zZ"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark_high_contrast"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</body>
</html>
