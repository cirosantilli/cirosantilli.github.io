<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>SQL - Ciro Santilli</title>
<meta property="og:title" content="SQL - Ciro Santilli">
<meta property="og:type" content="website">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/SQLite370.svg/640px-SQLite370.svg.png">
<meta property="og:url" content="https://cirosantilli.com/sql">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.1/css/all.min.css" integrity="sha512-9my9Mb2+0YO+I4PUCSwUYO7sEK21Y0STBAiFEYoWtd2VzLEZZ4QARDrZ30hdM1GlioHJ8o8cWQiy8IAb1hy/Hg==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="canonical" href="https://ourbigbook.com/cirosantilli/sql">
<style>@import "_obb/dist/ourbigbook.css";

</style>
<link rel="stylesheet" type="text/css" href="_raw/main.css">
<link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_square_398.jpg">
</head>
<body>
<header>
<div class="brand-group">
<a href="." class="brand"><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_right_eye_200_100.jpg" loading="lazy" alt="ID photo of Ciro Santilli taken in 2013 right eye">Ciro Santilli</a>
<a href="https://ourbigbook.com/cirosantilli"><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ourbigbook-logo-v1.svg" loading="lazy" alt="OurBigBook logo">OurBigBook.com</a>
<a class="font-awesome-container" href="https://stackoverflow.com/users/895245"><i class="fab fa-stack-overflow fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://github.com/cirosantilli"><i class="fab fa-github fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.linkedin.com/in/cirosantilli"><i class="fab fa-linkedin fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.youtube.com/c/CiroSantilli"><i class="fab fa-youtube fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://twitter.com/cirosantilli"><i class="fab fa-twitter fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.zhihu.com/people/cirosantilli/activities"><i class="fab fa-zhihu fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.weibo.com/p/1005055601627311"><i class="fab fa-weibo fa-fw icon"></i></a>
<a href="sponsor"><span class="icon">$¬£</span>&nbsp;Sponsor</a>
<a href="https://github.com/cirosantilli/china-dictatorship"><span class="icon">‰∏≠ÂõΩ</span>Áã¨Ë£ÅÁªüÊ≤ª&nbsp;China Dictatorship Êñ∞ÁñÜÊîπÈÄ†‰∏≠ÂøÉ„ÄÅÂÖ≠Âõõ‰∫ã‰ª∂„ÄÅÊ≥ïËΩÆÂäü„ÄÅÈÉùÊµ∑‰∏ú„ÄÅ709Â§ßÊäìÊçï„ÄÅ2015Â∑¥ÊãøÈ©¨Êñá‰ª∂ ÈÇìÂÆ∂Ë¥µ„ÄÅ‰ΩéÁ´Ø‰∫∫Âè£„ÄÅË•øËóèÈ™ö‰π±</a>
</div>
</header>
<main class="ourbigbook">
<div class="h top" id="sql"><div class="notnav"><h1><a href="sql-split">SQL</a></h1></div><nav class="h-nav h-nav-toplevel"><div class="nav ancestors"><a  href="#_ancestors">&nbsp;...</a><a href="computer"> Computer</a><a href="software"> Software</a><a href="software#database"> Database</a><a href="software#type-of-database"> Type of database</a><a href="software#relational-database"> Relational database</a><a href="software#relational-database-management-system"> Relational database management system</a></div><div class="nav"><a href="#_toc" class="toc"></a><a href="https://en.wikipedia.org/wiki/SQL" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><a class="split" href="sql-split"></a><span class="metrics"><span class="wcntr"> Words: 7k</span><span class="dcnt"> Articles: 102</span></span></div></nav></div><div class="toc-container" id="_toc"><ul><li class="has-child toplevel"><div class="title-div"><div class="arrow"><div></div></div><span class="not-arrow"><a class="title toc" href="#_toc"> Table of contents</a><input class="search" placeholder="üîç Search. Shortcut: / (slash)"><span class="hover-metadata"><span class="metrics"><span class="wcntr"> 7k</span><span class="dcnt"> 102</span></span></span></span></div><ul><li><div id="_toc/sql-example"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-example">SQL example</a><span class="hover-metadata"><a href="#_toc" class="u"> SQL</a><span class="metrics"><span class="wcntr"> 483</span></span></span></span></div></li><li class="has-child"><div id="_toc/sql-implementation"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-implementation">SQL implementation</a><span class="hover-metadata"><a href="#_toc" class="u"> SQL</a><span class="metrics"><span class="wcntr"> 3k</span><span class="dcnt"> 31</span></span></span></span></div><ul><li><div id="_toc/ibm-db2"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#ibm-db2">IBM Db2</a><span class="hover-metadata"><a href="#_toc/sql-implementation" class="u"> SQL implementation</a></span></span></div></li><li class="has-child"><div id="_toc/mysql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#mysql">MySQL</a><span class="hover-metadata"><a href="#_toc/sql-implementation" class="u"> SQL implementation</a><span class="metrics"><span class="wcntr"> 183</span><span class="dcnt"> 3</span></span></span></span></div><ul><li class="has-child"><div id="_toc/mysqldump"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#mysqldump">mysqldump</a><span class="hover-metadata"><a href="#_toc/mysql" class="u"> MySQL</a><span class="metrics"><span class="wcntr"> 1</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/mysqldump-to-csv"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#mysqldump-to-csv">mysqldump to CSV</a><span class="hover-metadata"><a href="#_toc/mysqldump" class="u"> mysqldump</a><span class="metrics"><span class="wcntr"> 1</span></span></span></span></div></li></ul><li><div id="_toc/mariadb"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#mariadb">MariaDB</a><span class="hover-metadata"><a href="#_toc/mysql" class="u"> MySQL</a><span class="metrics"><span class="wcntr"> 19</span></span></span></span></div></li></ul><li class="has-child"><div id="_toc/postgresql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql">PostgreSQL</a><span class="hover-metadata"><a href="#_toc/sql-implementation" class="u"> SQL implementation</a><span class="metrics"><span class="wcntr"> 3k</span><span class="dcnt"> 12</span></span></span></span></div><ul><li class="has-child"><div id="_toc/postgresql-getting-started"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-getting-started">PostgreSQL getting started</a><span class="hover-metadata"><a href="#_toc/postgresql" class="u"> PostgreSQL</a><span class="metrics"><span class="wcntr"> 2k</span><span class="dcnt"> 4</span></span></span></span></div><ul><li class="has-child"><div id="_toc/postgresql-howto"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-howto">PostgreSQL HOWTO</a><span class="hover-metadata"><a href="#_toc/postgresql-getting-started" class="u"> PostgreSQL getting started</a><span class="metrics"><span class="wcntr"> 2k</span><span class="dcnt"> 3</span></span></span></span></div><ul><li class="has-child"><div id="_toc/postgresql-create-test-data"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-create-test-data">PostgreSQL create test data</a><span class="hover-metadata"><a href="#_toc/postgresql-howto" class="u"> PostgreSQL HOWTO</a><span class="metrics"><span class="wcntr"> 186</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/generate-random-text-in-postgresql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#generate-random-text-in-postgresql">Generate random text in PostgreSQL</a><span class="hover-metadata"><a href="#_toc/postgresql-create-test-data" class="u"> PostgreSQL create test data</a><span class="metrics"><span class="wcntr"> 186</span></span></span></span></div></li></ul><li><div id="_toc/postgresql-full-text-search"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-full-text-search">PostgreSQL full-text search</a><span class="hover-metadata"><a href="#_toc/postgresql-howto" class="u"> PostgreSQL HOWTO</a><span class="metrics"><span class="wcntr"> 2k</span></span></span></span></div></li></ul></li></ul><li><div id="_toc/create-a-test-user-in-postgresql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#create-a-test-user-in-postgresql">Create a test user in PostgreSQL</a><span class="hover-metadata"><a href="#_toc/postgresql" class="u"> PostgreSQL</a><span class="metrics"><span class="wcntr"> 252</span></span></span></span></div></li><li><div id="_toc/peer-authentication"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#peer-authentication">Peer authentication</a><span class="hover-metadata"><a href="#_toc/postgresql" class="u"> PostgreSQL</a><span class="metrics"><span class="wcntr"> 12</span></span></span></span></div></li><li><div id="_toc/postgresql-logging"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-logging">PostgreSQL logging</a><span class="hover-metadata"><a href="#_toc/postgresql" class="u"> PostgreSQL</a><span class="metrics"><span class="wcntr"> 44</span></span></span></span></div></li><li><div id="_toc/postgresql-serialization-failure"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-serialization-failure">PostgreSQL serialization failure</a><span class="hover-metadata"><a href="#_toc/postgresql" class="u"> PostgreSQL</a><span class="metrics"><span class="wcntr"> 46</span></span></span></span></div></li><li class="has-child"><div id="_toc/postgresql-function"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-function">PostgreSQL function</a><span class="hover-metadata"><a href="#_toc/postgresql" class="u"> PostgreSQL</a><span class="metrics"><span class="wcntr"> 25</span><span class="dcnt"> 2</span></span></span></span></div><ul><li><div id="_toc/postgresql-generate-series"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-generate-series">PostgreSQL <code>generate_series</code></a><span class="hover-metadata"><a href="#_toc/postgresql-function" class="u"> PostgreSQL function</a><span class="metrics"><span class="wcntr"> 25</span></span></span></span></div></li><li><div id="_toc/to-tsvector"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#to-tsvector"><code>to_tsvector</code></a><span class="hover-metadata"><a href="#_toc/postgresql-function" class="u"> PostgreSQL function</a></span></span></div></li></ul></li></ul><li class="has-child"><div id="_toc/microsoft-sql-server"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#microsoft-sql-server">Microsoft SQL Server</a><span class="hover-metadata"><a href="#_toc/sql-implementation" class="u"> SQL implementation</a><span class="metrics"><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/transact-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#transact-sql">Transact-SQL</a><span class="hover-metadata"><a href="#_toc/microsoft-sql-server" class="u"> Microsoft SQL Server</a></span></span></div></li></ul><li><div id="_toc/oracle-database"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#oracle-database">Oracle Database</a><span class="hover-metadata"><a href="#_toc/sql-implementation" class="u"> SQL implementation</a><span class="metrics"><span class="wcntr"> 36</span></span></span></span></div></li><li class="has-child"><div id="_toc/sqlite"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sqlite">SQLite</a><span class="hover-metadata"><a href="#_toc/sql-implementation" class="u"> SQL implementation</a><span class="metrics"><span class="wcntr"> 318</span><span class="dcnt"> 9</span></span></span></span></div><ul><li class="has-child"><div id="_toc/sqlite-import-csv"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sqlite-import-csv">SQLite import CSV</a><span class="hover-metadata"><a href="#_toc/sqlite" class="u"> SQLite</a><span class="metrics"><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/sqlite-import-csv-from-stdin"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sqlite-import-csv-from-stdin">SQLite import CSV from stdin</a><span class="hover-metadata"><a href="#_toc/sqlite-import-csv" class="u"> SQLite import CSV</a></span></span></div></li></ul><li><div id="_toc/sqlite-import-json"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sqlite-import-json">SQLite import JSON</a><span class="hover-metadata"><a href="#_toc/sqlite" class="u"> SQLite</a></span></span></div></li><li><div id="_toc/sqlite-benchmark"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sqlite-benchmark">SQLite benchmark</a><span class="hover-metadata"><a href="#_toc/sqlite" class="u"> SQLite</a><span class="metrics"><span class="wcntr"> 5</span></span></span></span></div></li><li><div id="_toc/sqlite-c-extension"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sqlite-c-extension">SQLite C extension</a><span class="hover-metadata"><a href="#_toc/sqlite" class="u"> SQLite</a><span class="metrics"><span class="wcntr"> 18</span></span></span></span></div></li><li><div id="_toc/sqlite-isolation-levels"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sqlite-isolation-levels">SQLite isolation levels</a><span class="hover-metadata"><a href="#_toc/sqlite" class="u"> SQLite</a><span class="metrics"><span class="wcntr"> 25</span></span></span></span></div></li><li class="has-child"><div id="_toc/node-js-sqlite-bindings"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#node-js-sqlite-bindings">Node.js SQLite bindings</a><span class="hover-metadata"><a href="#_toc/sqlite" class="u"> SQLite</a><span class="metrics"><span class="wcntr"> 160</span><span class="dcnt"> 2</span></span></span></span></div><ul><li><div id="_toc/sqlite3-node-js-package"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sqlite3-node-js-package"><code>sqlite3</code> Node.js package</a><span class="hover-metadata"><a href="#_toc/node-js-sqlite-bindings" class="u"> Node.js SQLite bindings</a><span class="metrics"><span class="wcntr"> 111</span></span></span></span></div></li><li><div id="_toc/better-sqlite3-node-js-package"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#better-sqlite3-node-js-package"><code>better-sqlite3</code> Node.js package</a><span class="hover-metadata"><a href="#_toc/node-js-sqlite-bindings" class="u"> Node.js SQLite bindings</a><span class="metrics"><span class="wcntr"> 49</span></span></span></span></div></li></ul></li></ul></li></ul><li class="has-child"><div id="_toc/sql-function"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-function">SQL function</a><span class="hover-metadata"><a href="#_toc" class="u"> SQL</a><span class="metrics"><span class="wcntr"> 10</span><span class="dcnt"> 4</span></span></span></span></div><ul><li class="has-child"><div id="_toc/sql-set-returning-function"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-set-returning-function">SQL set returning function</a><span class="hover-metadata"><a href="#_toc/sql-function" class="u"> SQL function</a><span class="metrics"><span class="wcntr"> 1</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/sql-genenerate-series"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-genenerate-series">SQL <code>genenerate_series</code></a><span class="hover-metadata"><a href="#_toc/sql-set-returning-function" class="u"> SQL set returning function</a></span></span></div></li></ul><li class="has-child"><div id="_toc/sql-aggregate-function"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-aggregate-function">SQL aggregate function</a><span class="hover-metadata"><a href="#_toc/sql-function" class="u"> SQL function</a><span class="metrics"><span class="wcntr"> 9</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/sql-count-function"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-count-function">SQL <code>COUNT</code> function</a><span class="hover-metadata"><a href="#_toc/sql-aggregate-function" class="u"> SQL aggregate function</a><span class="metrics"><span class="wcntr"> 9</span></span></span></span></div></li></ul></li></ul><li class="has-child"><div id="_toc/sql-keyword"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-keyword">SQL keyword</a><span class="hover-metadata"><a href="#_toc" class="u"> SQL</a><span class="metrics"><span class="wcntr"> 497</span><span class="dcnt"> 27</span></span></span></span></div><ul><li><div id="_toc/sql-cascade"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-cascade">SQL CASCADE</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a></span></span></div></li><li class="has-child"><div id="_toc/delete-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#delete-sql">DELETE (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="wcntr"> 13</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/delete-all-duplicate-rows-in-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#delete-all-duplicate-rows-in-sql">Delete all duplicate rows in SQL</a><span class="hover-metadata"><a href="#_toc/delete-sql" class="u"> DELETE</a><span class="metrics"><span class="wcntr"> 13</span></span></span></span></div></li></ul><li class="has-child"><div id="_toc/group-by-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#group-by-sql">GROUP BY (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="dcnt"> 2</span></span></span></span></div><ul><li class="has-child"><div id="_toc/having-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#having-sql">HAVING (SQL)</a><span class="hover-metadata"><a href="#_toc/group-by-sql" class="u"> GROUP BY</a><span class="metrics"><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/having-vs-where"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#having-vs-where">HAVING vs WHERE</a><span class="hover-metadata"><a href="#_toc/having-sql" class="u"> HAVING</a></span></span></div></li></ul></li></ul><li class="has-child"><div id="_toc/insert-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#insert-sql">INSERT (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="wcntr"> 68</span><span class="dcnt"> 2</span></span></span></span></div><ul><li class="has-child"><div id="_toc/upsert"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#upsert">Upsert</a><span class="hover-metadata"><a href="#_toc/insert-sql" class="u"> INSERT</a><span class="metrics"><span class="wcntr"> 68</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/upsert-with-not-null-column"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#upsert-with-not-null-column">Upsert with <code>NOT NULL</code> column</a><span class="hover-metadata"><a href="#_toc/upsert" class="u"> Upsert</a><span class="metrics"><span class="wcntr"> 21</span></span></span></span></div></li></ul></li></ul><li class="has-child"><div id="_toc/join-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#join-sql">JOIN (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="wcntr"> 28</span><span class="dcnt"> 3</span></span></span></span></div><ul><li><div id="_toc/sql-prefix-column-names-with-the-table-they-came-from"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-prefix-column-names-with-the-table-they-came-from">SQL prefix column names with the table they came from</a><span class="hover-metadata"><a href="#_toc/join-sql" class="u"> JOIN</a><span class="metrics"><span class="wcntr"> 28</span></span></span></span></div></li><li><div id="_toc/inner-join"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#inner-join">INNER JOIN</a><span class="hover-metadata"><a href="#_toc/join-sql" class="u"> JOIN</a></span></span></div></li><li><div id="_toc/outer-join"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#outer-join">OUTER JOIN</a><span class="hover-metadata"><a href="#_toc/join-sql" class="u"> JOIN</a></span></span></div></li></ul><li><div id="_toc/like-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#like-sql">LIKE (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a></span></span></div></li><li class="has-child"><div id="_toc/select-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#select-sql">SELECT (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="wcntr"> 29</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/select-for-update"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#select-for-update">SELECT FOR UPDATE</a><span class="hover-metadata"><a href="#_toc/select-sql" class="u"> SELECT</a><span class="metrics"><span class="wcntr"> 29</span></span></span></span></div></li></ul><li class="has-child"><div id="_toc/sql-stored-procedure"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-stored-procedure">SQL stored procedure</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="dcnt"> 2</span></span></span></span></div><ul><li><div id="_toc/sql-function-keyword"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-function-keyword">SQL FUNCTION keyword</a><span class="hover-metadata"><a href="#_toc/sql-stored-procedure" class="u"> SQL stored procedure</a></span></span></div></li><li><div id="_toc/sql-procedure"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-procedure">SQL PROCEDURE</a><span class="hover-metadata"><a href="#_toc/sql-stored-procedure" class="u"> SQL stored procedure</a></span></span></div></li></ul><li><div id="_toc/sql-trigger"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-trigger">SQL TRIGGER</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="wcntr"> 60</span></span></span></span></div></li><li class="has-child"><div id="_toc/iso-sql-trigger-syntax"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#iso-sql-trigger-syntax">ISO SQL TRIGGER syntax</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="wcntr"> 99</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/_file/nodejs/sequelize/raw/trigger_count.js"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#_file/nodejs/sequelize/raw/trigger_count.js">nodejs/sequelize/raw/trigger_count.js</a><span class="hover-metadata"><a href="#_toc/iso-sql-trigger-syntax" class="u"> ISO SQL TRIGGER syntax</a><span class="metrics"><span class="wcntr"> 16</span></span></span></span></div></li></ul><li><div id="_toc/union-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#union-sql">UNION (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="wcntr"> 84</span></span></span></span></div></li><li class="has-child"><div id="_toc/update-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#update-sql">UPDATE (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-keyword" class="u"> SQL keyword</a><span class="metrics"><span class="wcntr"> 116</span><span class="dcnt"> 3</span></span></span></span></div><ul><li><div id="_toc/update-multiple-rows-with-different-values-in-a-single-sql-query"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#update-multiple-rows-with-different-values-in-a-single-sql-query">Update multiple rows with different values in a single SQL query</a><span class="hover-metadata"><a href="#_toc/update-sql" class="u"> UPDATE</a><span class="metrics"><span class="wcntr"> 34</span></span></span></span></div></li><li class="has-child"><div id="_toc/update-with-join-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#update-with-join-sql">UPDATE with JOIN (SQL)</a><span class="hover-metadata"><a href="#_toc/update-sql" class="u"> UPDATE</a><span class="metrics"><span class="wcntr"> 82</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/delete-with-join-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#delete-with-join-sql">DELETE with JOIN (SQL)</a><span class="hover-metadata"><a href="#_toc/update-with-join-sql" class="u"> UPDATE with JOIN</a><span class="metrics"><span class="wcntr"> 53</span></span></span></span></div></li></ul></li></ul></li></ul><li class="has-child"><div id="_toc/sql-standard"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-standard">SQL standard</a><span class="hover-metadata"><a href="#_toc" class="u"> SQL</a><span class="metrics"><span class="wcntr"> 28</span><span class="dcnt"> 2</span></span></span></span></div><ul><li class="has-child"><div id="_toc/sql-standard-version"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-standard-version">SQL standard version</a><span class="hover-metadata"><a href="#_toc/sql-standard" class="u"> SQL standard</a><span class="metrics"><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/sql-1999"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-1999">SQL:1999</a><span class="hover-metadata"><a href="#_toc/sql-standard-version" class="u"> SQL standard version</a></span></span></div></li></ul></li></ul><li class="has-child"><div id="_toc/sql-application"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-application">SQL application</a><span class="hover-metadata"><a href="#_toc" class="u"> SQL</a><span class="metrics"><span class="wcntr"> 526</span><span class="dcnt"> 5</span></span></span></span></div><ul><li class="has-child"><div id="_toc/sql-histogram"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-histogram">SQL histogram</a><span class="hover-metadata"><a href="#_toc/sql-application" class="u"> SQL application</a><span class="metrics"><span class="wcntr"> 439</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/sql-2d-histogram"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-2d-histogram">SQL 2D histogram</a><span class="hover-metadata"><a href="#_toc/sql-histogram" class="u"> SQL histogram</a><span class="metrics"><span class="wcntr"> 199</span></span></span></span></div></li></ul><li class="has-child"><div id="_toc/sql-tree-traversal"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-tree-traversal">SQL tree traversal</a><span class="hover-metadata"><a href="#_toc/sql-application" class="u"> SQL application</a><span class="metrics"><span class="wcntr"> 87</span><span class="dcnt"> 2</span></span></span></span></div><ul><li><div id="_toc/closure-table"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#closure-table">Closure table</a><span class="hover-metadata"><a href="#_toc/sql-tree-traversal" class="u"> SQL tree traversal</a></span></span></div></li><li><div id="_toc/nested-set-model-in-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#nested-set-model-in-sql">Nested set model in SQL</a><span class="hover-metadata"><a href="#_toc/sql-tree-traversal" class="u"> SQL tree traversal</a><span class="metrics"><span class="wcntr"> 59</span></span></span></span></div></li></ul></li></ul><li class="has-child"><div id="_toc/sql-feature"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-feature">SQL feature</a><span class="hover-metadata"><a href="#_toc" class="u"> SQL</a><span class="metrics"><span class="wcntr"> 2k</span><span class="dcnt"> 26</span></span></span></span></div><ul><li><div id="_toc/generated-column"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#generated-column">Generated column</a><span class="hover-metadata"><a href="#_toc/sql-feature" class="u"> SQL feature</a></span></span></div></li><li class="has-child"><div id="_toc/sql-recursive-query"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-recursive-query">SQL RECURSIVE query</a><span class="hover-metadata"><a href="#_toc/sql-feature" class="u"> SQL feature</a><span class="metrics"><span class="wcntr"> 11</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/sql-recursive-prevent-infinite-recursion"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-recursive-prevent-infinite-recursion">SQL RECURSIVE prevent infinite recursion</a><span class="hover-metadata"><a href="#_toc/sql-recursive-query" class="u"> SQL RECURSIVE query</a><span class="metrics"><span class="wcntr"> 5</span></span></span></span></div></li></ul><li class="has-child"><div id="_toc/sql-spatial-index"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-spatial-index">SQL spatial index</a><span class="hover-metadata"><a href="#_toc/sql-feature" class="u"> SQL feature</a><span class="metrics"><span class="wcntr"> 151</span><span class="dcnt"> 3</span></span></span></span></div><ul><li class="has-child"><div id="_toc/postgresql-spatial-index"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-spatial-index">PostgreSQL spatial index</a><span class="hover-metadata"><a href="#_toc/sql-spatial-index" class="u"> SQL spatial index</a><span class="metrics"><span class="wcntr"> 151</span><span class="dcnt"> 2</span></span></span></span></div><ul><li><div id="_toc/postgresql-gist"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgresql-gist">PostgreSQL GIST</a><span class="hover-metadata"><a href="#_toc/postgresql-spatial-index" class="u"> PostgreSQL spatial index</a><span class="metrics"><span class="wcntr"> 136</span></span></span></span></div></li><li><div id="_toc/postgis"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#postgis">PostGIS</a><span class="hover-metadata"><a href="#_toc/postgresql-spatial-index" class="u"> PostgreSQL spatial index</a><span class="metrics"><span class="wcntr"> 15</span></span></span></span></div></li></ul></li></ul><li class="has-child"><div id="_toc/sql-subquery"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-subquery">SQL subquery</a><span class="hover-metadata"><a href="#_toc/sql-feature" class="u"> SQL feature</a><span class="metrics"><span class="wcntr"> 67</span><span class="dcnt"> 2</span></span></span></span></div><ul><li class="has-child"><div id="_toc/common-table-expression"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#common-table-expression">Common Table Expression</a><span class="hover-metadata"><a href="#_toc/sql-subquery" class="u"> SQL subquery</a><span class="metrics"><span class="wcntr"> 67</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/cte-insert-values"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#cte-insert-values">CTE insert values</a><span class="hover-metadata"><a href="#_toc/common-table-expression" class="u"> Common Table Expression</a><span class="metrics"><span class="wcntr"> 19</span></span></span></span></div></li></ul></li></ul><li class="has-child"><div id="_toc/sql-transaction"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-transaction">SQL transaction</a><span class="hover-metadata"><a href="#_toc/sql-feature" class="u"> SQL feature</a><span class="metrics"><span class="wcntr"> 2k</span><span class="dcnt"> 11</span></span></span></span></div><ul><li class="has-child"><div id="_toc/sql-transaction-isolation-level"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-transaction-isolation-level">SQL transaction isolation level</a><span class="hover-metadata"><a href="#_toc/sql-transaction" class="u"> SQL transaction</a><span class="metrics"><span class="wcntr"> 2k</span><span class="dcnt"> 10</span></span></span></span></div><ul><li><div id="_toc/sql-read-uncommitted-isolation-level"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-read-uncommitted-isolation-level">SQL READ UNCOMMITTED isolation level</a><span class="hover-metadata"><a href="#_toc/sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a></span></span></div></li><li><div id="_toc/sql-read-committed-isolation-level"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-read-committed-isolation-level">SQL READ COMMITTED isolation level</a><span class="hover-metadata"><a href="#_toc/sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a><span class="metrics"><span class="wcntr"> 7</span></span></span></span></div></li><li><div id="_toc/sql-repeatable-read-isolation-level"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-repeatable-read-isolation-level">SQL REPEATABLE READ isolation level</a><span class="hover-metadata"><a href="#_toc/sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a><span class="metrics"><span class="wcntr"> 70</span></span></span></span></div></li><li><div id="_toc/sql-serializable-isolation-level"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-serializable-isolation-level">SQL SERIALIZABLE isolation level</a><span class="hover-metadata"><a href="#_toc/sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a></span></span></div></li><li class="has-child"><div id="_toc/sql-isolation-level-example"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-isolation-level-example">SQL isolation level example</a><span class="hover-metadata"><a href="#_toc/sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a><span class="metrics"><span class="wcntr"> 1k</span><span class="dcnt"> 5</span></span></span></span></div><ul><li class="has-child"><div id="_toc/sql-parallel-update-example"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-parallel-update-example">SQL parallel update example</a><span class="hover-metadata"><a href="#_toc/sql-isolation-level-example" class="u"> SQL isolation level example</a><span class="metrics"><span class="wcntr"> 1k</span><span class="dcnt"> 4</span></span></span></span></div><ul><li><div id="_toc/_file/nodejs/sequelize/raw/parallel_update_async.js"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#_file/nodejs/sequelize/raw/parallel_update_async.js">nodejs/sequelize/raw/parallel_update_async.js</a><span class="hover-metadata"><a href="#_toc/sql-parallel-update-example" class="u"> SQL parallel update example</a><span class="metrics"><span class="wcntr"> 227</span></span></span></span></div></li><li><div id="_toc/_file/nodejs/sequelize/raw/parallel_select_and_update.js"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#_file/nodejs/sequelize/raw/parallel_select_and_update.js">nodejs/sequelize/raw/parallel_select_and_update.js</a><span class="hover-metadata"><a href="#_toc/sql-parallel-update-example" class="u"> SQL parallel update example</a><span class="metrics"><span class="wcntr"> 422</span></span></span></span></div></li><li><div id="_toc/_file/nodejs/sequelize/raw/parallel_select_and_update_deterministic.js"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#_file/nodejs/sequelize/raw/parallel_select_and_update_deterministic.js">nodejs/sequelize/raw/parallel_select_and_update_deterministic.js</a><span class="hover-metadata"><a href="#_toc/sql-parallel-update-example" class="u"> SQL parallel update example</a><span class="metrics"><span class="wcntr"> 13</span></span></span></span></div></li><li><div id="_toc/_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js">nodejs/sequelize/raw/parallel_create_delete_empty_tag.js</a><span class="hover-metadata"><a href="#_toc/sql-parallel-update-example" class="u"> SQL parallel update example</a><span class="metrics"><span class="wcntr"> 758</span></span></span></span></div></li></ul></li></ul></li></ul></li></ul><li class="has-child"><div id="_toc/window-function-sql"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#window-function-sql">Window function (SQL)</a><span class="hover-metadata"><a href="#_toc/sql-feature" class="u"> SQL feature</a><span class="metrics"><span class="wcntr"> 452</span><span class="dcnt"> 3</span></span></span></span></div><ul><li><div id="_toc/row-number"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#row-number"><code>ROW_NUMBER</code></a><span class="hover-metadata"><a href="#_toc/window-function-sql" class="u"> Window function</a><span class="metrics"><span class="wcntr"> 57</span></span></span></span></div></li><li><div id="_toc/sql-window-range"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-window-range">SQL window <code>RANGE</code></a><span class="hover-metadata"><a href="#_toc/window-function-sql" class="u"> Window function</a><span class="metrics"><span class="wcntr"> 214</span></span></span></span></div></li><li><div id="_toc/sql-contiguous-ranges"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sql-contiguous-ranges">SQL contiguous ranges</a><span class="hover-metadata"><a href="#_toc/window-function-sql" class="u"> Window function</a><span class="metrics"><span class="wcntr"> 181</span></span></span></span></div></li></ul></li></ul></li></ul></li></ul></div><div class="h" id="sql-example"><div class="notnav"><h2><a href="sql-example">SQL example</a></h2><span class="hover-meta"> <a class="split" href="sql-example"></a><span class="metrics"><span class="wcntr"> Words: 483</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> SQL</a><a href="#_toc/sql-example" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-example"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_1">We have some runnable <a href="">SQL</a> examples with <a href="software#assertion-software-development">assertion</a> under the <code>sequelize/raw</code> directory.</div><div class="p" id="_2">These examples are written in the <a href="sequelize">Sequelize</a> library using raw queries.</div><div class="p" id="_3">Sequelize is used minimally, just to feed raw queries in transparently to any underlying database, and get minimally parsed results out for us, which we then assert with standard <a href="programming-language#javascript">JavaScript</a>. The queries themselves are all written by hand.</div><div class="p" id="_4">By default the examples run on <a href="#sqlite">SQLite</a>. Just like the examples from <a href="sequelize#sequelize-example">sequelize example</a>, you can set the database at runtime as:<div class="list"><ul id="_5"><li id="_6"><code>./index.js</code> or <code>./index.js l</code>: <a href="#sqlite">SQLite</a></li><li id="_7"><code>./index.js p</code>: <a href="#postgresql">PostgreSQL</a>. You must manually create a database called <code>tmp</code> and ensure that peer authentication works for it</li></ul></div></div><div class="p" id="_8">Here we list only examples which we believe are standard SQL, and should therefore work across different SQL implementations:<div class="list"><ul id="_9"><li id="_10"><a href="_raw/nodejs/sequelize/raw/index.js">nodejs/sequelize/raw/index.js</a>: basic hello world to demonstrate the setup and very simple functionality</li><li id="_11"><a href="_raw/nodejs/sequelize/raw/many_to_many.js">nodejs/sequelize/raw/many_to_many.js</a>: illustrates <a href="software#many-to-many">many-to-many relations</a> with <a href="#join-sql">JOIN</a>. Contains:</li><li id="_12"><a href="#sql-transaction">SQL transaction</a> examples:<div class="list"><ul id="_13"><li id="_14"><a href="_raw/nodejs/sequelize/raw/commit_error.js">nodejs/sequelize/raw/commit_error.js</a>: <a href="https://stackoverflow.com/questions/27245101/why-should-we-use-rollback-in-sql-explicitly/27245234#27245234">stackoverflow.com/questions/27245101/why-should-we-use-rollback-in-sql-explicitly/27245234#27245234</a> and <a href="https://stackoverflow.com/questions/48277519/how-to-use-commit-and-rollback-in-a-postgresql-function/48277708#48277708">stackoverflow.com/questions/48277519/how-to-use-commit-and-rollback-in-a-postgresql-function/48277708#48277708</a> suggest that on <a href="#postgresql">PostgreSQL</a>, once something fails inside a transaction, all queries in the current transaction are ignored, and <code>COMMIT</code> simply does a <code>ROLLBACK</code>. Let's check. Yup, true for Postgres, but false for <a href="#sqlite">SQLite</a>, SQLite just happily runs anything it can, you really need <code>ROLLBACK</code> for it.</li><li id="_15"><a href="#sql-isolation-level-example">SQL isolation level example</a></li></ul></div></li><li id="_16"><a href="#group-by-sql">GROUP BY</a> and <a href="#sql-aggregate-function">SQL aggregate functions</a>:<div class="list"><ul id="_17"><li id="_18"><a href="_raw/nodejs/sequelize/raw/group_by_extra_column.js">nodejs/sequelize/raw/group_by_extra_column.js</a>: let's see if it blows up or not on different DB systems, <a href="#sqlite3-node-js-package"><code>sqlite3</code> Node.js package</a> allows it:<div class="list"><ul id="_19"><li id="_20"><a href="https://github.com/sequelize/sequelize/issues/5481#issuecomment-964387232">github.com/sequelize/sequelize/issues/5481#issuecomment-964387232</a></li><li id="_21"><a href="https://dba.stackexchange.com/questions/141594/how-select-column-does-not-list-in-group-by-clause/141600">dba.stackexchange.com/questions/141594/how-select-column-does-not-list-in-group-by-clause/141600</a> says that it was allowed in <a href="#sql-1999">SQL:1999</a> when there are no ambiguities due to constraints, e.g. when grouping by unique columns</li><li id="_22"><a href="https://github.com/postgres/postgres/blob/REL_13_5/src/test/regress/sql/functional_deps.sql#L27">github.com/postgres/postgres/blob/REL_13_5/src/test/regress/sql/functional_deps.sql#L27</a> shows that <a href="#postgresql">PostgreSQL</a> wants it to work for <code>UNIQUE NOT NULL</code>, but they just haven't implemented it as of 13.5, where it only works if you group by <code>PRIMARY KEY</code></li><li id="_23"><a href="https://dba.stackexchange.com/questions/158015/why-can-i-select-all-fields-when-grouping-by-primary-key-but-not-when-grouping-b">dba.stackexchange.com/questions/158015/why-can-i-select-all-fields-when-grouping-by-primary-key-but-not-when-grouping-b</a> also says that <code>UNIQUE NOT NULL</code> doesn't work. Dan Lenski then points to a rationale mailing list thread.</li></ul></div></li><li id="_24"><a href="_raw/nodejs/sequelize/raw/group_by_max_full_row.js">nodejs/sequelize/raw/group_by_max_full_row.js</a>: here we try to get the full row of each group at which a given column reaches the max of the group<div class="list"><ul id="_25"><li id="_26"><a href="#postgresql">Postgres</a>: has <code>SELECT DISCINTCT ON</code> which works perfectly if you only want one row in case of multiple rows attaining the max. <code>ON</code> is an extension to the standard unfortunately: <a href="https://www.postgresql.org/docs/9.3/sql-select.html#SQL-DISTINCT">www.postgresql.org/docs/9.3/sql-select.html#SQL-DISTINCT</a> Docs specify that it always respects <code>ORDER BY</code> when selecting the row.<div class="list"><ul id="_27"><li id="_28"><a href="https://stackoverflow.com/questions/586781/postgresql-fetch-the-row-which-has-the-max-value-for-a-column">stackoverflow.com/questions/586781/postgresql-fetch-the-row-which-has-the-max-value-for-a-column</a> asks it without the multiple matches use case<div class="list"><ul id="_29"><li id="_30"><a href="https://stackoverflow.com/questions/586781/postgresql-fetch-the-rows-which-have-the-max-value-for-a-column-in-each-group/587209#587209">stackoverflow.com/questions/586781/postgresql-fetch-the-rows-which-have-the-max-value-for-a-column-in-each-group/587209#587209</a> also present in simpler form at <a href="https://stackoverflow.com/questions/121387/fetch-the-rows-which-have-the-max-value-for-a-column-for-each-distinct-value-of/123481#123481">stackoverflow.com/questions/121387/fetch-the-rows-which-have-the-max-value-for-a-column-for-each-distinct-value-of/123481#123481</a> gives a very nice <a href="#outer-join">OUTER JOIN</a> only solution! Incredible, very elegant.</li></ul></div></li><li id="_31"><a href="https://dba.stackexchange.com/questions/171938/get-only-rows-with-max-group-value">dba.stackexchange.com/questions/171938/get-only-rows-with-max-group-value</a> asks specifically the case of multiple matches to the max</li></ul></div></li><li id="_32"><a href="#sqlite">SQLite</a>:<div class="list"><ul id="_33"><li id="_34"><a href="https://stackoverflow.com/questions/48326957/row-with-max-value-per-group-sqlite">stackoverflow.com/questions/48326957/row-with-max-value-per-group-sqlite</a><div class="list"><ul id="_35"><li id="_36"><a href="https://stackoverflow.com/questions/48326957/row-with-max-value-per-group-sqlite/48328243#48328243">stackoverflow.com/questions/48326957/row-with-max-value-per-group-sqlite/48328243#48328243</a> teaches us that in SQLite min and max are magic and guarantee that the matching row is returned</li><li id="_37"><a href="https://stackoverflow.com/questions/48326957/row-with-max-value-per-group-sqlite/72996649#72996649">stackoverflow.com/questions/48326957/row-with-max-value-per-group-sqlite/72996649#72996649</a> <a href="ciro-santilli">Ciro Santilli</a> uses the magic of <code>ROW_NUMBER</code></li></ul></div></li><li id="_38"><a href="https://stackoverflow.com/questions/17277152/sqlite-select-distinct-of-one-column-and-get-the-others/71924314#71924314">stackoverflow.com/questions/17277152/sqlite-select-distinct-of-one-column-and-get-the-others/71924314#71924314</a> get any full row without specifying which, we teach how to specify</li><li id="_39"><a href="https://code.djangoproject.com/ticket/22696">code.djangoproject.com/ticket/22696</a> WONTFIXed <code>DISTINCT ON</code><div class="list"><ul id="_40"><li id="_41"><a href="https://stackoverflow.com/questions/50846722/what-is-the-difference-between-postgres-distinct-vs-distinct-on/72997494#72997494">stackoverflow.com/questions/50846722/what-is-the-difference-between-postgres-distinct-vs-distinct-on/72997494#72997494</a> <code>DISTINCT</code> vs <code>DISTINCT ON</code>, somewhat related question</li></ul></div></li></ul></div></li><li id="_42"><a href="https://stackoverflow.com/questions/5803032/group-by-to-return-entire-row">stackoverflow.com/questions/5803032/group-by-to-return-entire-row</a> asks how to take the top N with distinct after order limit. I don't know how to do it in Postgres</li></ul></div></li><li id="_43"><a href="_raw/nodejs/sequelize/raw/most_frequent.js">nodejs/sequelize/raw/most_frequent.js</a>: illustrates a few variants of findind the <a href="mathematics#mode-statistics">mode</a>, including across GROUP<div class="list"><ul id="_44"><li id="_45"><a href="https://stackoverflow.com/questions/12235595/find-most-frequent-value-in-sql-column/72979899#72979899">stackoverflow.com/questions/12235595/find-most-frequent-value-in-sql-column/72979899#72979899</a></li></ul></div></li><li id="_46"><a href="_raw/nodejs/sequelize/raw/group_by_max_n.js">nodejs/sequelize/raw/group_by_max_n.js</a>: get the top N in each group<div class="list"><ul id="_47"><li id="_48">PostgreSQL<div class="list"><ul id="_49"><li id="_50"><a href="https://stackoverflow.com/questions/1124603/grouped-limit-in-postgresql-show-the-first-n-rows-for-each-group">stackoverflow.com/questions/1124603/grouped-limit-in-postgresql-show-the-first-n-rows-for-each-group</a></li><li id="_51"><a href="https://stackoverflow.com/questions/7613785/postgresql-top-n-entries-per-item-in-same-table">stackoverflow.com/questions/7613785/postgresql-top-n-entries-per-item-in-same-table</a><div class="list"><ul id="_52"><li id="_53"><a href="https://dba.stackexchange.com/questions/247275/rank-used-in-where-returns-invalid-column-but-exists-in-results-set">dba.stackexchange.com/questions/247275/rank-used-in-where-returns-invalid-column-but-exists-in-results-set</a></li></ul></div></li></ul></div></li><li id="_54">SQLite <a href="https://stackoverflow.com/questions/28119176/select-top-n-record-from-each-group-sqlite">stackoverflow.com/questions/28119176/select-top-n-record-from-each-group-sqlite</a></li><li id="_55">MySQL <a href="https://stackoverflow.com/questions/2129693/using-limit-within-group-by-to-get-n-results-per-group">stackoverflow.com/questions/2129693/using-limit-within-group-by-to-get-n-results-per-group</a></li></ul></div></li></ul></div></li><li id="_56">order results in the same order as <code>IN</code>:<div class="list"><ul id="_57"><li id="_58">MysQL: <a href="https://stackoverflow.com/questions/396748/ordering-by-the-order-of-values-in-a-sql-in-clause">stackoverflow.com/questions/396748/ordering-by-the-order-of-values-in-a-sql-in-clause</a></li><li id="_59">PostgreSQL:<div class="list"><ul id="_60"><li id="_61"><a href="https://stackoverflow.com/questions/866465/order-by-the-in-value-list">stackoverflow.com/questions/866465/order-by-the-in-value-list</a></li><li id="_62"><a href="https://dba.stackexchange.com/questions/59394/order-of-returned-rows-with-in-statement">dba.stackexchange.com/questions/59394/order-of-returned-rows-with-in-statement</a></li></ul></div></li></ul></div></li><li id="_63">LIMIT by a running total: TODO links</li></ul></div></div><div class="h" id="sql-implementation"><div class="notnav"><h2><a href="sql-implementation">SQL implementation</a></h2><span class="hover-meta"> <a class="split" href="sql-implementation"></a><span class="metrics"><span class="wcntr"> Words: 3k</span><span class="dcnt"> Articles: 31</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> SQL</a><a href="#_toc/sql-implementation" class="toc"></a><a href="https://en.wikipedia.org/wiki/SQL_implementation" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/sql-implementation"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="ibm-db2"><div class="notnav"><h3><a href="ibm-db2">IBM Db2</a></h3><span class="hover-meta"> <a class="split" href="ibm-db2"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-implementation" class="u"> SQL implementation</a><a href="#_toc/ibm-db2" class="toc"></a><a href="https://en.wikipedia.org/wiki/IBM_Db2" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/ibm-db2"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="mysql"><div class="notnav"><h3><a href="mysql">MySQL</a></h3><span class="hover-meta"> <a class="split" href="mysql"></a><span class="metrics"><span class="wcntr"> Words: 183</span><span class="dcnt"> Articles: 3</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-implementation" class="u"> SQL implementation</a><a href="#_toc/mysql" class="toc"></a><a href="https://en.wikipedia.org/wiki/MySQL" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/mysql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_64">Login without password: <a href="https://askubuntu.com/questions/915585/how-to-login-mysql-shell-when-mysql-have-no-password">askubuntu.com/questions/915585/how-to-login-mysql-shell-when-mysql-have-no-password</a><div class="code" id="_65"><div><pre><code>sudo mysql</code></pre></div></div>works on <a href="systems-programming#ubuntu">Ubuntu</a> 20.10.</div><div class="p" id="_66">Create user for further logins without <code>sudo</code> <a href="https://askubuntu.com/questions/915585/how-to-login-mysql-shell-when-mysql-have-no-password/1325689#1325689">askubuntu.com/questions/915585/how-to-login-mysql-shell-when-mysql-have-no-password/1325689#1325689</a>:<div class="code" id="_67"><div><pre><code>sudo mysql -e "CREATE USER $USER"</code></pre></div></div></div><div class="p" id="_68">Run command from CLI <a href="https://stackoverflow.com/questions/1602904/how-do-you-run-a-single-query-through-mysql-from-the-command-line">stackoverflow.com/questions/1602904/how-do-you-run-a-single-query-through-mysql-from-the-command-line</a><div class="code" id="_69"><div><pre><code>mysql -e 'SHOW DATABASES'</code></pre></div></div></div><div class="p" id="_70">Create test user with password:<div class="code" id="_71"><div><pre><code>sudo mysql -e 'CREATE USER user0 IDENTIFIED WITH mysql_native_password BY "a"'
sudo mysql -e 'GRANT ALL PRIVILEGES ON database_name.* TO "user0"'</code></pre></div></div>and login as that user:<div class="code" id="_72"><div><pre><code>mysql -u user0 -p</code></pre></div></div>Login with password given on the command line:<div class="code" id="_73"><div><pre><code>mysql -u user0 -pmypassword</code></pre></div></div>The <code>IDENTIFIED WITH mysql_native_password</code> part is to overcome "Client does not support authentication protocol requested by server" when connecting from <a href="node-js">Node.js</a>.</div><div class="p" id="_74">List users:<div class="code" id="_75"><div><pre><code>sudo mysql -e 'SELECT * FROM mysql.user'</code></pre></div></div></div><div class="p" id="_76">View permissions for each user on each DB: <a href="https://serverfault.com/questions/263868/how-to-know-all-the-users-that-can-access-a-database-mysql">serverfault.com/questions/263868/how-to-know-all-the-users-that-can-access-a-database-mysql</a><div class="code" id="_77"><div><pre><code>sudo mysql -e 'SELECT * FROM mysql.db'</code></pre></div></div></div><div class="p" id="_78">List databases:<div class="code" id="_79"><div><pre><code>sudo mysql -e 'SHOW DATABASES'</code></pre></div></div></div><div class="p" id="_80">Create database:<div class="code" id="_81"><div><pre><code>sudo mysql -e 'CREATE DATABASE mydb0'</code></pre></div></div></div><div class="p" id="_82">Destroy database:<div class="code" id="_83"><div><pre><code>sudo mysql -e 'DROP DATABASE mydb0'</code></pre></div></div></div><div class="p" id="_84">Show tables in database:<div class="code" id="_85"><div><pre><code>sudo mysql -e 'SHOW TABLES' mydb0</code></pre></div></div>or:<div class="code" id="_86"><div><pre><code>sudo mysql -e 'SHOW TABLES FROM mydb0'</code></pre></div></div></div><div class="h" id="mysqldump"><div class="notnav"><h4><a href="mysqldump">mysqldump</a></h4><span class="hover-meta"> <a class="split" href="mysqldump"></a><span class="metrics"><span class="wcntr"> Words: 1</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#mysql" class="u"> MySQL</a><a href="#_toc/mysqldump" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/mysqldump"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_87"><a href="https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html">dev.mysql.com/doc/refman/8.0/en/mysqldump.html</a></div><div class="h" id="mysqldump-to-csv"><div class="notnav"><h5><a href="mysqldump-to-csv">mysqldump to CSV</a></h5><span class="hover-meta"> <a class="split" href="mysqldump-to-csv"></a><span class="metrics"><span class="wcntr"> Words: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#mysqldump" class="u"> mysqldump</a><a href="#_toc/mysqldump-to-csv" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/mysqldump-to-csv"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_88">Related: <a href="https://stackoverflow.com/questions/32026398/transform-sql-insert-script-into-csv-format">stackoverflow.com/questions/32026398/transform-sql-insert-script-into-csv-format</a></div><div class="h" id="mariadb"><div class="notnav"><h4><a href="mariadb">MariaDB</a></h4><span class="hover-meta"> <a class="split" href="mariadb"></a><span class="metrics"><span class="wcntr"> Words: 19</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#mysql" class="u"> MySQL</a><a href="#_toc/mariadb" class="toc"></a><a href="https://en.wikipedia.org/wiki/MariaDB" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/mariadb"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_89">Dude's a legend. Sells company for a few million. Then forks the open source project next year. Love it.</div><div class="h" id="postgresql"><div class="notnav"><h3><a href="postgresql">PostgreSQL <span class="meta">(Postgres)</span></a></h3><span class="hover-meta"> <a class="split" href="postgresql"></a><span class="metrics"><span class="wcntr"> Words: 3k</span><span class="dcnt"> Articles: 12</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-implementation" class="u"> SQL implementation</a><a href="#_toc/postgresql" class="toc"></a><a href="https://en.wikipedia.org/wiki/PostgreSQL" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/postgresql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_91">PostgreSQL feels good.</div><div class="p" id="_92">Its feature set is insanely large! Just look at stuff like: <a href="https://stackoverflow.com/questions/1986491/sql-split-string-by-space-into-table-in-postgresql/1993058#1993058">stackoverflow.com/questions/1986491/sql-split-string-by-space-into-table-in-postgresql/1993058#1993058</a></div><div class="p" id="_93">Had a look at the source tree, and also felt good.</div><div class="p" id="_94">If <a href="software#oracle-corporation">Oracle</a> is the <a href="microsoft">Microsoft</a> of database, Postgres is the <a href="systems-programming#linux">Linux</a>, and <a href="#mysql">MySQL</a> (or more precisely <a href="#mariadb">MariaDB</a>) is the <a href="systems-programming#freebsd">FreeBSD</a> (i.e. the one that got delayed by legal issues). Except that their <a href="law#software-license">software licenses</a> were accidentally swapped.</div><div class="p" id="_95">The only problem with Postgres is its name. PostgreSQL is so unpronounceable and so untypeable that you should just call it "Postgres" like everyone else.</div><div class="h" id="postgresql-getting-started"><div class="notnav"><h4><a href="postgresql-getting-started">PostgreSQL getting started</a></h4><span class="hover-meta"> <a class="split" href="postgresql-getting-started"></a><span class="metrics"><span class="wcntr"> Words: 2k</span><span class="dcnt"> Articles: 4</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql" class="u"> PostgreSQL</a><a href="#_toc/postgresql-getting-started" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-getting-started"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_96">On Ubuntu 20.10 PostgreSQL 12.6, login with <code>psql</code> on my default username without <a href="software#sudo">sudo</a> fails with: <a href="https://stackoverflow.com/questions/11919391/postgresql-error-fatal-role-username-does-not-exist">stackoverflow.com/questions/11919391/postgresql-error-fatal-role-username-does-not-exist</a></div><div class="p" id="_97">This is the one that worked on <a href="systems-programming#ubuntu-21-04">Ubuntu 21.04</a>: <a href="https://stackoverflow.com/questions/11919391/postgresql-error-fatal-role-username-does-not-exist/38444152#38444152">stackoverflow.com/questions/11919391/postgresql-error-fatal-role-username-does-not-exist/38444152#38444152</a><div class="code" id="_98"><div><pre><code>sudo -u postgres createuser -s $(whoami)
createdb $(whoami)</code></pre></div></div>Explanation:<div class="list"><ul id="_99"><li id="_100"><code>sudo -u postgres</code> uses the <code>postgres</code> user via <a href="#peer-authentication">peer authentication</a></li><li id="_101"><code>-s</code> in <code>createuser -s</code>: make it a superuser</li><li id="_102"><code>createdb</code>: TODO why do we have to create a table with the same name as the user? Otherwise login fails.</li></ul></div></div><div class="p" id="_103">You can now run <code>psql</code> without any password. This works without password due to peer authentication:<div class="code" id="_104"><div><pre><code>sudo cat /etc/postgresql/12/main/pg_hba.conf</code></pre></div></div>shows that peer authentication is available to all users apparently:<div class="code" id="_105"><div><pre><code>local   all             postgres                                peer

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             all                                     peer</code></pre></div></div></div><div class="p" id="_106">List users:<div class="code" id="_107"><div><pre><code>psql -c '\du'</code></pre></div></div>output:<div class="code" id="_108"><div><pre><code>                                    List of roles
  Role name  |                         Attributes                         | Member of
-------------+------------------------------------------------------------+-----------
 ciro        | Superuser, Create role, Create DB                          | {}
 owning_user |                                                            | {}
 postgres    | Superuser, Create role, Create DB, Replication, Bypass RLS | {}</code></pre></div></div></div><div class="p" id="_109">Delete user later on:<div class="code" id="_110"><div><pre><code>psql -c 'DROP USER username;'</code></pre></div></div></div><div class="p" id="_111">Create a database:<div class="code" id="_112"><div><pre><code>createdb testdb0</code></pre></div></div></div><div class="p" id="_113">Help toplevel:<div class="code" id="_114"><div><pre><code>help</code></pre></div></div></div><div class="p" id="_115">Get help for Postgres commands such as <code>\h</code> and so on:<div class="code" id="_116"><div><pre><code>\?</code></pre></div></div></div><div class="p" id="_117">List supported SQL commands:<div class="code" id="_118"><div><pre><code>\h</code></pre></div></div></div><div class="p" id="_119">Show syntax for one type of command:<div class="code" id="_120"><div><pre><code>\h SELECT</code></pre></div></div></div><div class="p" id="_121">List all databases:<div class="code" id="_122"><div><pre><code>psql -c '\l'</code></pre></div></div>which shows:<div class="code" id="_123"><div><pre><code>    Name     |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges
-------------+----------+----------+-------------+-------------+-----------------------
 ciro        | postgres | UTF8     | en_GB.UTF-8 | en_GB.UTF-8 |
 postgres    | postgres | UTF8     | en_GB.UTF-8 | en_GB.UTF-8 |
 template0   | postgres | UTF8     | en_GB.UTF-8 | en_GB.UTF-8 | =c/postgres          +
             |          |          |             |             | postgres=CTc/postgres
 template1   | postgres | UTF8     | en_GB.UTF-8 | en_GB.UTF-8 | =c/postgres          +
             |          |          |             |             | postgres=CTc/postgres
 testdb0     | postgres | UTF8     | en_GB.UTF-8 | en_GB.UTF-8 |
(6 rows)</code></pre></div></div></div><div class="p" id="_124">Delete a database:<div class="code" id="_125"><div><pre><code>psql -c 'DROP DATABASE "testdb0";'</code></pre></div></div></div><div class="p" id="_126">If you didn't give a database from the command line e.g.:<div class="code" id="_127"><div><pre><code>psql</code></pre></div></div>you can do that afterwards with:<div class="code" id="_128"><div><pre><code>\c testdb0</code></pre></div></div></div><div class="p" id="_129">Let's create a table and test that it is working:<div class="code" id="_130"><div><pre><code>psql testdb0 -c 'CREATE TABLE table0 (int0 INT, char0 CHAR(16));'</code></pre></div></div></div><div class="p" id="_131">List tables, no special tables:<div class="code" id="_132"><div><pre><code>psql testdb0 -c '\dt'</code></pre></div></div>gives:<div class="code" id="_133"><div><pre><code>        List of relations
 Schema |  Name  | Type  | Owner
--------+--------+-------+-------
 public | table0 | table | ciro
(1 row)</code></pre></div></div></div><div class="p" id="_134">View table schema: <a href="https://stackoverflow.com/questions/109325/postgresql-describe-table">stackoverflow.com/questions/109325/postgresql-describe-table</a><div class="code" id="_135"><div><pre><code>psql testdb0 -c '\d+ table0'</code></pre></div></div>output:<div class="code" id="_136"><div><pre><code>                                      Table "public.table0"
 Column |     Type      | Collation | Nullable | Default | Storage  | Stats target | Description
--------+---------------+-----------+----------+---------+----------+--------------+-------------
 int0   | integer       |           |          |         | plain    |              |
 char0  | character(16) |           |          |         | extended |              |</code></pre></div></div></div><div class="p" id="_137">Insert some data into it and get the data out:<div class="code" id="_138"><div><pre><code>psql testdb0 -c "INSERT INTO table0 (int0, char0) VALUES (2, 'two'), (3, 'three'), (5, 'five'), (7, 'seven');"
psql testdb0 -c 'SELECT * FROM table0;'</code></pre></div></div>output:<div class="code" id="_139"><div><pre><code> int0 |      char0
------+------------------
    2 | two
    3 | three
    5 | five
    7 | seven
(4 rows)</code></pre></div></div></div><div class="p" id="_140">Delete the table:<div class="code" id="_141"><div><pre><code>psql testdb0 -c 'DROP TABLE table0;'</code></pre></div></div></div><div class="h" id="postgresql-howto"><div class="notnav"><h5><a href="postgresql-howto">PostgreSQL HOWTO</a></h5><span class="hover-meta"> <a class="split" href="postgresql-howto"></a><span class="metrics"><span class="wcntr"> Words: 2k</span><span class="dcnt"> Articles: 3</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql-getting-started" class="u"> PostgreSQL getting started</a><a href="#_toc/postgresql-howto" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-howto"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_142"><li id="_143">output one column per line: <a href="https://stackoverflow.com/questions/9604723/alternate-output-format-for-psql-showing-one-column-per-line-with-column-name">stackoverflow.com/questions/9604723/alternate-output-format-for-psql-showing-one-column-per-line-with-column-name</a></li><li id="_144">PostgreSQL does not automatically index foreign keys! <a href="https://stackoverflow.com/questions/970562/postgres-and-indexes-on-foreign-keys-and-primary-keys">stackoverflow.com/questions/970562/postgres-and-indexes-on-foreign-keys-and-primary-keys</a></li></ul></div><div class="h" id="postgresql-create-test-data"><div class="notnav"><h6><a href="postgresql-create-test-data">PostgreSQL create test data</a></h6><span class="hover-meta"> <a class="split" href="postgresql-create-test-data"></a><span class="metrics"><span class="wcntr"> Words: 186</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql-howto" class="u"> PostgreSQL HOWTO</a><a href="#_toc/postgresql-create-test-data" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-create-test-data"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_145"><li id="_146"><a href="https://stackoverflow.com/questions/3371503/sql-populate-table-with-random-data">stackoverflow.com/questions/3371503/sql-populate-table-with-random-data</a></li><li id="_147"><a href="https://stackoverflow.com/questions/24841142/how-can-i-generate-big-data-sample-for-postgresql-using-generate-series-and-rand">stackoverflow.com/questions/24841142/how-can-i-generate-big-data-sample-for-postgresql-using-generate-series-and-rand</a></li></ul></div><div class="h" id="generate-random-text-in-postgresql"><div class="notnav"><h6 data-level="7"><a href="generate-random-text-in-postgresql">Generate random text in PostgreSQL</a></h6><span class="hover-meta"> <a class="split" href="generate-random-text-in-postgresql"></a><span class="metrics"><span class="wcntr"> Words: 186</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql-create-test-data" class="u"> PostgreSQL create test data</a><a href="#_toc/generate-random-text-in-postgresql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/generate-random-text-in-postgresql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_148">This one is good: <a href="https://stackoverflow.com/questions/36533429/generate-random-string-in-postgresql/44200391#44200391">stackoverflow.com/questions/36533429/generate-random-string-in-postgresql/44200391#44200391</a> as it also describes how to generate multiple values.<div class="code" id="_149"><div><pre><code>with symbols(characters) as (VALUES ('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'))
select string_agg(substr(characters, (random() * (length(characters) - 1) + 1)::INTEGER, 1), '')
from symbols
join generate_series(1,8) as word(chr_idx) on 1 = 1 -- word length
join generate_series(1,10000) as words(idx) on 1 = 1 -- # of words
group by idx;</code></pre></div></div></div><div class="p" id="_150">Then you can insert it into a row with:<div class="code" id="_151"><div><pre><code>create table tmp(s text);
insert into tmp(s)
  select s from
  (
    with symbols(characters) as (VALUES ('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'))
    select string_agg(substr(characters, (random() * (length(characters) - 1) + 1)::INTEGER, 1), '') as asdf
    from symbols
    join generate_series(1,8) as word(chr_idx) on 1 = 1 -- word length
    join generate_series(1,10000) as words(idx) on 1 = 1 -- # of words
    group by idx
  ) as sub(s);</code></pre></div></div></div><div class="p" id="_152">A more convenient approach is likely to define the function:<div class="code" id="_153"><div><pre><code>CREATE OR REPLACE FUNCTION random_string(int) RETURNS TEXT as $$
select
  string_agg(substr(characters, (random() * length(characters) + 1)::integer, 1), '') as random_word
from (values('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789    --')) as symbols(characters)
  join generate_series(1, $1) on 1 = 1
$$ language sql;</code></pre></div></div></div><div class="p" id="_154">And then:<div class="code" id="_155"><div><pre><code>create table tmp(s text, t text);
insert into tmp(s) select random_string(10) from generate_series(10);</code></pre></div></div></div><div class="h" id="postgresql-full-text-search"><div class="notnav"><h6><a href="postgresql-full-text-search">PostgreSQL full-text search</a></h6><span class="hover-meta"> <a class="split" href="postgresql-full-text-search"></a><span class="metrics"><span class="wcntr"> Words: 2k</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql-howto" class="u"> PostgreSQL HOWTO</a><a href="#_toc/postgresql-full-text-search" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-full-text-search"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="software#full-text-search">Full-text search</a></span></div></nav></div><div class="p" id="_157">This section was tested on <a href="systems-programming#ubuntu-24-10">Ubuntu 24.10</a>, <a href="#postgresql">PostgreSQL</a> 16.6.</div><div class="p" id="_158">Let's create some test data like this:<div class="code" id="_159"><div><pre><code>time psql tmp -c 'DROP TABLE IF EXISTS fts;'
time psql tmp -c 'CREATE TABLE fts(s TEXT, i INTEGER);'
time psql tmp &lt;&lt;'EOF'
INSERT INTO fts SELECT
  i::text || ' ' ||
    (i * 2  )::text || ' ' ||
    (i * 5  )::text || ' ' ||
    (i * 7  )::text || ' ' ||
    (i * 11 )::text || ' ' ||
    (i * 13 )::text || ' ' ||
    (i * 17 )::text || ' ' ||
    (i * 23 )::text || ' ' ||
    (i * 29 )::text || ' ' ||
    (i * 31 )::text
  ,
  i % 100
FROM generate_series(1::bigint, 100000000::bigint) AS s(i);
EOF</code></pre></div></div></div><div class="p" id="_160">The creation time was 2m13s, and the final size was:<div class="code" id="_161"><div><pre><code>    table_name    | pg_size_pretty | pg_total_relation_size
------------------+----------------+------------------------
 fts              | 13 GB          |            14067326976</code></pre></div></div></div><div class="p" id="_162">This test data will be simple to predict what each line contains so we can make educated queries, while also posing some difficulty to the RDMS. As per:<div class="code" id="_163"><div><pre><code>time psql tmp -c 'SELECT * FROM fts LIMIT 10;'</code></pre></div></div>the first columns look like:<div class="code" id="_164"><div><pre><code>                  s                  | i
-------------------------------------+----
 1 2 5 7 11 13 17 23 29 31           |  1
 2 4 10 14 22 26 34 46 58 62         |  2
 3 6 15 21 33 39 51 69 87 93         |  3
 4 8 20 28 44 52 68 92 116 124       |  4
 5 10 25 35 55 65 85 115 145 155     |  5
 6 12 30 42 66 78 102 138 174 186    |  6
 7 14 35 49 77 91 119 161 203 217    |  7
 8 16 40 56 88 104 136 184 232 248   |  8
 9 18 45 63 99 117 153 207 261 279   |  9
 10 20 50 70 110 130 170 230 290 310 | 10</code></pre></div></div></div><div class="p" id="_165">We aimed to create a test table of size around 10 GB, as in practice it is around that order of size that index speedups start to become very obvious on a <a href="computer-hardware#solid-state-storage">SSD</a>-based system.</div><div class="p" id="_166">Before we create the index, let's see if our non-indexed queries are slow enough for our tests:<div class="code" id="_167"><div><pre><code>time psql tmp -c "SELECT * FROM fts WHERE s LIKE '% 50000000 %';"</code></pre></div></div>which gives:<div class="code" id="_168"><div><pre><code>                                                 s                                                 | i
---------------------------------------------------------------------------------------------------+---
 10000000 20000000 50000000 70000000 110000000 130000000 170000000 230000000 290000000 310000000   | 0
 25000000 50000000 125000000 175000000 275000000 325000000 425000000 575000000 725000000 775000000 | 0
(2 rows)


real    0m11.758s
user    0m0.017s
sys     0m0.008s</code></pre></div></div>so it should be enough to observe the index speedup.</div><div class="p" id="_169">Now let's create the index. First we create a <a href="#generated-column">generated column</a> that splits the strings with <a href="#to-tsvector"><code>to_tsvector</code></a>, and then we index that split column:<div class="code" id="_170"><div><pre><code>time psql tmp &lt;&lt;'EOF'
ALTER TABLE fts ADD COLUMN s_ts tsvector
  GENERATED ALWAYS AS (to_tsvector('english', s)) STORED;
EOF
time psql tmp -c 'CREATE INDEX s_ts_gin_idx ON fts USING GIN (s_ts);'</code></pre></div></div>These commands took 8m51s and 40m8s and the DB size went up about 5x:<div class="code" id="_171"><div><pre><code>    table_name    | pg_size_pretty | pg_total_relation_size
------------------+----------------+------------------------
 fts              | 69 GB          |            74487758848</code></pre></div></div></div><div class="p" id="_172">And finally let's try out the index:<div class="code" id="_173"><div><pre><code>time psql tmp -c "SELECT s, i FROM fts WHERE s_ts @@ to_tsquery('english', '50000000');"</code></pre></div></div>which "instantly" gives us in 0m0.129s:<div class="code" id="_174"><div><pre><code>                                                   s                                                   | i
-------------------------------------------------------------------------------------------------------+---
 10000000 20000000 50000000 70000000 110000000 130000000 170000000 230000000 290000000 310000000       | 0
 25000000 50000000 125000000 175000000 275000000 325000000 425000000 575000000 725000000 775000000     | 0
 50000000 100000000 250000000 350000000 550000000 650000000 850000000 1150000000 1450000000 1550000000 | 0</code></pre></div></div>so the index worked!</div><div class="p" id="_175">We understand from this that it only find exact word hits.</div><div class="p" id="_176">Another important use case is to search for prefixes of words, e.g. as you'd want in a simple autocompletion system. This can be achieved by adding <code>:*</code> at the end of the search term as in:<div class="code" id="_177"><div><pre><code>time psql tmp -c "SELECT s, i FROM fts WHERE s_ts @@ to_tsquery('english', '50000000:*');"</code></pre></div></div>This finishes in the same amount of time, and gives:<div class="code" id="_178"><div><pre><code>                                                     s                                                     | i
-----------------------------------------------------------------------------------------------------------+----
 10000000 20000000 50000000 70000000 110000000 130000000 170000000 230000000 290000000 310000000           |  0
 38461539 76923078 192307695 269230773 423076929 500000007 653846163 884615397 1115384631 1192307709       | 39
 45454546 90909092 227272730 318181822 500000006 590909098 772727282 1045454558 1318181834 1409090926      | 46
 50000000 100000000 250000000 350000000 550000000 650000000 850000000 1150000000 1450000000 1550000000     |  0
 71428572 142857144 357142860 500000004 785714292 928571436 1214285724 1642857156 2071428588 2214285732    | 72
 100000000 200000000 500000000 700000000 1100000000 1300000000 1700000000 2300000000 2900000000 3100000000 |  0
 29411765 58823530 147058825 205882355 323529415 382352945 500000005 676470595 852941185 911764715         | 65
 25000000 50000000 125000000 175000000 275000000 325000000 425000000 575000000 725000000 775000000         |  0</code></pre></div></div>so now we have cool hits such as <code>500000000</code>, <code>500000004</code>, <code>500000005</code>, <code>500000007</code> and <code>500000006</code>. The syntax is also mentioned at:<div class="list"><ul id="_179"><li id="_180"><a href="https://www.postgresql.org/docs/17/textsearch-controls.html#TEXTSEARCH-PARSING-QUERIES">www.postgresql.org/docs/17/textsearch-controls.html#TEXTSEARCH-PARSING-QUERIES</a></li></ul></div></div><div class="p" id="_181">Next we can also try some other queries with multiple terms. Text must contain two words with <code>&amp;</code>:<div class="code" id="_182"><div><pre><code>time psql tmp -c "SELECT s, i FROM fts WHERE s_ts @@ to_tsquery('english', '50000000 &amp; 175000000');"</code></pre></div></div>gives:<div class="code" id="_183"><div><pre><code>                                                   s                                                   | i
-------------------------------------------------------------------------------------------------------+---
 25000000 50000000 125000000 175000000 275000000 325000000 425000000 575000000 725000000 775000000     | 0</code></pre></div></div></div><div class="p" id="_184">Text can contain either word with <code>|</code>:<div class="code" id="_185"><div><pre><code>time psql tmp -c "SELECT s, i FROM fts WHERE s_ts @@ to_tsquery('english', '50000000 | 175000000');"</code></pre></div></div>gives:<div class="code" id="_186"><div><pre><code>                                                    s                                                    | i
---------------------------------------------------------------------------------------------------------+---
 10000000 20000000 50000000 70000000 110000000 130000000 170000000 230000000 290000000 310000000         | 0
 50000000 100000000 250000000 350000000 550000000 650000000 850000000 1150000000 1450000000 1550000000   | 0
 87500000 175000000 437500000 612500000 962500000 1137500000 1487500000 2012500000 2537500000 2712500000 | 0
 25000000 50000000 125000000 175000000 275000000 325000000 425000000 575000000 725000000 775000000       | 0
 35000000 70000000 175000000 245000000 385000000 455000000 595000000 805000000 1015000000 1085000000     | 0</code></pre></div></div></div><div class="p" id="_187">Text can contain the given words sequentially:<div class="code" id="_188"><div><pre><code>time psql tmp -c "SELECT s, i FROM fts WHERE s_ts @@ to_tsquery('english', '50000000 &lt;-&gt; 125000000 &lt;-&gt; 175000000');"</code></pre></div></div>gives:<div class="code" id="_189"><div><pre><code>                                                   s                                                   | i
-------------------------------------------------------------------------------------------------------+---
 25000000 50000000 125000000 175000000 275000000 325000000 425000000 575000000 725000000 775000000     | 0</code></pre></div></div></div><div class="p" id="_190">We can also inspect how words were split by simply doing a <code>SELECT *</code> again:<div class="code" id="_191"><div><pre><code>             s              | i |                                 s_ts
----------------------------+---+----------------------------------------------------------------------
1 2 5 7 11 13 17 23 29 31   | 1 | '1':1 '11':5 '13':6 '17':7 '2':2 '23':8 '29':9 '31':10 '5':3 '7':4
2 4 10 14 22 26 34 46 58 62 | 2 | '10':3 '14':4 '2':1 '22':5 '26':6 '34':7 '4':2 '46':8 '58':9 '62':10
3 6 15 21 33 39 51 69 87 93 | 3 | '15':3 '21':4 '3':1 '33':5 '39':6 '51':7 '6':2 '69':8 '87':9 '93':10</code></pre></div></div></div><div class="p" id="_192">Let's check if the index updates automatically when we do an insert and if insertion seems to have been significantly slowed down by the index:<div class="code" id="_193"><div><pre><code>time psql tmp -c "INSERT INTO fts VALUES ('abcd efgh', 99)"</code></pre></div></div>finishes in:<div class="code" id="_194"><div><pre><code>real    0m0.043s
user    0m0.014s
sys     0m0.010s</code></pre></div></div>so performance is OK. Presumably, the insertion time is proportional to the number of tokens, doing one logarithmic operation per token, so indexing short chunks of text like titles is easy. And then let's find it:<div class="code" id="_195"><div><pre><code>time psql tmp -c "SELECT s, i FROM fts WHERE s_ts @@ to_tsquery('english', 'efgh');"</code></pre></div></div>which finds it with:<div class="code" id="_196"><div><pre><code>     s     | i
-----------+----
 abcd efgh | 99</code></pre></div></div>so we are all good. Unfortunately, accurate performance benchmarking is a bit harder than that, as the index by default first collects a certain number of updates into memory into the "pending list", before actually inserting them all at once after a certain mass is reached, as documented at: <a href="https://www.postgresql.org/docs/17/gin.html#GIN-IMPLEMENTATION">www.postgresql.org/docs/17/gin.html#GIN-IMPLEMENTATION</a>. We are not going that deep today.</div><div class="p" id="_197">The next thing that we need to understand is how <a href="#to-tsvector"><code>to_tsvector</code></a> <a href="https://ourbigbook.com/go/topic/tokenize">tokenizes</a> strings for the <code>english</code> language. For example running:<div class="code" id="_198"><div><pre><code>psql -c "select to_tsvector('english', 'A Dog run runs fast faster two Cats: b c to from 1 √© befhyph-afthyph.')"</code></pre></div></div>gives:<div class="code" id="_199"><div><pre><code>'1':13
'afthyph':17
'b':9
'befhyph':16
'befhyph-afthyph':15
'c':10
'cat':8
'dog':2
'fast':5
'faster':6
'run':3,4
'two':7
'√©':14</code></pre></div></div>so we understand some of the heuristic normalizations:<div class="list"><ul id="_200"><li id="_201">prepositions like <code>to</code> and <code>from</code> are gone. These are called stopwords as documented at: <a href="https://www.postgresql.org/docs/17/textsearch-controls.html#TEXTSEARCH-PARSING-DOCUMENTS">www.postgresql.org/docs/17/textsearch-controls.html#TEXTSEARCH-PARSING-DOCUMENTS</a></li><li id="_202">words are lowercased and singularized, e.g. <code>Cats</code> becomes <code>cat</code></li><li id="_203">hyphenated words are stored both in separate components and in the full hyphenated form:<div class="list"><ul id="_204"><li id="_205"><code>'afthyph':17</code></li><li id="_206"><code>'befhyph':16</code></li><li id="_207"><code>'befhyph-afthyph':15</code></li></ul></div></li></ul></div></div><div class="p" id="_208">The full list of languages available can be obtained with:<div class="code" id="_209"><div><pre><code>psql -c '\dF'</code></pre></div></div>On <a href="systems-programming#ubuntu-24-10">Ubuntu 24.10</a>, the list contains major world languages, plus the special <code>simple</code> configuration such that:<div class="code" id="_210"><div><pre><code>psql -c "select to_tsvector('simple', 'A Dog run runs fast faster two Cats: b c to from 1 √© befhyph-afthyph.')"</code></pre></div></div>gives:<div class="code" id="_211"><div><pre><code>'1':13
'a':1
'afthyph':17
'b':9
'befhyph':16
'befhyph-afthyph':15
'c':10
'cats':8
'dog':2
'fast':5
'faster':6
'from':12
'run':3
'runs':4
'to':11
'two':7
'√©':14</code></pre></div></div>so we understand that it is similar to <code>english</code> but it does not:<div class="list"><ul id="_212"><li id="_213">seem to have any stopwords</li><li id="_214">do singularization normalization</li></ul></div></div><div class="p" id="_215">From the query side of things, if the query is going to be open to end users on a web interface, we need to understand <code>to_tsquery</code> better. The issue is that <code>to_tsquery</code> is quite brutal and happily throws errors for common things users might do e.g. spaces:<div class="code" id="_216"><div><pre><code>select to_tsquery('english', 'abc def');</code></pre></div></div>giving:<div class="code" id="_217"><div><pre><code>ERROR:  syntax error in tsquery: "abc def"</code></pre></div></div>To avoid such errors, we can use:<div class="list"><ul id="_218"><li id="_219"><code>plainto_tsquery</code>: ANDs everything</li><li id="_220"><code>websearch_to_tsquery</code>: supports <code>AND</code> with spaces, OR with <code>or</code>, word negation with <code>-word</code> and concatenation with <code>"my word"</code>. But it unfortunately does not support prefixing, which is what everyone and their mother wants for autocomplete: <a href="https://stackoverflow.com/questions/14103880/escaping-special-characters-in-to-tsquery#comment78452351_41804957">stackoverflow.com/questions/14103880/escaping-special-characters-in-to-tsquery#comment78452351_41804957</a></li></ul></div>Bibliography:<div class="list"><ul id="_221"><li id="_222"><a href="https://stackoverflow.com/questions/16020164/psqlexception-error-syntax-error-in-tsquery/16020565#16020565">stackoverflow.com/questions/16020164/psqlexception-error-syntax-error-in-tsquery/16020565#16020565</a></li><li id="_223"><a href="https://stackoverflow.com/questions/14103880/escaping-special-characters-in-to-tsquery">stackoverflow.com/questions/14103880/escaping-special-characters-in-to-tsquery</a></li><li id="_224"><a href="https://www.reddit.com/r/rails/comments/1cmloa6/sanitizing_a_search_phrase_when_using_to_tsvector/">www.reddit.com/r/rails/comments/1cmloa6/sanitizing_a_search_phrase_when_using_to_tsvector/</a></li><li id="_225"><a href="https://stackoverflow.com/questions/6735881/to-tsquery-validation">stackoverflow.com/questions/6735881/to-tsquery-validation</a></li><li id="_226"><a href="https://dba.stackexchange.com/questions/135030/filtering-special-characters-in-to-tsquery">dba.stackexchange.com/questions/135030/filtering-special-characters-in-to-tsquery</a></li></ul></div></div><div class="p" id="_227">Also posted at:<div class="list"><ul id="_228"><li id="_229"><a href="https://www.reddit.com/r/PostgreSQL/comments/12yld1o/comment/m3l5nkv/">www.reddit.com/r/PostgreSQL/comments/12yld1o/comment/m3l5nkv/</a> "Is it worth using Postgres' builtin full-text search or should I go straight to Elastic?", high top Google result for "PostgreSQL full text search" as of 2024. Random, but it's there.</li></ul></div></div><div class="h" id="create-a-test-user-in-postgresql"><div class="notnav"><h4><a href="create-a-test-user-in-postgresql">Create a test user in PostgreSQL</a></h4><span class="hover-meta"> <a class="split" href="create-a-test-user-in-postgresql"></a><span class="metrics"><span class="wcntr"> Words: 252</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql" class="u"> PostgreSQL</a><a href="#_toc/create-a-test-user-in-postgresql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/create-a-test-user-in-postgresql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_230">In order to create a test user with password instead of <a href="#peer-authentication">peer authentication</a>, let's create test user:<div class="code" id="_231"><div><pre><code>createuser -P user0
createdb user0</code></pre></div></div><code>-P</code> makes it prompt for the users password.</div><div class="p" id="_232">Alternatively, to create the password non-interactively <a href="https://stackoverflow.com/questions/42419559/postgres-createuser-with-password-from-terminal">stackoverflow.com/questions/42419559/postgres-createuser-with-password-from-terminal</a>:<div class="code" id="_233"><div><pre><code>psql -c "create role NewRole with login password 'secret'"</code></pre></div></div>Can't find a way using the <code>createuser</code> helper.</div><div class="p" id="_234">We can then login with that password with:<div class="code" id="_235"><div><pre><code>psql -U user0 -h localhost</code></pre></div></div>which asks for the password we've just set, because the <code>-h</code> option turns off peer authentication, and turns off password authentication.</div><div class="p" id="_236">The password can be given non-interactively as shown at <a href="https://stackoverflow.com/questions/6405127/how-do-i-specify-a-password-to-psql-non-interactively">stackoverflow.com/questions/6405127/how-do-i-specify-a-password-to-psql-non-interactively</a> with the <code>PGPASSWORD</code> <a href="systems-programming#environment-variable">environment variable</a>:<div class="code" id="_237"><div><pre><code>PGPASSWORD=a psql -U user0 -h localhost</code></pre></div></div></div><div class="p" id="_238">Now let's create a test database which <code>user0</code> can access with an existing superuser account:<div class="code" id="_239"><div><pre><code>createdb user0db0
psql -c 'GRANT ALL PRIVILEGES ON DATABASE user0db0 TO user0'</code></pre></div></div></div><div class="p" id="_240">We can check this permission with:<div class="code" id="_241"><div><pre><code>psql -c '\l'</code></pre></div></div>which now contains:<div class="code" id="_242"><div><pre><code>                                  List of databases
   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges
-----------+----------+----------+-------------+-------------+-----------------------
 user0db0  | ciro     | UTF8     | en_GB.UTF-8 | en_GB.UTF-8 | =Tc/ciro             +
           |          |          |             |             | ciro=CTc/ciro        +
           |          |          |             |             | user0=CTc/ciro</code></pre></div></div>The permission letters are explained at:<div class="list"><ul id="_243"><li id="_244"><a href="https://www.postgresql.org/docs/13/ddl-priv.html">www.postgresql.org/docs/13/ddl-priv.html</a></li><li id="_245"><a href="https://stackoverflow.com/questions/25691037/postgresql-permissions-explained/25691587">stackoverflow.com/questions/25691037/postgresql-permissions-explained/25691587</a></li></ul></div></div><div class="p" id="_246"><code>user0</code> can now do the usual table operations on that table:<div class="code" id="_247"><div><pre><code>PGPASSWORD=a psql -U user0 -h localhost user0db0 -c 'CREATE TABLE table0 (int0 INT, char0 CHAR(16));'
PGPASSWORD=a psql -U user0 -h localhost user0db0 -c "INSERT INTO table0 (int0, char0) VALUES (2, 'two'), (3, 'three'), (5, 'five'), (7, 'seven');"
PGPASSWORD=a psql -U user0 -h localhost user0db0 -c 'SELECT * FROM table0;'</code></pre></div></div></div><div class="h" id="peer-authentication"><div class="notnav"><h4><a href="peer-authentication">Peer authentication</a></h4><span class="hover-meta"> <a class="split" href="peer-authentication"></a><span class="metrics"><span class="wcntr"> Words: 12</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql" class="u"> PostgreSQL</a><a href="#_toc/peer-authentication" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/peer-authentication"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_248"><a href="https://www.postgresql.org/docs/13/auth-peer.html">www.postgresql.org/docs/13/auth-peer.html</a></div><div class="p" id="_249">Uses the name of the current <a href="systems-programming#linux">Linux</a> user to login without a <a href="software#password">password</a>.</div><div class="h" id="postgresql-logging"><div class="notnav"><h4><a href="postgresql-logging">PostgreSQL logging</a></h4><span class="hover-meta"> <a class="split" href="postgresql-logging"></a><span class="metrics"><span class="wcntr"> Words: 44</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql" class="u"> PostgreSQL</a><a href="#_toc/postgresql-logging" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-logging"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_250"><a href="https://stackoverflow.com/questions/722221/how-to-log-postgresql-queries">stackoverflow.com/questions/722221/how-to-log-postgresql-queries</a></div><div class="p" id="_251"><a href="systems-programming#ubuntu-21-10">Ubuntu 21.10</a> has a certain default level of logging by default to:<div class="code" id="_252"><div><pre><code>/var/log/postgresql/postgresql-13-main.log</code></pre></div></div>but it does not log everything, only/mostly errors it seems.</div><div class="p" id="_253">Setting:<div class="code" id="_254"><div><pre><code>log_statement = 'all'</code></pre></div></div>under:<div class="code" id="_255"><div><pre><code>/etc/postgresql/13/main/postgresql.conf</code></pre></div></div>and then restarting the server:<div class="code" id="_256"><div><pre><code>sudo service restart postgresql</code></pre></div></div>just works.</div><div class="p" id="_257">Realtime monitoring for long queries instead: <a href="https://stackoverflow.com/questions/8597516/app-to-monitor-postgresql-queries-in-real-time">stackoverflow.com/questions/8597516/app-to-monitor-postgresql-queries-in-real-time</a></div><div class="h" id="postgresql-serialization-failure"><div class="notnav"><h4><a href="postgresql-serialization-failure">PostgreSQL serialization failure</a></h4><span class="hover-meta"> <a class="split" href="postgresql-serialization-failure"></a><span class="metrics"><span class="wcntr"> Words: 46</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql" class="u"> PostgreSQL</a><a href="#_toc/postgresql-serialization-failure" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-serialization-failure"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_258">When using <a href="#sql-repeatable-read-isolation-level">SQL REPEATABLE READ isolation level</a> and <a href="#sql-serializable-isolation-level">SQL SERIALIZABLE isolation level</a>, concurrent transactions may fail with a serialization failure, and then you might need to retry them. You server code or your ORM must always account for that.</div><div class="p" id="_259">A good way to explore when it happens is to use the example</div><div class="p" id="_260">Related questions:<div class="list"><ul id="_261"><li id="_262"><a href="https://stackoverflow.com/questions/7705273/what-are-the-conditions-for-encountering-a-serialization-failure">stackoverflow.com/questions/7705273/what-are-the-conditions-for-encountering-a-serialization-failure</a></li><li id="_263"><a href="https://stackoverflow.com/questions/59351109/error-could-not-serialize-access-due-to-concurrent-update">stackoverflow.com/questions/59351109/error-could-not-serialize-access-due-to-concurrent-update</a></li><li id="_264"><a href="https://stackoverflow.com/questions/50797097/postgres-could-not-serialize-access-due-to-concurrent-update/51932824">stackoverflow.com/questions/50797097/postgres-could-not-serialize-access-due-to-concurrent-update/51932824</a></li></ul></div></div><div class="h" id="postgresql-function"><div class="notnav"><h4><a href="postgresql-function">PostgreSQL function</a></h4><span class="hover-meta"> <a class="split" href="postgresql-function"></a><span class="metrics"><span class="wcntr"> Words: 25</span><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql" class="u"> PostgreSQL</a><a href="#_toc/postgresql-function" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-function"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="#sql-function">SQL function</a></span></div></nav></div><div class="p" id="_266"><a href="https://www.postgresql.org/docs/17/functions-srf.html">www.postgresql.org/docs/17/functions-srf.html</a></div><div class="h" id="postgresql-generate-series"><div class="notnav"><h5><a href="postgresql-generate-series">PostgreSQL <code>generate_series</code></a></h5><span class="hover-meta"> <a class="split" href="postgresql-generate-series"></a><span class="metrics"><span class="wcntr"> Words: 25</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql-function" class="u"> PostgreSQL function</a><a href="#_toc/postgresql-generate-series" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-generate-series"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_267"><a href="https://www.postgresql.org/docs/17/functions-srf.html">www.postgresql.org/docs/17/functions-srf.html</a></div><div class="p" id="_268">Pattern you always want to generate <a href="#generate-random-text-in-postgresql">Generate random text in PostgreSQL</a>:<div class="code" id="_269"><div><pre><code>CREATE TABLE "mytable" ("i" INTEGER, "j" INTEGER);
INSERT INTO "mytable" SELECT i, i*2 FROM generate_series(1, 10) as s(i);</code></pre></div></div></div><div class="h" id="to-tsvector"><div class="notnav"><h5><a href="to-tsvector"><code>to_tsvector</code></a></h5><span class="hover-meta"> <a class="split" href="to-tsvector"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql-function" class="u"> PostgreSQL function</a><a href="#_toc/to-tsvector" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/to-tsvector"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_270"><a href="https://www.postgresql.org/docs/17/textsearch-controls.html">www.postgresql.org/docs/17/textsearch-controls.html</a></div><div class="h" id="microsoft-sql-server"><div class="notnav"><h3><a href="microsoft-sql-server">Microsoft SQL Server</a></h3><span class="hover-meta"> <a class="split" href="microsoft-sql-server"></a><span class="metrics"><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-implementation" class="u"> SQL implementation</a><a href="#_toc/microsoft-sql-server" class="toc"></a><a href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/microsoft-sql-server"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="transact-sql"><div class="notnav"><h4><a href="transact-sql">Transact-SQL <span class="meta">(T-SQL)</span></a></h4><span class="hover-meta"> <a class="split" href="transact-sql"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#microsoft-sql-server" class="u"> Microsoft SQL Server</a><a href="#_toc/transact-sql" class="toc"></a><a href="https://en.wikipedia.org/wiki/Transact-SQL" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/transact-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="oracle-database"><div class="notnav"><h3><a href="oracle-database">Oracle Database</a></h3><span class="hover-meta"> <a class="split" href="oracle-database"></a><span class="metrics"><span class="wcntr"> Words: 36</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-implementation" class="u"> SQL implementation</a><a href="#_toc/oracle-database" class="toc"></a><a href="https://en.wikipedia.org/wiki/Oracle_Database" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/oracle-database"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_272">Often known simply as SQL Server, a terrible thing that makes it impossible to find portable SQL answers on <a href="google">Google</a>! You just have to Google by specific <a href="#sql-implementation">SQL implementation</a> unfortunately to find anything about the open source ones.</div><div class="h" id="sqlite"><div class="notnav"><h3><a href="sqlite">SQLite</a></h3><span class="hover-meta"> <a class="split" href="sqlite"></a><span class="metrics"><span class="wcntr"> Words: 318</span><span class="dcnt"> Articles: 9</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-implementation" class="u"> SQL implementation</a><a href="#_toc/sqlite" class="toc"></a><a href="https://en.wikipedia.org/wiki/SQLite" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/sqlite"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="cirism#good">Good</a></span></div></nav></div><div class="p" id="_274">The minimalism, serverlessness/lack of temporary caches/lack of permission management, Hipp's religious obsession with efficiency, the use of their own pure Fossil <a href="software#version-control">version control</a><a href="https://sqlite.org/whynotgit.html"><sup class="ref">[ref]</sup></a>. Wait, scrap that last one. Pure beauty!</div><div class="figure"><figure id="_275"><div class="float-wrap"><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/SQLite370.svg/640px-SQLite370.svg.png"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/SQLite370.svg/640px-SQLite370.svg.png" loading="lazy" height="315"></a></div><figcaption><a href="#_275"><span class="caption-prefix">Figure 1. </span></a><a href="https://commons.wikimedia.org/wiki/File:SQLite370.svg.png">Source</a>. </figcaption></figure></div><div class="p" id="_276">Official <a href="software#git">Git</a> mirror: <a href="https://github.com/sqlite/sqlite">github.com/sqlite/sqlite</a></div><div class="p" id="_277">Create a table<div class="code" id="_278"><div><pre><code>sqlite3 db.sqlite3 "
CREATE TABLE 'IntegerNames' (int0 INT, char0 CHAR(16));
INSERT INTO 'IntegerNames' (int0, char0) VALUES (2, 'two'), (3, 'three'), (5, 'five'), (7, 'seven');
"</code></pre></div></div></div><div class="p" id="_279">List tables:<div class="code" id="_280"><div><pre><code>sqlite3 db.sqlite3 '.tables'</code></pre></div></div>output:<div class="code" id="_281"><div><pre><code>IntegerNames</code></pre></div></div></div><div class="p" id="_282">Show schema of a table:<div class="code" id="_283"><div><pre><code>sqlite3 db.sqlite3 '.schema IntegerNames'</code></pre></div></div>outputs the query that would generate that table:<div class="code" id="_284"><div><pre><code>CREATE TABLE IF NOT EXISTS 'IntegerNames' (int0 INT, char0 CHAR(16));</code></pre></div></div></div><div class="p" id="_285">Show all data in a table:<div class="code" id="_286"><div><pre><code>sqlite3 db.sqlite3 'SELECT * FROM IntegerNames'</code></pre></div></div>output:<div class="code" id="_287"><div><pre><code>2|two
3|three
5|five
7|seven</code></pre></div></div></div><div class="p"><b><span title="Tags" class="fa-solid-900 icon">ÔÄ¨</span> Tagged</b><div class="list"><ul><li><a href="systems-programming#d-richard-hipp">D. Richard Hipp</a></li></ul></div></div><div class="h" id="sqlite-import-csv"><div class="notnav"><h4><a href="sqlite-import-csv">SQLite import CSV</a></h4><span class="hover-meta"> <a class="split" href="sqlite-import-csv"></a><span class="metrics"><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sqlite" class="u"> SQLite</a><a href="#_toc/sqlite-import-csv" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sqlite-import-csv"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sqlite-import-csv-from-stdin"><div class="notnav"><h5><a href="sqlite-import-csv-from-stdin">SQLite import CSV from stdin</a></h5><span class="hover-meta"> <a class="split" href="sqlite-import-csv-from-stdin"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sqlite-import-csv" class="u"> SQLite import CSV</a><a href="#_toc/sqlite-import-csv-from-stdin" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sqlite-import-csv-from-stdin"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sqlite-import-json"><div class="notnav"><h4><a href="sqlite-import-json">SQLite import JSON</a></h4><span class="hover-meta"> <a class="split" href="sqlite-import-json"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sqlite" class="u"> SQLite</a><a href="#_toc/sqlite-import-json" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sqlite-import-json"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_288"><li id="_289"><a href="https://stackoverflow.com/questions/46407770/how-to-convert-a-json-file-to-an-sqlite-database">stackoverflow.com/questions/46407770/how-to-convert-a-json-file-to-an-sqlite-database</a></li></ul></div><div class="h" id="sqlite-benchmark"><div class="notnav"><h4><a href="sqlite-benchmark">SQLite benchmark</a></h4><span class="hover-meta"> <a class="split" href="sqlite-benchmark"></a><span class="metrics"><span class="wcntr"> Words: 5</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sqlite" class="u"> SQLite</a><a href="#_toc/sqlite-benchmark" class="toc"></a><a href="https://en.wikipedia.org/wiki/SQLite_benchmark" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/sqlite-benchmark"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_290">Python sequence test data generation: <a href="https://stackoverflow.com/questions/18219779/bulk-insert-huge-data-into-sqlite-using-python/76659706#76659706">stackoverflow.com/questions/18219779/bulk-insert-huge-data-into-sqlite-using-python/76659706#76659706</a></div><div class="h" id="sqlite-c-extension"><div class="notnav"><h4><a href="sqlite-c-extension">SQLite C extension</a></h4><span class="hover-meta"> <a class="split" href="sqlite-c-extension"></a><span class="metrics"><span class="wcntr"> Words: 18</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sqlite" class="u"> SQLite</a><a href="#_toc/sqlite-c-extension" class="toc"></a><a href="https://en.wikipedia.org/wiki/&lt;a_href=&quot;#sqlite&quot;&gt;SQLite&lt;/a&gt;_C_extension" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/sqlite-c-extension"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_291">Example: <a href="_raw/sqlite/ip.c">sqlite/ip.c</a>, adapted from <a href="https://www.sqlite.org/loadext.html">www.sqlite.org/loadext.html</a>, also mentioned explained at: <a href="https://stackoverflow.com/questions/7638238/sqlite-ip-address-storage/76520885#76520885">stackoverflow.com/questions/7638238/sqlite-ip-address-storage/76520885#76520885</a>.</div><div class="p" id="_292">Sample usage in the test program: <a href="_raw/sqlite/test.sh">sqlite/test.sh</a>.</div><div class="p" id="_293">Docs: <a href="https://www.sqlite.org/loadext.html">www.sqlite.org/loadext.html</a></div><div class="h" id="sqlite-isolation-levels"><div class="notnav"><h4><a href="sqlite-isolation-levels">SQLite isolation levels</a></h4><span class="hover-meta"> <a class="split" href="sqlite-isolation-levels"></a><span class="metrics"><span class="wcntr"> Words: 25</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sqlite" class="u"> SQLite</a><a href="#_toc/sqlite-isolation-levels" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sqlite-isolation-levels"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="#sql-transaction-isolation-level">SQL transaction isolation level</a></span></div></nav></div><div class="p" id="_295"><a href="https://www.sqlite.org/pragma.html#pragma_read_uncommitted">www.sqlite.org/pragma.html#pragma_read_uncommitted</a> mentions:</div><div><blockquote id="_296">The default isolation level for SQLite is SERIALIZABLE</blockquote></div><div class="p" id="_297">It does not appear possible to achieve the other two levels besides SERIALIZABLE and READ UNCOMMITED</div><div class="p" id="_298"><a href="https://www.sqlite.org/isolation.html">www.sqlite.org/isolation.html</a></div><div class="h" id="node-js-sqlite-bindings"><div class="notnav"><h4><a href="node-js-sqlite-bindings">Node.js SQLite bindings</a></h4><span class="hover-meta"> <a class="split" href="node-js-sqlite-bindings"></a><span class="metrics"><span class="wcntr"> Words: 160</span><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sqlite" class="u"> SQLite</a><a href="#_toc/node-js-sqlite-bindings" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/node-js-sqlite-bindings"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sqlite3-node-js-package"><div class="notnav"><h5><a href="sqlite3-node-js-package"><code>sqlite3</code> Node.js package</a></h5><span class="hover-meta"> <a class="split" href="sqlite3-node-js-package"></a><span class="metrics"><span class="wcntr"> Words: 111</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#node-js-sqlite-bindings" class="u"> Node.js SQLite bindings</a><a href="#_toc/sqlite3-node-js-package" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sqlite3-node-js-package"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_299"><li id="_300"><a href="https://github.com/mapbox/node-sqlite3">github.com/mapbox/node-sqlite3</a></li><li id="_301"><a href="https://www.npmjs.com/package/sqlite3">www.npmjs.com/package/sqlite3</a></li></ul></div><div class="p" id="_302">Includes its own copy of sqlite3, you don't use the system one, which is good to ensure compatibility. The version is shown at: <a href="https://github.com/mapbox/node-sqlite3/blob/918052b538b0effe6c4a44c74a16b2749c08a0d2/deps/common-sqlite.gypi#L3">github.com/mapbox/node-sqlite3/blob/918052b538b0effe6c4a44c74a16b2749c08a0d2/deps/common-sqlite.gypi#L3</a> <a href="#sqlite">SQLite</a> source is tracked compressed in-tree: <a href="https://github.com/mapbox/node-sqlite3/blob/918052b538b0effe6c4a44c74a16b2749c08a0d2/deps/sqlite-autoconf-3360000.tar.gz">github.com/mapbox/node-sqlite3/blob/918052b538b0effe6c4a44c74a16b2749c08a0d2/deps/sqlite-autoconf-3360000.tar.gz</a> horrendous. This explains why it takes forever to clone that repository. People who don't believe in git submodules, there's even an official Git mirror at: <a href="https://github.com/sqlite/sqlite">github.com/sqlite/sqlite</a></div><div class="p" id="_303">It appears to spawn its own <a href="computer#thread-computing">threads</a> via its <a href="programming-language#c-programming-language">C</a> extension (since <a href="programming-language#javascript-is-single-threaded">JavaScript is single threaded</a> and and <a href="#sqlite">SQLite</a> is not <a href="computer#server-computing">server</a>-based), which allows for parallel queries using multiple threads: <a href="https://github.com/mapbox/node-sqlite3/blob/v5.0.2/src/threading.h">github.com/mapbox/node-sqlite3/blob/v5.0.2/src/threading.h</a></div><div class="p" id="_304">Hello world example: <a href="_raw/nodejs/node-sqlite3/index.js">nodejs/node-sqlite3/index.js</a>.</div><div class="p" id="_305">As of 2021, this had slumped back a bit, as maintainers got tired. Unmerged pull requests started piling more, and <a href="#better-sqlite3-node-js-package"><code>better-sqlite3</code> Node.js package</a> started pulling ahead a little.<div class="list"><ul id="_306"><li id="_307"><a href="https://github.com/mapbox/node-sqlite3/issues/1381">github.com/mapbox/node-sqlite3/issues/1381</a> <code>FATAL ERROR: Error::ThrowAsJavaScriptException napi_throw</code> with <a href="node-js#node-js-worker-threads">Node.js <code>worker_threads</code></a> vs <a href="#better-sqlite3-node-js-package"><code>better-sqlite3</code> Node.js package</a> <a href="https://github.com/JoshuaWise/better-sqlite3/issues/237">github.com/JoshuaWise/better-sqlite3/issues/237</a></li></ul></div></div><div class="h" id="better-sqlite3-node-js-package"><div class="notnav"><h5><a href="better-sqlite3-node-js-package"><code>better-sqlite3</code> Node.js package</a></h5><span class="hover-meta"> <a class="split" href="better-sqlite3-node-js-package"></a><span class="metrics"><span class="wcntr"> Words: 49</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#node-js-sqlite-bindings" class="u"> Node.js SQLite bindings</a><a href="#_toc/better-sqlite3-node-js-package" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/better-sqlite3-node-js-package"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_308">As claimed on their README, their operation truly appears to be 10x faster than the node-sqlite package!! It is insane!! How can that other package still exist at all?</div><div class="p" id="_309">The only big problem was the lack of <a href="software#object-relational-mapping">ORM</a>, but people are looking into that by adding it to <a href="sequelize">Sequelize</a>:<div class="list"><ul id="_310"><li id="_311"><a href="https://github.com/JoshuaWise/better-sqlite3/issues/23">github.com/JoshuaWise/better-sqlite3/issues/23</a></li><li id="_312"><a href="https://github.com/sequelize/sequelize/issues/11400">github.com/sequelize/sequelize/issues/11400</a></li></ul></div></div><div class="h" id="sql-function"><div class="notnav"><h2><a href="sql-function">SQL function</a></h2><span class="hover-meta"> <a class="split" href="sql-function"></a><span class="metrics"><span class="wcntr"> Words: 10</span><span class="dcnt"> Articles: 4</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> SQL</a><a href="#_toc/sql-function" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-function"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p"><b><span title="Tags" class="fa-solid-900 icon">ÔÄ¨</span> Tagged</b><div class="list"><ul><li><a href="#postgresql-function">PostgreSQL function</a></li></ul></div></div><div class="h" id="sql-set-returning-function"><div class="notnav"><h3><a href="sql-set-returning-function">SQL set returning function</a></h3><span class="hover-meta"> <a class="split" href="sql-set-returning-function"></a><span class="metrics"><span class="wcntr"> Words: 1</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-function" class="u"> SQL function</a><a href="#_toc/sql-set-returning-function" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-set-returning-function"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_313"><a href="#postgresql">PostgreSQL</a>: <a href="https://www.postgresql.org/docs/current/functions-srf.html">www.postgresql.org/docs/current/functions-srf.html</a></div><div class="h" id="sql-genenerate-series"><div class="notnav"><h4><a href="sql-genenerate-series">SQL <code>genenerate_series</code></a></h4><span class="hover-meta"> <a class="split" href="sql-genenerate-series"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-set-returning-function" class="u"> SQL set returning function</a><a href="#_toc/sql-genenerate-series" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-genenerate-series"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-aggregate-function"><div class="notnav"><h3><a href="sql-aggregate-function">SQL aggregate function</a></h3><span class="hover-meta"> <a class="split" href="sql-aggregate-function"></a><span class="metrics"><span class="wcntr"> Words: 9</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-function" class="u"> SQL function</a><a href="#_toc/sql-aggregate-function" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-aggregate-function"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-count-function"><div class="notnav"><h4><a href="sql-count-function">SQL <code>COUNT</code> function</a></h4><span class="hover-meta"> <a class="split" href="sql-count-function"></a><span class="metrics"><span class="wcntr"> Words: 9</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-aggregate-function" class="u"> SQL aggregate function</a><a href="#_toc/sql-count-function" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-count-function"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_314">Have a look at some interesting examples under <a href="_raw/nodejs/sequelize/raw/many_to_many.js">nodejs/sequelize/raw/many_to_many.js</a>.</div><div class="h" id="sql-keyword"><div class="notnav"><h2><a href="sql-keyword">SQL keyword</a></h2><span class="hover-meta"> <a class="split" href="sql-keyword"></a><span class="metrics"><span class="wcntr"> Words: 497</span><span class="dcnt"> Articles: 27</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> SQL</a><a href="#_toc/sql-keyword" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-keyword"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-cascade"><div class="notnav"><h3><a href="sql-cascade">SQL CASCADE</a></h3><span class="hover-meta"> <a class="split" href="sql-cascade"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/sql-cascade" class="toc"></a><a href="https://en.wikipedia.org/wiki/SQL_CASCADE" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/sql-cascade"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_315"><a href="https://stackoverflow.com/questions/59297/when-why-to-use-cascading-in-sql-server">stackoverflow.com/questions/59297/when-why-to-use-cascading-in-sql-server</a></div><div class="h" id="delete-sql"><div class="notnav"><h3><a href="delete-sql">DELETE <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="delete-sql"></a><span class="metrics"><span class="wcntr"> Words: 13</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/delete-sql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/delete-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p"><b><span title="Tags" class="fa-solid-900 icon">ÔÄ¨</span> Tagged</b><div class="list"><ul><li><a href="#delete-with-join-sql">DELETE with JOIN</a></li></ul></div></div><div class="h" id="delete-all-duplicate-rows-in-sql"><div class="notnav"><h4><a href="delete-all-duplicate-rows-in-sql">Delete all duplicate rows in SQL</a></h4><span class="hover-meta"> <a class="split" href="delete-all-duplicate-rows-in-sql"></a><span class="metrics"><span class="wcntr"> Words: 13</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#delete-sql" class="u"> DELETE (SQL)</a><a href="#_toc/delete-all-duplicate-rows-in-sql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/delete-all-duplicate-rows-in-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_316"><li id="_317"><a href="#sqlite">SQLite</a> with <code>rowid</code>: <a href="https://stackoverflow.com/questions/8190541/deleting-duplicate-rows-from-sqlite-database">stackoverflow.com/questions/8190541/deleting-duplicate-rows-from-sqlite-database</a><div class="list"><ul id="_318"><li id="_319"><a href="#postgresql">PostgreSQL</a> is <code>ctid</code>: <a href="https://stackoverflow.com/questions/14626481/rowid-equivalent-in-postgres-9-2">stackoverflow.com/questions/14626481/rowid-equivalent-in-postgres-9-2</a></li></ul></div></li><li id="_320"><a href="#oracle-database">SQL Server</a> has crazy "CTEs" change backing table extension: <a href="https://stackoverflow.com/questions/18390574/how-to-delete-duplicate-rows-in-sql-server">stackoverflow.com/questions/18390574/how-to-delete-duplicate-rows-in-sql-server</a></li></ul></div><div class="h" id="group-by-sql"><div class="notnav"><h3><a href="group-by-sql">GROUP BY <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="group-by-sql"></a><span class="metrics"><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/group-by-sql" class="toc"></a><a href="https://en.wikipedia.org/wiki/Group_by_(SQL)" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/group-by-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="having-sql"><div class="notnav"><h4><a href="having-sql">HAVING <span class="meta">(SQL)</span></a></h4><span class="hover-meta"> <a class="split" href="having-sql"></a><span class="metrics"><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#group-by-sql" class="u"> GROUP BY (SQL)</a><a href="#_toc/having-sql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/having-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="having-vs-where"><div class="notnav"><h5><a href="having-vs-where">HAVING vs WHERE</a></h5><span class="hover-meta"> <a class="split" href="having-vs-where"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#having-sql" class="u"> HAVING (SQL)</a><a href="#_toc/having-vs-where" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/having-vs-where"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_321"><li id="_322"><a href="https://www.reddit.com/r/SQL/comments/o3jeis/having_and_where_difference/">www.reddit.com/r/SQL/comments/o3jeis/having_and_where_difference/</a></li><li id="_323"><a href="https://stackoverflow.com/questions/9253244/sql-having-vs-where">stackoverflow.com/questions/9253244/sql-having-vs-where</a></li></ul></div><div class="h" id="insert-sql"><div class="notnav"><h3><a href="insert-sql">INSERT <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="insert-sql"></a><span class="metrics"><span class="wcntr"> Words: 68</span><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/insert-sql" class="toc"></a><a href="https://en.wikipedia.org/wiki/Insert_(SQL)" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/insert-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="upsert"><div class="notnav"><h4><a href="upsert">Upsert <span class="meta">(ON CONFLICT UPDATE)</span></a></h4><span class="hover-meta"> <a class="split" href="upsert"></a><span class="metrics"><span class="wcntr"> Words: 68</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#insert-sql" class="u"> INSERT (SQL)</a><a href="#_toc/upsert" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/upsert"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_325"><code>UPSERT</code> is extremely handy, and reduces the number of find, check on server, update loops. But <code>RETURNING</code> is a fundamental part of that (to get the updated/existing) ID. Can't believe SQL hasn't standardized it yet as of 2022. But both <a href="#sqlite">SQLite</a> and <a href="#postgresql">Postgres</a> support it with similar syntax thankfully.</div><div class="p" id="_326"><a href="_raw/nodejs/sequelize/raw/upsert.js">nodejs/sequelize/raw/upsert.js</a></div><div class="list"><ul id="_327"><li id="_328"><a href="https://www.postgresql.org/docs/14/sql-insert.html#SQL-ON-CONFLICT">www.postgresql.org/docs/14/sql-insert.html#SQL-ON-CONFLICT</a></li><li id="_329"><a href="https://www.sqlite.org/lang_returning.html">www.sqlite.org/lang_returning.html</a></li></ul></div><div class="h" id="upsert-with-not-null-column"><div class="notnav"><h5><a href="upsert-with-not-null-column">Upsert with <code>NOT NULL</code> column</a></h5><span class="hover-meta"> <a class="split" href="upsert-with-not-null-column"></a><span class="metrics"><span class="wcntr"> Words: 21</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#upsert" class="u"> Upsert</a><a href="#_toc/upsert-with-not-null-column" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/upsert-with-not-null-column"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_330">Attempt at <a href="_raw/nodejs/sequelize/raw/upsert.js">nodejs/sequelize/raw/upsert.js</a>:<div class="list"><ul id="_331"><li id="_332"><a href="https://stackoverflow.com/questions/48816629/on-conflict-do-nothing-in-postgres-with-a-not-null-constraint">stackoverflow.com/questions/48816629/on-conflict-do-nothing-in-postgres-with-a-not-null-constraint</a> OP unable to provide a minimal exampe, but it is likely the problem</li><li id="_333"><a href="https://dba.stackexchange.com/questions/292428/postgresql-upsert-issue-with-not-null-columns">dba.stackexchange.com/questions/292428/postgresql-upsert-issue-with-not-null-columns</a></li></ul></div></div><div class="p" id="_334">Related on more complex constraints:<div class="list"><ul id="_335"><li id="_336"><a href="https://dba.stackexchange.com/questions/175182/on-conflict-on-two-columns-where-one-can-be-null">dba.stackexchange.com/questions/175182/on-conflict-on-two-columns-where-one-can-be-null</a></li><li id="_337"><a href="https://dba.stackexchange.com/questions/292428/postgresql-upsert-issue-with-not-null-columns">dba.stackexchange.com/questions/292428/postgresql-upsert-issue-with-not-null-columns</a></li></ul></div></div><div class="h" id="join-sql"><div class="notnav"><h3><a href="join-sql">JOIN <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="join-sql"></a><span class="metrics"><span class="wcntr"> Words: 28</span><span class="dcnt"> Articles: 3</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/join-sql" class="toc"></a><a href="https://en.wikipedia.org/wiki/Join_(SQL)" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/join-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-prefix-column-names-with-the-table-they-came-from"><div class="notnav"><h4><a href="sql-prefix-column-names-with-the-table-they-came-from">SQL prefix column names with the table they came from</a></h4><span class="hover-meta"> <a class="split" href="sql-prefix-column-names-with-the-table-they-came-from"></a><span class="metrics"><span class="wcntr"> Words: 28</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#join-sql" class="u"> JOIN (SQL)</a><a href="#_toc/sql-prefix-column-names-with-the-table-they-came-from" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-prefix-column-names-with-the-table-they-came-from"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_338">It is mind blowing that this is not possible... the only way to avoid ambiguity in JOINs with column name conflicts is to give aliases to each column...</div><div class="list"><ul id="_339"><li id="_340"><a href="https://stackoverflow.com/questions/329931/sql-select-join-is-it-possible-to-prefix-all-columns-as-prefix">stackoverflow.com/questions/329931/sql-select-join-is-it-possible-to-prefix-all-columns-as-prefix</a></li><li id="_341"><a href="https://stackoverflow.com/questions/13153344/in-a-join-how-to-prefix-all-column-names-with-the-table-it-came-from">stackoverflow.com/questions/13153344/in-a-join-how-to-prefix-all-column-names-with-the-table-it-came-from</a></li></ul></div><div class="h" id="inner-join"><div class="notnav"><h4><a href="inner-join">INNER JOIN</a></h4><span class="hover-meta"> <a class="split" href="inner-join"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#join-sql" class="u"> JOIN (SQL)</a><a href="#_toc/inner-join" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/inner-join"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="outer-join"><div class="notnav"><h4><a href="outer-join">OUTER JOIN</a></h4><span class="hover-meta"> <a class="split" href="outer-join"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#join-sql" class="u"> JOIN (SQL)</a><a href="#_toc/outer-join" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/outer-join"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="like-sql"><div class="notnav"><h3><a href="like-sql">LIKE <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="like-sql"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/like-sql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/like-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="select-sql"><div class="notnav"><h3><a href="select-sql">SELECT <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="select-sql"></a><span class="metrics"><span class="wcntr"> Words: 29</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/select-sql" class="toc"></a><a href="https://en.wikipedia.org/wiki/Select_(SQL)" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/select-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="select-for-update"><div class="notnav"><h4><a href="select-for-update">SELECT FOR UPDATE</a></h4><span class="hover-meta"> <a class="split" href="select-for-update"></a><span class="metrics"><span class="wcntr"> Words: 29</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#select-sql" class="u"> SELECT (SQL)</a><a href="#_toc/select-for-update" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/select-for-update"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_342">An example where <code>SELECT FOR UPDATE</code> is a good solution to an use case can be seen at: <a href="#_file/nodejs/sequelize/raw/parallel_select_and_update.js">nodejs/sequelize/raw/parallel_select_and_update.js</a>.</div><div class="p" id="_343"><code>SELECT FOR UPDATE</code> vs/together with the <a href="#sql-transaction-isolation-level">SQL transaction isolation level</a> is commented at: <a href="https://stackoverflow.com/questions/10935850/when-to-use-select-for-update">stackoverflow.com/questions/10935850/when-to-use-select-for-update</a>.</div><div class="h" id="sql-stored-procedure"><div class="notnav"><h3><a href="sql-stored-procedure">SQL stored procedure</a></h3><span class="hover-meta"> <a class="split" href="sql-stored-procedure"></a><span class="metrics"><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/sql-stored-procedure" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-stored-procedure"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="software#stored-procedure">Stored procedure</a></span></div></nav></div><div class="h" id="sql-function-keyword"><div class="notnav"><h4><a href="sql-function-keyword">SQL FUNCTION keyword</a></h4><span class="hover-meta"> <a class="split" href="sql-function-keyword"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-stored-procedure" class="u"> SQL stored procedure</a><a href="#_toc/sql-function-keyword" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-function-keyword"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-procedure"><div class="notnav"><h4><a href="sql-procedure">SQL PROCEDURE</a></h4><span class="hover-meta"> <a class="split" href="sql-procedure"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-stored-procedure" class="u"> SQL stored procedure</a><a href="#_toc/sql-procedure" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-procedure"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-trigger"><div class="notnav"><h3><a href="sql-trigger">SQL TRIGGER</a></h3><span class="hover-meta"> <a class="split" href="sql-trigger"></a><span class="metrics"><span class="wcntr"> Words: 60</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/sql-trigger" class="toc"></a><a href="https://en.wikipedia.org/wiki/SQL_TRIGGER" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/sql-trigger"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="software#database-trigger">Database trigger</a></span></div></nav></div><div class="p" id="_346"><a href="">SQL</a>'s implementation of <a href="software#database-trigger">database triggers</a>.</div><div class="p" id="_347">This feature is really cool, as it allows you to keep caches up to date!</div><div class="p" id="_348">In particular, everything that happens in a trigger happens as if it were in a transaction. This way, you can do less explicit transactions when you use triggers. It is a bit like the advantages of <a href="#sql-cascade">SQL CASCADE</a>.</div><div class="p" id="_349"><a href="software#database-management-system">DBMS</a>:<div class="list"><ul id="_350"><li id="_351"><a href="#postgresql">PostgreSQL</a>:<div class="list"><ul id="_352"><li id="_353"><a href="https://stackoverflow.com/questions/24870416/counter-cache-column-in-postgresql">stackoverflow.com/questions/24870416/counter-cache-column-in-postgresql</a></li></ul></div></li><li id="_354"><a href="#sqlite">SQLite</a><div class="list"><ul id="_355"><li id="_356"><a href="https://stackoverflow.com/questions/35255304/sqlite-create-trigger-for-insert-or-update">stackoverflow.com/questions/35255304/sqlite-create-trigger-for-insert-or-update</a></li></ul></div></li></ul></div></div><div class="p" id="_357"><a href="software#object-relational-mapping">ORM</a>:<div class="list"><ul id="_358"><li id="_359"><a href="sequelize">Sequelize</a>: <a href="sequelize#sql-trigger-in-sequelize">SQL TRIGGER in Sequelize</a></li></ul></div></div><div class="h" id="iso-sql-trigger-syntax"><div class="notnav"><h3><a href="iso-sql-trigger-syntax">ISO SQL TRIGGER syntax</a></h3><span class="hover-meta"> <a class="split" href="iso-sql-trigger-syntax"></a><span class="metrics"><span class="wcntr"> Words: 99</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/iso-sql-trigger-syntax" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/iso-sql-trigger-syntax"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="software#database-trigger">Database trigger</a>, <a href="#sql-standard">SQL standard</a></span></div></nav></div><div class="p" id="_362">TODO what is the standard compliant syntax?</div><div class="p" id="_363"><a href="#postgresql">PostgreSQL</a> requires you to define a <a href="#sql-stored-procedure">SQL stored procedure</a>: <a href="https://stackoverflow.com/questions/28149494/is-it-possible-to-create-trigger-without-execute-procedure-in-postgresql">stackoverflow.com/questions/28149494/is-it-possible-to-create-trigger-without-execute-procedure-in-postgresql</a> Their syntax may be standard compliant, not sure about the <code>EXECUTE</code> part. Their docs: <a href="https://www.postgresql.org/docs/current/sql-createtrigger.html">www.postgresql.org/docs/current/sql-createtrigger.html</a></div><div class="p" id="_364"><a href="#sqlite">SQLite</a> does not support <a href="#sql-stored-procedure">SQL stored procedures</a> at all, so maybe that's why they can't be standard compliant here: <a href="https://stackoverflow.com/questions/3335162/creating-stored-procedure-in-sqlite">stackoverflow.com/questions/3335162/creating-stored-procedure-in-sqlite</a></div><div class="p" id="_365"><a href="#sql-1999">SQL:1999</a> 11.38 covers "Trigger definition". The <a href="computer-science#abstract-syntax-tree">Abstract syntax tree</a> starts with the <code>CREATE TRIGGER</code> and ends in:<div class="code" id="_366"><div><pre><code>&lt;triggered SQL statement&gt; ::=
  &lt;SQL procedure statement&gt;</code></pre></div></div></div><div class="p" id="_367">This is defined at 13.5 "SQL procedure statement", but that is humongous and I'm not sure what it is at all.</div><div class="h" id="_file/nodejs/sequelize/raw/trigger_count.js"><div class="notnav"><span class="file" title="This article is about a file." /><h4><a href="_file/nodejs/sequelize/raw/trigger_count.js">nodejs/sequelize/raw/trigger_count.js</a></h4><span class="hover-meta"> <a class="split" href="_file/nodejs/sequelize/raw/trigger_count.js"></a><span class="metrics"><span class="wcntr"> Words: 16</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#iso-sql-trigger-syntax" class="u"> ISO SQL TRIGGER syntax</a><a href="#_toc/_file/nodejs/sequelize/raw/trigger_count.js" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/_file/nodejs/sequelize/raw/trigger_count.js"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div><div class="nav file"><b> <a href="_dir">(root)</a> / <a href="_dir/nodejs">nodejs</a> / <a href="_dir/nodejs/sequelize">sequelize</a> / <a href="_dir/nodejs/sequelize/raw">raw</a> / <a href="_raw/nodejs/sequelize/raw/trigger_count.js">trigger_count.js</a></b></div></nav></div><div class="p" id="_368">In this example we cache track the number of posts per user on a cache column.</div><div class="p"><b>nodejs/sequelize/raw/trigger_count.js</b> was not rendered because it is too large (&gt; 2000 bytes)</div><div class="h" id="union-sql"><div class="notnav"><h3><a href="union-sql">UNION <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="union-sql"></a><span class="metrics"><span class="wcntr"> Words: 84</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/union-sql" class="toc"></a><a href="https://en.wikipedia.org/wiki/Set_operations_(SQL)#UNION_operator" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/union-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_369">Basic example tested on <a href="#sqlite">SQLite</a> 3.40.1, <a href="systems-programming#ubuntu-23-04">Ubuntu 23.04</a>:<div class="code" id="_370"><div><pre><code>sqlite3 :memory: 'select 1 union select 2'</code></pre></div></div>output:<div class="code" id="_371"><div><pre><code>1
2</code></pre></div></div></div><div class="p" id="_372">Two columns two rows:<div class="code" id="_373"><div><pre><code>sqlite3 :memory: &lt;&lt;EOF
select * from (values (1, 2), (2, 3))
union
select * from (values (2, 3), (3, 4))
EOF</code></pre></div></div>output:<div class="code" id="_374"><div><pre><code>1|2
2|3
3|4</code></pre></div></div></div><div class="p" id="_375">Note how duplicates are removed, to keep them we <code>UNION ALL</code> instead:<div class="code" id="_376"><div><pre><code>sqlite3 :memory: &lt;&lt;EOF
select * from (values (1, 2), (2, 3))
union all
select * from (values (2, 3), (3, 4))
EOF</code></pre></div></div>output:<div class="code" id="_377"><div><pre><code>1|2
2|3
2|3
3|4</code></pre></div></div></div><div class="h" id="update-sql"><div class="notnav"><h3><a href="update-sql">UPDATE <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="update-sql"></a><span class="metrics"><span class="wcntr"> Words: 116</span><span class="dcnt"> Articles: 3</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-keyword" class="u"> SQL keyword</a><a href="#_toc/update-sql" class="toc"></a><a href="https://en.wikipedia.org/wiki/Update_(SQL)" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/update-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="update-multiple-rows-with-different-values-in-a-single-sql-query"><div class="notnav"><h4><a href="update-multiple-rows-with-different-values-in-a-single-sql-query">Update multiple rows with different values in a single SQL query</a></h4><span class="hover-meta"> <a class="split" href="update-multiple-rows-with-different-values-in-a-single-sql-query"></a><span class="metrics"><span class="wcntr"> Words: 34</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#update-sql" class="u"> UPDATE (SQL)</a><a href="#_toc/update-multiple-rows-with-different-values-in-a-single-sql-query" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/update-multiple-rows-with-different-values-in-a-single-sql-query"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_378">This happens when you calculate a bunch of values on your program, and then want to save the to SQL.</div><div class="p" id="_379"><a href="#upsert">Upsert</a> is an option, but it fails if you have a <code>NOT NULL</code> column: <a href="#upsert-with-not-null-column">Upsert with <code>NOT NULL</code> column</a></div><div class="p" id="_380">Bibliography:<div class="list"><ul id="_381"><li id="_382"><a href="https://stackoverflow.com/questions/11563869/update-multiple-rows-with-different-values-in-a-single-sql-query">stackoverflow.com/questions/11563869/update-multiple-rows-with-different-values-in-a-single-sql-query</a></li><li id="_383"><a href="https://dba.stackexchange.com/questions/69269/updating-multiple-rows-with-different-values-in-one-query">dba.stackexchange.com/questions/69269/updating-multiple-rows-with-different-values-in-one-query</a></li></ul></div></div><div class="h" id="update-with-join-sql"><div class="notnav"><h4><a href="update-with-join-sql">UPDATE with JOIN <span class="meta">(SQL)</span></a></h4><span class="hover-meta"> <a class="split" href="update-with-join-sql"></a><span class="metrics"><span class="wcntr"> Words: 82</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#update-sql" class="u"> UPDATE (SQL)</a><a href="#_toc/update-with-join-sql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/update-with-join-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_384">Dumping examples under <a href="_raw/nodejs/sequelize/raw/many_to_many.js">nodejs/sequelize/raw/many_to_many.js</a>.</div><div class="p" id="_385">Not possible without subqueries in the standard syntax, a huge shame: <a href="https://stackoverflow.com/questions/1293330/how-can-i-do-an-update-statement-with-join-in-sql-server">stackoverflow.com/questions/1293330/how-can-i-do-an-update-statement-with-join-in-sql-server</a></div><div class="p" id="_386">The <code>UPDATE</code> + <code>FROM</code> extension exists in a few <a href="software#database-management-system">DBMS</a>s:<div class="list"><ul id="_387"><li id="_388"><a href="#postgresql">PostgreSQL</a>: <a href="https://stackoverflow.com/questions/7869592/how-to-do-an-update-join-in-postgresql">stackoverflow.com/questions/7869592/how-to-do-an-update-join-in-postgresql</a></li><li id="_389"><a href="#sqlite">SQLite</a>: <a href="https://stackoverflow.com/questions/19270259/update-with-join-in-sqlite/69831549#69831549">stackoverflow.com/questions/19270259/update-with-join-in-sqlite/69831549#69831549</a></li></ul></div></div><div class="p" id="_390"><a href="software#object-relational-mapping">ORM</a>:<div class="list"><ul id="_391"><li id="_392"><a href="sequelize">Sequelize</a>: <a href="sequelize#update-with-join-in-sequelize">UPDATE with JOIN in Sequelize</a></li></ul></div></div><div class="p"><b><span title="Tags" class="fa-solid-900 icon">ÔÄ¨</span> Tagged</b><div class="list"><ul><li><a href="sequelize#update-with-join-in-sequelize">UPDATE with JOIN in Sequelize</a></li></ul></div></div><div class="h" id="delete-with-join-sql"><div class="notnav"><h5><a href="delete-with-join-sql">DELETE with JOIN <span class="meta">(SQL)</span></a></h5><span class="hover-meta"> <a class="split" href="delete-with-join-sql"></a><span class="metrics"><span class="wcntr"> Words: 53</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#update-with-join-sql" class="u"> UPDATE with JOIN (SQL)</a><a href="#_toc/delete-with-join-sql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/delete-with-join-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="#delete-sql">DELETE</a></span></div></nav></div><div class="p" id="_394">Demo under: <a href="_raw/nodejs/sequelize/raw/many_to_many.js">nodejs/sequelize/raw/many_to_many.js</a>.</div><div class="p" id="_395">NO way in the <a href="#sql-standard">SQL standard</a> apparently, but you'd hope that implementation status would be similar to <a href="#update-with-join-sql">UPDATE with JOIN</a>, but not even!<div class="list"><ul id="_396"><li id="_397"><a href="#postgresql">PostgreSQL</a>: possible with <code>DELETE FROM USING</code>: <a href="https://stackoverflow.com/questions/11753904/postgresql-delete-with-inner-join">stackoverflow.com/questions/11753904/postgresql-delete-with-inner-join</a></li><li id="_398"><a href="#sqlite">SQLite</a>: not possible without subqueries as of 3.35 far: <a href="https://stackoverflow.com/questions/24511153/how-delete-table-inner-join-with-other-table-in-sqlite">stackoverflow.com/questions/24511153/how-delete-table-inner-join-with-other-table-in-sqlite</a>, Does not appear to have any relevant features at: <a href="https://www.sqlite.org/lang_delete.html">www.sqlite.org/lang_delete.html</a></li></ul></div></div><div class="p" id="_399"><a href="software#object-relational-mapping">ORM</a><div class="list"><ul id="_400"><li id="_401"><a href="sequelize">Sequelize</a>: no support of course: <a href="https://stackoverflow.com/questions/40890131/sequelize-destroy-record-with-join">stackoverflow.com/questions/40890131/sequelize-destroy-record-with-join</a></li></ul></div></div><div class="h" id="sql-standard"><div class="notnav"><h2><a href="sql-standard">SQL standard</a></h2><span class="hover-meta"> <a class="split" href="sql-standard"></a><span class="metrics"><span class="wcntr"> Words: 28</span><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> SQL</a><a href="#_toc/sql-standard" class="toc"></a><a href="https://en.wikipedia.org/wiki/SQL_standard" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/sql-standard"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_402">A quick look at <a href="#postgresql">PostgreSQL</a>'s compliance notes: <a href="https://www.postgresql.org/docs/13/features.html">www.postgresql.org/docs/13/features.html</a> shows the complete utter mess that this standard is. Multiple compliance levels that no one fully implements and optional features everywhere.</div><div class="p"><b><span title="Tags" class="fa-solid-900 icon">ÔÄ¨</span> Tagged</b><div class="list"><ul><li><a href="#iso-sql-trigger-syntax">ISO SQL TRIGGER syntax</a></li></ul></div></div><div class="h" id="sql-standard-version"><div class="notnav"><h3><a href="sql-standard-version">SQL standard version</a></h3><span class="hover-meta"> <a class="split" href="sql-standard-version"></a><span class="metrics"><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-standard" class="u"> SQL standard</a><a href="#_toc/sql-standard-version" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-standard-version"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-1999"><div class="notnav"><h4><a href="sql-1999">SQL:1999</a></h4><span class="hover-meta"> <a class="split" href="sql-1999"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-standard-version" class="u"> SQL standard version</a><a href="#_toc/sql-1999" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-1999"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-application"><div class="notnav"><h2><a href="sql-application">SQL application</a></h2><span class="hover-meta"> <a class="split" href="sql-application"></a><span class="metrics"><span class="wcntr"> Words: 526</span><span class="dcnt"> Articles: 5</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> SQL</a><a href="#_toc/sql-application" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-application"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-histogram"><div class="notnav"><h3><a href="sql-histogram">SQL histogram</a></h3><span class="hover-meta"> <a class="split" href="sql-histogram"></a><span class="metrics"><span class="wcntr"> Words: 439</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-application" class="u"> SQL application</a><a href="#_toc/sql-histogram" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-histogram"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_403">OK, there's a billion questions:<div class="list"><ul id="_404"><li id="_405"><a href="#oracle-database">SQL Server</a><div class="list"><ul id="_406"><li id="_407"><a href="https://stackoverflow.com/questions/485409/generating-a-histogram-from-column-values-in-a-database">stackoverflow.com/questions/485409/generating-a-histogram-from-column-values-in-a-database</a> OP did not know the difference between count and histogram :-) But it's the number one Google result.</li><li id="_408"><a href="https://stackoverflow.com/questions/19103991/create-range-bins-from-sql-server-table-for-histograms">stackoverflow.com/questions/19103991/create-range-bins-from-sql-server-table-for-histograms</a> has a minor extra group by twist, but otherwise fine</li><li id="_409"><a href="https://stackoverflow.com/questions/16268441/generate-histogram-in-sql-server">stackoverflow.com/questions/16268441/generate-histogram-in-sql-server</a></li></ul></div></li><li id="_410"><a href="#sqlite">SQLite</a><div class="list"><ul id="_411"><li id="_412"><a href="https://stackoverflow.com/questions/67514208/how-to-optimise-creating-histogram-bins-in-sqlite">stackoverflow.com/questions/67514208/how-to-optimise-creating-histogram-bins-in-sqlite</a> perf only, benchmarking would be needed. <a href="#sqlite">SQLite</a>.</li><li id="_413"><a href="https://stackoverflow.com/questions/32155449/create-a-histogram-with-a-dynamic-number-of-partitions-in-sqlite">stackoverflow.com/questions/32155449/create-a-histogram-with-a-dynamic-number-of-partitions-in-sqlite</a> variable bin size, same number of entries per bin</li><li id="_414"><a href="https://stackoverflow.com/questions/60348109/histogram-for-time-periods-using-sqlite-regular-buckets-1h-wide">stackoverflow.com/questions/60348109/histogram-for-time-periods-using-sqlite-regular-buckets-1h-wide</a> time</li></ul></div></li><li id="_415"><a href="#mysql">MySQL</a>: <a href="https://stackoverflow.com/questions/1764881/getting-data-for-histogram-plot">stackoverflow.com/questions/1764881/getting-data-for-histogram-plot</a> MySQL appears to extend <code>ROUND</code> to also round by integers: <code>ROUND(numeric_value, -2)</code>, but this is not widely portable which is a shame</li><li id="_416"><a href="https://stackoverflow.com/questions/72367652/populating-empty-bins-in-a-histogram-generated-using-sql">stackoverflow.com/questions/72367652/populating-empty-bins-in-a-histogram-generated-using-sql</a> specifically asks about empty bins, which is amazing. <a href="computer-hardware#amazon-redshift">Amazon Redshift</a> dialect unfortunately, but answer provided works widely, and Redshift was forked from <a href="#postgresql">PostgreSQL</a>, so there's hope. Those newb <a href="software#open-source-software">open source</a> server focused projects that don't use <a href="law#affero-general-public-license">AGPL</a>!</li></ul></div></div><div class="p" id="_417">Let's try it on <a href="#sqlite">SQLite</a> 3.40.1, <a href="systems-programming#ubuntu-23-04">Ubuntu 23.04</a>. Data setup:<div class="code" id="_418"><div><pre><code>sqlite3 tmp.sqlite 'create table t(x integer)'
sqlite3 tmp.sqlite &lt;&lt;EOF
insert into t values (
  0,
  2,
  2,
  3,

  5,
  6,
  6,
  8,
  9,

  17,
)
EOF
sqlite3 tmp.sqlite 'create index tx on t(x)'</code></pre></div></div></div><div class="p" id="_419">For a bin size of 5 ignoring empty ranges we can:<div class="code" id="_420"><div><pre><code>sqlite3 tmp.sqlite &lt;&lt;EOF
select floor(x/5)*5 as x,
       count(*) as cnt
from t
group by 1
order by 1
EOF</code></pre></div></div>which produces the desired:<div class="code" id="_421"><div><pre><code>0|4
5|5
15|1</code></pre></div></div></div><div class="p" id="_422">And to consider empty ranges we can use <a href="#sql-genenerate-series">SQL <code>genenerate_series</code></a> + as per <a href="https://stackoverflow.com/questions/72367652/populating-empty-bins-in-a-histogram-generated-using-sql">stackoverflow.com/questions/72367652/populating-empty-bins-in-a-histogram-generated-using-sql</a>:<div class="code" id="_423"><div><pre><code>sqlite3 tmp.sqlite &lt;&lt;EOF
select x, sum(cnt) from (
  select floor(x/5)*5 as x,
         count(*) as cnt
    from t
    group by 1
  union
  select *, 0 as cnt from generate_series(0, 15, 5)
)
group by x
EOF</code></pre></div></div>which outputs the desired:<div class="code" id="_424"><div><pre><code>0|4
5|5
10|0
15|1</code></pre></div></div></div><div class="h" id="sql-2d-histogram"><div class="notnav"><h4><a href="sql-2d-histogram">SQL 2D histogram</a></h4><span class="hover-meta"> <a class="split" href="sql-2d-histogram"></a><span class="metrics"><span class="wcntr"> Words: 199</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-histogram" class="u"> SQL histogram</a><a href="#_toc/sql-2d-histogram" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-2d-histogram"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_425">Let's try it on <a href="#sqlite">SQLite</a> 3.40.1, <a href="systems-programming#ubuntu-23-04">Ubuntu 23.04</a>. Data setup:<div class="code" id="_426"><div><pre><code>sqlite3 tmp.sqlite 'create table t(x integer, y integer)'
sqlite3 tmp.sqlite &lt;&lt;EOF
insert into t values
  (0, 0),
  (1, 1),
  (2, 2),
  (3, 3),
  (4, 4),
  (5, 5),
  (6, 6),
  (7, 7),
  (8, 8),
  (9, 9),
  (10, 10),
  (11, 11),
  (12, 12),
  (13, 13),
  (14, 14),
  (15, 15),
  (16, 16),
  (17, 17),
  (18, 18),
  (19, 19),

  (2, 18)
EOF
sqlite3 tmp.sqlite 'create index txy on t(x, y)'</code></pre></div></div></div><div class="p" id="_427">For a bin size of 5 ignoring empty ranges we can:<div class="code" id="_428"><div><pre><code>sqlite3 tmp.sqlite &lt;&lt;EOF
select
  floor(x/5)*5 as x,
  floor(y/5)*5 as y,
  count(*) as cnt
from t
group by 1, 2
order by 1, 2
EOF</code></pre></div></div>which produces the desired:<div class="code" id="_429"><div><pre><code>0|0|5
0|15|1
5|5|5
10|10|5
15|15|5</code></pre></div></div></div><div class="p" id="_430">And to consider empty ranges we can use <a href="#sql-genenerate-series">SQL <code>genenerate_series</code></a> + as per <a href="https://stackoverflow.com/questions/72367652/populating-empty-bins-in-a-histogram-generated-using-sql">stackoverflow.com/questions/72367652/populating-empty-bins-in-a-histogram-generated-using-sql</a>:<div class="code" id="_431"><div><pre><code>sqlite3 tmp.sqlite &lt;&lt;EOF
select x, y, sum(cnt) from (
  select
      floor(x/5)*5 as x,
      floor(y/5)*5 as y,
      count(*) as cnt
    from t
    group by 1, 2
  union
  select *, 0 as cnt from generate_series(0, 15, 5) inner join (select * from generate_series(0, 15, 5))
)
group by x, y
EOF</code></pre></div></div>which outputs the desired:<div class="code" id="_432"><div><pre><code>0|0|5
0|5|0
0|10|0
0|15|1
5|0|0
5|5|5
5|10|0
5|15|0
10|0|0
10|5|0
10|10|5
10|15|0
15|0|0
15|5|0
15|10|0
15|15|5</code></pre></div></div></div><div class="h" id="sql-tree-traversal"><div class="notnav"><h3><a href="sql-tree-traversal">SQL tree traversal</a></h3><span class="hover-meta"> <a class="split" href="sql-tree-traversal"></a><span class="metrics"><span class="wcntr"> Words: 87</span><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-application" class="u"> SQL application</a><a href="#_toc/sql-tree-traversal" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-tree-traversal"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="mathematics#tree-traversal">Tree traversal</a></span></div></nav></div><div class="p" id="_434">Example: <a href="_raw/nodejs/sequelize/raw/tree.js">nodejs/sequelize/raw/tree.js</a></div><div class="list"><ul id="_435"><li id="_436">Implementation agnostic<div class="list"><ul id="_437"><li id="_438"><a href="https://stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree">stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree</a></li><li id="_439"><a href="https://stackoverflow.com/questions/5508985/recursive-query-for-adjacency-list-to-preorder-tree-traversal-in-sql">stackoverflow.com/questions/5508985/recursive-query-for-adjacency-list-to-preorder-tree-traversal-in-sql</a> DBMS agnostic specifically asking not to modify <a href="mathematics#adjacency-list">adjacency list</a> data structure</li></ul></div></li><li id="_440"><a href="#postgresql">Postgres</a><div class="list"><ul id="_441"><li id="_442"><a href="https://stackoverflow.com/questions/67848017/simple-recursive-sql-query">stackoverflow.com/questions/67848017/simple-recursive-sql-query</a></li><li id="_443"><a href="https://stackoverflow.com/questions/28688264/how-to-traverse-a-hierarchical-tree-structure-structure-backwards-using-recursiv">stackoverflow.com/questions/28688264/how-to-traverse-a-hierarchical-tree-structure-structure-backwards-using-recursiv</a></li><li id="_444"><a href="https://stackoverflow.com/questions/51822070/how-can-postgres-represent-a-tree-of-row-ids">stackoverflow.com/questions/51822070/how-can-postgres-represent-a-tree-of-row-ids</a></li><li id="_445">depth first<div class="list"><ul id="_446"><li id="_447">uspecified depth first variant<div class="list"><ul id="_448"><li id="_449"><a href="https://stackoverflow.com/questions/50098759/postgres-nested-records-in-a-recursive-query-in-depth-first-manner">stackoverflow.com/questions/50098759/postgres-nested-records-in-a-recursive-query-in-depth-first-manner</a></li><li id="_450"><a href="https://stackoverflow.com/questions/59463176/how-to-perform-depth-first-search-in-postgresql">stackoverflow.com/questions/59463176/how-to-perform-depth-first-search-in-postgresql</a></li><li id="_451"><a href="https://stackoverflow.com/questions/30336265/postgresql-recursive-cte-results-ordering">stackoverflow.com/questions/30336265/postgresql-recursive-cte-results-ordering</a></li></ul></div></li><li id="_452"><a href="mathematics#pre-order-depth-first-search">preorder DFS</a><div class="list"><ul id="_453"><li id="_454"><a href="https://dba.stackexchange.com/questions/63153/how-do-i-sort-the-results-of-a-recursive-query-in-an-expanded-tree-like-fashion">dba.stackexchange.com/questions/63153/how-do-i-sort-the-results-of-a-recursive-query-in-an-expanded-tree-like-fashion</a></li><li id="_455"><a href="https://stackoverflow.com/questions/65247873/preorder-tree-traversal-using-recursive-ctes-in-sql/77276675#77276675">stackoverflow.com/questions/65247873/preorder-tree-traversal-using-recursive-ctes-in-sql/77276675#77276675</a></li></ul></div></li></ul></div></li><li id="_456"><a href="mathematics#breadth-first-search">breadth-first</a> <a href="https://stackoverflow.com/questions/3709292/select-rows-from-table-using-tree-order">stackoverflow.com/questions/3709292/select-rows-from-table-using-tree-order</a></li></ul></div></li><li id="_457"><a href="#mysql">MySQL</a><div class="list"><ul id="_458"><li id="_459"><a href="https://stackoverflow.com/questions/8252323/mysql-closure-table-hierarchical-database-how-to-pull-information-out-in-the-c">stackoverflow.com/questions/8252323/mysql-closure-table-hierarchical-database-how-to-pull-information-out-in-the-c</a> asks how to use a specific order (<a href="mathematics#pre-order-depth-first-search">preorder DFS</a>) with <a href="#closure-table">closure table</a></li></ul></div></li><li id="_460"><a href="#microsoft-sql-server">Microsoft SQL Server</a><div class="list"><ul id="_461"><li id="_462"><a href="https://stackoverflow.com/questions/14274942/sql-server-cte-and-recursion-example">stackoverflow.com/questions/14274942/sql-server-cte-and-recursion-example</a></li></ul></div></li></ul></div><div class="h" id="closure-table"><div class="notnav"><h4><a href="closure-table">Closure table</a></h4><span class="hover-meta"> <a class="split" href="closure-table"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-tree-traversal" class="u"> SQL tree traversal</a><a href="#_toc/closure-table" class="toc"></a><a href="https://en.wikipedia.org/wiki/Closure_table" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/closure-table"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="nested-set-model-in-sql"><div class="notnav"><h4><a href="nested-set-model-in-sql">Nested set model in SQL <span class="meta">(Nested set index)</span></a></h4><span class="hover-meta"> <a class="split" href="nested-set-model-in-sql"></a><span class="metrics"><span class="wcntr"> Words: 59</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-tree-traversal" class="u"> SQL tree traversal</a><a href="#_toc/nested-set-model-in-sql" class="toc"></a><a href="https://en.wikipedia.org/wiki/Nested_set_model_in_SQL" class="wiki"></a><a href="https://ourbigbook.com/cirosantilli/nested-set-model-in-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_464">How to implement <a href="mathematics#nested-set-model">Nested set model</a> in <a href="">SQL</a>:<div class="list"><ul id="_465"><li id="_466"><a href="https://stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree/42781302#42781302">stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree/42781302#42781302</a> contains the correct left/size representation and update queries, which makes it much easier to maintain the tree without having to worry about the sizes of siblings which are constant</li><li id="_467"><a href="https://stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree/194031#194031">stackoverflow.com/questions/192220/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree/194031#194031</a> amazing ASCII art representations of the structure. Unfortunately uses a wonky left/right representation, rather than the much more natural left/size representation from the other post</li></ul></div></div><div class="h" id="sql-feature"><div class="notnav"><h2><a href="sql-feature">SQL feature</a></h2><span class="hover-meta"> <a class="split" href="sql-feature"></a><span class="metrics"><span class="wcntr"> Words: 2k</span><span class="dcnt"> Articles: 26</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> SQL</a><a href="#_toc/sql-feature" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-feature"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="generated-column"><div class="notnav"><h3><a href="generated-column">Generated column</a></h3><span class="hover-meta"> <a class="split" href="generated-column"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-feature" class="u"> SQL feature</a><a href="#_toc/generated-column" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/generated-column"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-recursive-query"><div class="notnav"><h3><a href="sql-recursive-query">SQL RECURSIVE query</a></h3><span class="hover-meta"> <a class="split" href="sql-recursive-query"></a><span class="metrics"><span class="wcntr"> Words: 11</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-feature" class="u"> SQL feature</a><a href="#_toc/sql-recursive-query" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-recursive-query"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_468">Minimal example: <a href="_raw/nodejs/sequelize/raw/recursive.js">nodejs/sequelize/raw/recursive.js</a></div><div class="p" id="_469">More advanced <a href="#sql-tree-traversal">SQL tree traversal</a> examples: <a href="_raw/nodejs/sequelize/raw/tree.js">nodejs/sequelize/raw/tree.js</a></div><div class="p" id="_470"><a href="#postgresql">PostgreSQL</a> docs: <a href="https://www.postgresql.org/docs/16/queries-with.html#QUERIES-WITH-RECURSIVE">www.postgresql.org/docs/16/queries-with.html#QUERIES-WITH-RECURSIVE</a></div><div class="h" id="sql-recursive-prevent-infinite-recursion"><div class="notnav"><h4><a href="sql-recursive-prevent-infinite-recursion">SQL RECURSIVE prevent infinite recursion</a></h4><span class="hover-meta"> <a class="split" href="sql-recursive-prevent-infinite-recursion"></a><span class="metrics"><span class="wcntr"> Words: 5</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-recursive-query" class="u"> SQL RECURSIVE query</a><a href="#_toc/sql-recursive-prevent-infinite-recursion" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-recursive-prevent-infinite-recursion"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_471">Example under: <a href="_raw/nodejs/sequelize/raw/tree.js">nodejs/sequelize/raw/tree.js</a></div><div class="list"><ul id="_472"><li id="_473"><a href="https://stackoverflow.com/questions/31739150/to-find-infinite-recursive-loop-in-cte">stackoverflow.com/questions/31739150/to-find-infinite-recursive-loop-in-cte</a> Canon.</li><li id="_474"><a href="#postgresql">PostgreSQL</a><div class="list"><ul id="_475"><li id="_476"><a href="https://stackoverflow.com/questions/26671612/prevent-and-or-detect-cycles-in-postgres?noredirect=1&amp;lq=1">stackoverflow.com/questions/26671612/prevent-and-or-detect-cycles-in-postgres?noredirect=1&amp;lq=1</a></li><li id="_477"><a href="https://stackoverflow.com/questions/39555616/detect-cycles-using-sql">stackoverflow.com/questions/39555616/detect-cycles-using-sql</a></li></ul></div></li><li id="_478"><a href="#sqlite">SQLite</a>:<div class="list"><ul id="_479"><li id="_480"><a href="https://dba.stackexchange.com/questions/310874/check-a-record-exists-already-and-stop-the-loop-in-a-recursive-query">dba.stackexchange.com/questions/310874/check-a-record-exists-already-and-stop-the-loop-in-a-recursive-query</a></li><li id="_481"><a href="https://stackoverflow.com/questions/66866542/sqlite-avoiding-cycles-in-depth-limited-recursive-cte">stackoverflow.com/questions/66866542/sqlite-avoiding-cycles-in-depth-limited-recursive-cte</a></li></ul></div></li><li id="_482"><a href="#oracle-database">SQL Server</a>:<div class="list"><ul id="_483"><li id="_484"><a href="https://stackoverflow.com/questions/58326847/sql-recursion-cte-infinite-loop">stackoverflow.com/questions/58326847/sql-recursion-cte-infinite-loop</a></li><li id="_485"><a href="https://dba.stackexchange.com/questions/215426/simple-recursive-cte-stuck-in-infinite-loop">dba.stackexchange.com/questions/215426/simple-recursive-cte-stuck-in-infinite-loop</a></li><li id="_486"><a href="https://stackoverflow.com/questions/13718168/infinite-loop-in-cte-when-parsing-self-referencing-table">stackoverflow.com/questions/13718168/infinite-loop-in-cte-when-parsing-self-referencing-table</a></li></ul></div></li></ul></div><div class="h" id="sql-spatial-index"><div class="notnav"><h3><a href="sql-spatial-index">SQL spatial index</a></h3><span class="hover-meta"> <a class="split" href="sql-spatial-index"></a><span class="metrics"><span class="wcntr"> Words: 151</span><span class="dcnt"> Articles: 3</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-feature" class="u"> SQL feature</a><a href="#_toc/sql-spatial-index" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-spatial-index"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="postgresql-spatial-index"><div class="notnav"><h4><a href="postgresql-spatial-index">PostgreSQL spatial index</a></h4><span class="hover-meta"> <a class="split" href="postgresql-spatial-index"></a><span class="metrics"><span class="wcntr"> Words: 151</span><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-spatial-index" class="u"> SQL spatial index</a><a href="#_toc/postgresql-spatial-index" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-spatial-index"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="postgresql-gist"><div class="notnav"><h5><a href="postgresql-gist">PostgreSQL GIST</a></h5><span class="hover-meta"> <a class="split" href="postgresql-gist"></a><span class="metrics"><span class="wcntr"> Words: 136</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql-spatial-index" class="u"> PostgreSQL spatial index</a><a href="#_toc/postgresql-gist" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgresql-gist"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_487"><li id="_488"><a href="https://www.postgresql.org/docs/15/gist.html">www.postgresql.org/docs/15/gist.html</a></li><li id="_489"><a href="https://www.postgresql.org/docs/15/datatype-geometric.html">www.postgresql.org/docs/15/datatype-geometric.html</a></li><li id="_490"><a href="https://medium.com/postgres-professional/indexes-in-postgresql-5-gist-86e19781b5db">medium.com/postgres-professional/indexes-in-postgresql-5-gist-86e19781b5db</a> the only example on the net!</li></ul></div><div class="p" id="_491">The highly underdocumented built-in module, that supports <a href="#sql-spatial-index">SQL spatial index</a> and a lot more.</div><div class="p" id="_492">Quite horrendous as it only seems to work on geometric types and not existing columns. But why.</div><div class="p" id="_493">And it uses custom operatores, where standard operators would have been just fine for points...</div><div class="p" id="_494">Minimal runnable example with points:<div class="code" id="_495"><div><pre><code>set -x
time psql -c 'drop table if exists t'
time psql -c 'create table t(p point)'
time psql -c "insert into t select (point ('(' || generate_series || ',' || generate_series || ')')) from generate_series(1, 10000000)"
time psql -c 'create index on t using gist(p)'
time psql -c "select count(*) from t where p &lt;@ box '(1000000,1000000),(9000000,2000000)'"</code></pre></div></div>The index creation unfortunately took 100s, so it will not scale to 1B points very well whic his a shame.</div><div class="p" id="_496">Some sources about it:<div class="list"><ul id="_497"><li id="_498"><a href="https://stackoverflow.com/questions/28292198/how-to-port-simple-spatial-index-using-sqlite-r-trees-to-postgres">stackoverflow.com/questions/28292198/how-to-port-simple-spatial-index-using-sqlite-r-trees-to-postgres</a></li></ul></div></div><div class="h" id="postgis"><div class="notnav"><h5><a href="postgis">PostGIS</a></h5><span class="hover-meta"> <a class="split" href="postgis"></a><span class="metrics"><span class="wcntr"> Words: 15</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#postgresql-spatial-index" class="u"> PostgreSQL spatial index</a><a href="#_toc/postgis" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/postgis"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_499"><a href="http://postgis.net/">postgis.net/</a></div><div class="p" id="_500">The third part module, which clutters up any serches you make for the built-in one.</div><div class="h" id="sql-subquery"><div class="notnav"><h3><a href="sql-subquery">SQL subquery <span class="meta">(CTE)</span></a></h3><span class="hover-meta"> <a class="split" href="sql-subquery"></a><span class="metrics"><span class="wcntr"> Words: 67</span><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-feature" class="u"> SQL feature</a><a href="#_toc/sql-subquery" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-subquery"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="common-table-expression"><div class="notnav"><h4><a href="common-table-expression">Common Table Expression <span class="meta">(CTE)</span></a></h4><span class="hover-meta"> <a class="split" href="common-table-expression"></a><span class="metrics"><span class="wcntr"> Words: 67</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-subquery" class="u"> SQL subquery</a><a href="#_toc/common-table-expression" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/common-table-expression"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_503">Similar to <a href="#sql-subquery">SQL subquery</a>, but with some differences: <a href="https://stackoverflow.com/questions/706972/difference-between-cte-and-subquery">stackoverflow.com/questions/706972/difference-between-cte-and-subquery</a></div><div class="code" id="_504"><div><pre><code>rm -f tmp.sqlite
sqlite3 tmp.sqlite 'create table t(i integer)'
sqlite3 tmp.sqlite 'insert into t values (1), (2)'
sqlite3 tmp.sqlite 'with mycte as ( select * from t ) delete from mycte where i = 1'
sqlite3 tmp.sqlite 'select * from t'</code></pre></div></div><div class="h" id="cte-insert-values"><div class="notnav"><h5><a href="cte-insert-values">CTE insert values</a></h5><span class="hover-meta"> <a class="split" href="cte-insert-values"></a><span class="metrics"><span class="wcntr"> Words: 19</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#common-table-expression" class="u"> Common Table Expression</a><a href="#_toc/cte-insert-values" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/cte-insert-values"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_505">Useful for testing: <a href="https://stackoverflow.com/questions/21819183/how-to-use-ctes-with-update-delete-on-sqlite">stackoverflow.com/questions/21819183/how-to-use-ctes-with-update-delete-on-sqlite</a></div><div class="code" id="_506"><div><pre><code>sqlite3 :memory: 'WITH t (i, j) AS (VALUES (1, -1), (2, -2)) SELECT * FROM t'</code></pre></div></div><div class="h" id="sql-transaction"><div class="notnav"><h3><a href="sql-transaction">SQL transaction</a></h3><span class="hover-meta"> <a class="split" href="sql-transaction"></a><span class="metrics"><span class="wcntr"> Words: 2k</span><span class="dcnt"> Articles: 11</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-feature" class="u"> SQL feature</a><a href="#_toc/sql-transaction" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-transaction"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-transaction-isolation-level"><div class="notnav"><h4><a href="sql-transaction-isolation-level">SQL transaction isolation level</a></h4><span class="hover-meta"> <a class="split" href="sql-transaction-isolation-level"></a><span class="metrics"><span class="wcntr"> Words: 2k</span><span class="dcnt"> Articles: 10</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-transaction" class="u"> SQL transaction</a><a href="#_toc/sql-transaction-isolation-level" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-transaction-isolation-level"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_507">Each transaction isolation level specifies what can or cannot happen when two queries are being run in parallel, i.e.: the <a href="computer#memory-semantics">memory semantics</a> of the system.</div><div class="p" id="_508">Remember that queries can affects thousands of rows, and database systems like <a href="#postgresql">PostgreSQL</a> can run multiple such queries at the same time.</div><div class="p" id="_509">Good summary on the <a href="#postgresql">PostgreSQL</a> page: <a href="https://www.postgresql.org/docs/14/transaction-iso.html">www.postgresql.org/docs/14/transaction-iso.html</a></div><div class="p" id="_510">Implementation specifics:<div class="list"><ul id="_511"><li id="_512"><a href="#sqlite-isolation-levels">SQLite isolation levels</a></li></ul></div></div><div class="p"><b><span title="Tags" class="fa-solid-900 icon">ÔÄ¨</span> Tagged</b><div class="list"><ul><li><a href="#sqlite-isolation-levels">SQLite isolation levels</a></li></ul></div></div><div class="h" id="sql-read-uncommitted-isolation-level"><div class="notnav"><h5><a href="sql-read-uncommitted-isolation-level">SQL READ UNCOMMITTED isolation level</a></h5><span class="hover-meta"> <a class="split" href="sql-read-uncommitted-isolation-level"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a><a href="#_toc/sql-read-uncommitted-isolation-level" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-read-uncommitted-isolation-level"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-read-committed-isolation-level"><div class="notnav"><h5><a href="sql-read-committed-isolation-level">SQL READ COMMITTED isolation level</a></h5><span class="hover-meta"> <a class="split" href="sql-read-committed-isolation-level"></a><span class="metrics"><span class="wcntr"> Words: 7</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a><a href="#_toc/sql-read-committed-isolation-level" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-read-committed-isolation-level"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_513">Example where this level is sufficient: <a href="#_file/nodejs/sequelize/raw/parallel_update_async.js">nodejs/sequelize/raw/parallel_update_async.js</a>.</div><div class="h" id="sql-repeatable-read-isolation-level"><div class="notnav"><h5><a href="sql-repeatable-read-isolation-level">SQL REPEATABLE READ isolation level</a></h5><span class="hover-meta"> <a class="split" href="sql-repeatable-read-isolation-level"></a><span class="metrics"><span class="wcntr"> Words: 70</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a><a href="#_toc/sql-repeatable-read-isolation-level" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-repeatable-read-isolation-level"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_514">Vs <a href="#sql-serializable-isolation-level">SQL SERIALIZABLE isolation level</a> on <a href="#postgresql">PostgreSQL</a>: <a href="https://dba.stackexchange.com/questions/284744/postgres-repeatable-read-vs-serializable">dba.stackexchange.com/questions/284744/postgres-repeatable-read-vs-serializable</a></div><div class="p" id="_515"><a href="#_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js">nodejs/sequelize/raw/parallel_create_delete_empty_tag.js</a> is an example which experimentally seems to be solved by <code>REAPEATABLE READ</code>, although we are not sure that this is truly the case and why. What is clear is that that example is not solved by the <a href="#sql-read-committed-isolation-level">SQL READ COMMITTED isolation level</a>.</div><div class="p" id="_516">In <a href="#postgresql">PostgreSQL</a>, this is the first isolation level which can lead to <a href="#postgresql-serialization-failure">postgreSQL serialization failures</a>, this does not happen to <a href="#sql-read-committed-isolation-level">SQL READ COMMITTED isolation level</a> in that <a href="software#database-management-system">DBMS</a>. You then have to retry the transaction.</div><div class="h" id="sql-serializable-isolation-level"><div class="notnav"><h5><a href="sql-serializable-isolation-level">SQL SERIALIZABLE isolation level</a></h5><span class="hover-meta"> <a class="split" href="sql-serializable-isolation-level"></a></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a><a href="#_toc/sql-serializable-isolation-level" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-serializable-isolation-level"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-isolation-level-example"><div class="notnav"><h5><a href="sql-isolation-level-example">SQL isolation level example</a></h5><span class="hover-meta"> <a class="split" href="sql-isolation-level-example"></a><span class="metrics"><span class="wcntr"> Words: 1k</span><span class="dcnt"> Articles: 5</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-transaction-isolation-level" class="u"> SQL transaction isolation level</a><a href="#_toc/sql-isolation-level-example" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-isolation-level-example"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="sql-parallel-update-example"><div class="notnav"><h6><a href="sql-parallel-update-example">SQL parallel update example</a></h6><span class="hover-meta"> <a class="split" href="sql-parallel-update-example"></a><span class="metrics"><span class="wcntr"> Words: 1k</span><span class="dcnt"> Articles: 4</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-isolation-level-example" class="u"> SQL isolation level example</a><a href="#_toc/sql-parallel-update-example" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-parallel-update-example"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="_file/nodejs/sequelize/raw/parallel_update_async.js"><div class="notnav"><span class="file" title="This article is about a file." /><h6 data-level="7"><a href="_file/nodejs/sequelize/raw/parallel_update_async.js">nodejs/sequelize/raw/parallel_update_async.js</a></h6><span class="hover-meta"> <a class="split" href="_file/nodejs/sequelize/raw/parallel_update_async.js"></a><span class="metrics"><span class="wcntr"> Words: 227</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-parallel-update-example" class="u"> SQL parallel update example</a><a href="#_toc/_file/nodejs/sequelize/raw/parallel_update_async.js" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/_file/nodejs/sequelize/raw/parallel_update_async.js"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div><div class="nav file"><b> <a href="_dir">(root)</a> / <a href="_dir/nodejs">nodejs</a> / <a href="_dir/nodejs/sequelize">sequelize</a> / <a href="_dir/nodejs/sequelize/raw">raw</a> / <a href="_raw/nodejs/sequelize/raw/parallel_update_async.js">parallel_update_async.js</a></b></div></nav></div><div class="p" id="_517"><a href="_raw/nodejs/sequelize/raw/parallel_update_worker_threads.js">nodejs/sequelize/raw/parallel_update_worker_threads.js</a> contains a base example that can be used to test what can happen when queries are being run in parallel. But it is broken due to a <a href="#sqlite3-node-js-package"><code>sqlite3</code> Node.js package</a> bug: <a href="https://github.com/mapbox/node-sqlite3/issues/1381">github.com/mapbox/node-sqlite3/issues/1381</a>...</div><div class="p" id="_518"><a href="_raw/nodejs/sequelize/raw/parallel_update_async.js">nodejs/sequelize/raw/parallel_update_async.js</a> is an <a href="programming-language#async-javascript"><code>async</code></a> version of it. It should be just parallel enough to allow observing the same effects.</div><div class="p" id="_519">This is an example of a transaction where the <a href="#sql-read-committed-isolation-level">SQL READ COMMITTED isolation level</a> if sufficient.</div><div class="p" id="_520">These examples run queries of type:<div class="code" id="_521"><div><pre><code>UPDATE "MyInt" SET i = i + 1</code></pre></div></div></div><div class="p" id="_522">Sample execution:<div class="code" id="_523"><div><pre><code>node --unhandled-rejections=strict ./parallel_update_async.js p 10 100</code></pre></div></div>which does:<div class="list"><ul id="_524"><li id="_525"><a href="#postgresql">PostgreSQL</a>, see other databases options at <a href="#sql-example">SQL example</a></li><li id="_526">10 threads</li><li id="_527">100 increments on each thread</li></ul></div></div><div class="p" id="_528">The fear then is that of a classic <a href="computer#read-modify-write">read-modify-write</a> failure.</div><div class="p" id="_529">But as <a href="https://www.postgresql.org/docs/14/transaction-iso.html">www.postgresql.org/docs/14/transaction-iso.html</a> page makes very clear, including with an explicit example of type <code>UPDATE accounts SET balance = balance + 100.00 WHERE acctnum = 12345;</code>, that the default isolation level, <a href="#sql-read-committed-isolation-level">SQL READ COMMITTED isolation level</a>, already prevents any problems with this, as the update always re-reads selected rows in case they were previously modified.<div><blockquote id="_530">If the first updater commits, the second updater will ignore the row if the first updater deleted it, otherwise it will attempt to apply its operation to the updated version of the row</blockquote></div></div><div class="p" id="_531">Since in <a href="#postgresql">PostgreSQL</a> "Read uncommitted" appears to be effectively the same as "Read committed", we won't be able to observe any failures on that database system for this example.</div><div class="p" id="_532"><a href="#_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js">nodejs/sequelize/raw/parallel_create_delete_empty_tag.js</a> contains an example where things can actually blow up in read committed.</div><div class="p"><b>nodejs/sequelize/raw/parallel_update_async.js</b></div><div class="code"><div><pre><code>#!/usr/bin/env node

// https://cirosantilli.com/file/sequelize/raw/parallel_update_async.js

const assert = require('assert');
const common = require('../common');

async function inc(sequelize, n) {
  for (let i = 0; i &lt; n; i++) {
    await sequelize.query(`UPDATE "MyInt" SET i = i + 1`)
  }
}

// CLI arguments.
let nthreads;
if (process.argv.length &gt; 3) {
  nthreads = parseInt(process.argv[3], 10)
} else {
  nthreads = 2;
}
let n;
if (process.argv.length &gt; 4) {
  n = parseInt(process.argv[4], 10)
} else {
  n = 10;
}

const sequelizes = common.sequelizes(nthreads, __filename, process.argv[2])
const sequelize = sequelizes[0]
;(async () =&gt; {
await common.drop(sequelize, 'MyInt')
await sequelize.query(`CREATE TABLE "MyInt" ( i INTEGER NOT NULL)`)
await sequelize.query(`INSERT INTO "MyInt" VALUES (0)`)
const arr = []
for (let i = 0; i &lt; nthreads; i++) {
  arr.push(inc(sequelizes[i], n))
}
await Promise.all(arr)
;[rows, meta] = await sequelize.query(`SELECT * FROM "MyInt"`)
assert.strictEqual(rows[0].i, nthreads * n)
})().finally(() =&gt; {
  return Promise.all(sequelizes.map(s =&gt; s.close()))
});
</code></pre></div></div><div class="h" id="_file/nodejs/sequelize/raw/parallel_select_and_update.js"><div class="notnav"><span class="file" title="This article is about a file." /><h6 data-level="7"><a href="_file/nodejs/sequelize/raw/parallel_select_and_update.js">nodejs/sequelize/raw/parallel_select_and_update.js</a></h6><span class="hover-meta"> <a class="split" href="_file/nodejs/sequelize/raw/parallel_select_and_update.js"></a><span class="metrics"><span class="wcntr"> Words: 422</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-parallel-update-example" class="u"> SQL parallel update example</a><a href="#_toc/_file/nodejs/sequelize/raw/parallel_select_and_update.js" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/_file/nodejs/sequelize/raw/parallel_select_and_update.js"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div><div class="nav file"><b> <a href="_dir">(root)</a> / <a href="_dir/nodejs">nodejs</a> / <a href="_dir/nodejs/sequelize">sequelize</a> / <a href="_dir/nodejs/sequelize/raw">raw</a> / <a href="_raw/nodejs/sequelize/raw/parallel_select_and_update.js">parallel_select_and_update.js</a></b></div></nav></div><div class="p" id="_533">This example is similar to <a href="#_file/nodejs/sequelize/raw/parallel_update_async.js">nodejs/sequelize/raw/parallel_update_async.js</a>, but now we are doing a separate SELECT, later followed by an update:<div class="list"><ul id="_534"><li id="_535"><code>SELECT FROM</code> to get i</li><li id="_536">update on Js code <code>newI = i + 1</code></li><li id="_537"><code>UPDATE SET</code> the <code>newI</code></li></ul></div></div><div class="p" id="_538">Although this specific example is useless in itself, as we could just use <code>UPDATE "MyInt" SET i = i + 1</code> as in <a href="#_file/nodejs/sequelize/raw/parallel_update_async.js">nodejs/sequelize/raw/parallel_update_async.js</a>, which automatically solves any concurrency issue, this kind of code could be required for example if the update was a complex function not suitably implemented in SQL, or if the update depends on some external data source.</div><div class="p" id="_539">Sample execution:<div class="code" id="_540"><div><pre><code>node --unhandled-rejections=strict ./parallel_select_and_update.js p 2 10 'READ COMMITTED'</code></pre></div></div>which does:<div class="list"><ul id="_541"><li id="_542"><a href="#postgresql">PostgreSQL</a>, see other databases options at <a href="#sql-example">SQL example</a></li><li id="_543">2 threads</li><li id="_544">10 increments on each thread</li></ul></div></div><div class="p" id="_545">Another one:<div class="code" id="_546"><div><pre><code>node --unhandled-rejections=strict ./parallel_select_and_update.js p 2 10 'READ COMMITTED' 'FOR UPDATE'</code></pre></div></div>this will run <a href="#select-for-update">SELECT FOR UPDATE</a> rather than just <a href="#select-sql">SELECT</a></div><div class="p" id="_547">Observed behaviour under different <a href="#sql-transaction-isolation-level">SQL transaction isolation levels</a>:<div class="list"><ul id="_548"><li id="_549"><code>READ COMMITTED</code>: fails. Nothing in this case prevents:<div class="list"><ul id="_550"><li id="_551">thread 1: SELECT, obtains i = 0</li><li id="_552">thread 2: SELECT, obtains i = 0</li><li id="_553">thread 2: newI = 1</li><li id="_554">thread 2: UPDATE i = 1</li><li id="_555">thread 1: newI = 1</li><li id="_556">thread 1: UPDATE i = 1</li></ul></div></li><li id="_557"><code>REPEATABLE READ</code>: works. the manual mentions that if multiple concurrent updates would happen, only the first commit succeeds, and the following ones fail and rollback and retry, therefore preventing the loss of an update.</li><li id="_558"><div class="p" id="_559"><code>READ COMMITTED</code> + <code>SELECT FOR UPDATE</code>: works. And does not do rollbacks, which probably makes it faster. With <code>p 10 100</code>, <code>REPEATABLE READ</code> was about 4.2s and <code>READ COMMITTED</code> + <code>SELECT FOR UPDATE</code> 3.2s on <a href="ciro-santilli-s-hardware#lenovo-thinkpad-p51-2017">Lenovo ThinkPad P51 (2017)</a>.</div><div class="p" id="_560"><code>SELECT FOR UPDATE</code> should be enough as mentioned at: <a href="https://www.postgresql.org/docs/13/explicit-locking.html#LOCKING-ROWS">www.postgresql.org/docs/13/explicit-locking.html#LOCKING-ROWS</a><div><blockquote id="_561">FOR UPDATE causes the rows retrieved by the SELECT statement to be locked as though for update. This prevents them from being locked, modified or deleted by other transactions until the current transaction ends. That is, other transactions that attempt UPDATE, DELETE, SELECT FOR UPDATE, SELECT FOR NO KEY UPDATE, SELECT FOR SHARE or SELECT FOR KEY SHARE of these rows will be blocked until the current transaction ends; conversely, SELECT FOR UPDATE will wait for a concurrent transaction that has run any of those commands on the same row, and will then lock and return the updated row (or no row, if the row was deleted). Within a REPEATABLE READ or SERIALIZABLE transaction, however, an error will be thrown if a row to be locked has changed since the transaction started. For further discussion see Section 13.4.</blockquote></div></div></li></ul></div></div><div class="p" id="_562">A non-raw version of this example can be seen at: <a href="sequelize#_file/nodejs/sequelize/parallel_select_and_update.js">nodejs/sequelize/parallel_select_and_update.js</a>.</div><div class="p"><b>nodejs/sequelize/raw/parallel_select_and_update.js</b></div><div class="code"><div><pre><code>#!/usr/bin/env node

// https://cirosantilli.com/file/sequelize/raw/parallel_select_and_update.js

const assert = require('assert');
const common = require('../common');

async function inc(sequelize, n, isolation, for_update) {
  for (let i = 0; i &lt; n; i++) {
    await common.transaction(sequelize, isolation, async sequelize =&gt; {
      ;[rows, meta] = await sequelize.query(`SELECT * FROM "MyInt" ${for_update}`)
      const newI = rows[0].i + 1
      await sequelize.query(`UPDATE "MyInt" SET i = ${newI}`)
    })
  }
}

// CLI arguments.
let nthreads;
if (process.argv.length &gt; 3) {
  nthreads = parseInt(process.argv[3], 10)
} else {
  nthreads = 2;
}
let n;
if (process.argv.length &gt; 4) {
  n = parseInt(process.argv[4], 10)
} else {
  n = 10;
}
const isolation = process.argv[5]
let for_update = process.argv[6]
if (for_update === undefined) {
  for_update = ''
}

const sequelizes = common.sequelizes(nthreads, __filename, process.argv[2])
const sequelize = sequelizes[0]
;(async () =&gt; {
await common.drop(sequelize, 'MyInt')
await sequelize.query(`CREATE TABLE "MyInt" ( i INTEGER NOT NULL )`)
await sequelize.query(`INSERT INTO "MyInt" VALUES (0)`)
const arr = []
for (let i = 0; i &lt; nthreads; i++) {
  arr.push(inc(sequelizes[i], n, isolation, for_update))
}
await Promise.all(arr)
let [rows, meta] = await sequelize.query(`SELECT * FROM "MyInt"`)
assert.strictEqual(rows[0].i, nthreads * n)
})().finally(() =&gt; {
  return Promise.all(sequelizes.map(s =&gt; s.close()))
});
</code></pre></div></div><div class="h" id="_file/nodejs/sequelize/raw/parallel_select_and_update_deterministic.js"><div class="notnav"><span class="file" title="This article is about a file." /><h6 data-level="7"><a href="_file/nodejs/sequelize/raw/parallel_select_and_update_deterministic.js">nodejs/sequelize/raw/parallel_select_and_update_deterministic.js</a></h6><span class="hover-meta"> <a class="split" href="_file/nodejs/sequelize/raw/parallel_select_and_update_deterministic.js"></a><span class="metrics"><span class="wcntr"> Words: 13</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-parallel-update-example" class="u"> SQL parallel update example</a><a href="#_toc/_file/nodejs/sequelize/raw/parallel_select_and_update_deterministic.js" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/_file/nodejs/sequelize/raw/parallel_select_and_update_deterministic.js"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div><div class="nav file"><b> <a href="_dir">(root)</a> / <a href="_dir/nodejs">nodejs</a> / <a href="_dir/nodejs/sequelize">sequelize</a> / <a href="_dir/nodejs/sequelize/raw">raw</a> / <a href="_raw/nodejs/sequelize/raw/parallel_select_and_update_deterministic.js">parallel_select_and_update_deterministic.js</a></b></div></nav></div><div class="p" id="_563">This example contains a deterministic demo of when <a href="#postgresql-serialization-failure">postgreSQL serialization failures</a> may happen.</div><div class="p" id="_564">Tested on <a href="#postgresql">PostgreSQL</a> 13.5.</div><div class="p"><b>nodejs/sequelize/raw/parallel_select_and_update_deterministic.js</b> was not rendered because it is too large (&gt; 2000 bytes)</div><div class="h" id="_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js"><div class="notnav"><span class="file" title="This article is about a file." /><h6 data-level="7"><a href="_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js">nodejs/sequelize/raw/parallel_create_delete_empty_tag.js</a></h6><span class="hover-meta"> <a class="split" href="_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js"></a><span class="metrics"><span class="wcntr"> Words: 758</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-parallel-update-example" class="u"> SQL parallel update example</a><a href="#_toc/_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/_file/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div><div class="nav file"><b> <a href="_dir">(root)</a> / <a href="_dir/nodejs">nodejs</a> / <a href="_dir/nodejs/sequelize">sequelize</a> / <a href="_dir/nodejs/sequelize/raw">raw</a> / <a href="_raw/nodejs/sequelize/raw/parallel_create_delete_empty_tag.js">parallel_create_delete_empty_tag.js</a></b></div></nav></div><div class="p" id="_565">In this example, posts have tags. When a post is deleted, we check to see if there are now any empty tags, and now we want to delete any empty tags that the post deletion may have created.</div><div class="p" id="_566">If we are creating and deleting posts concurrently, a naive implementation might wrongly delete the tags of a newly created post.</div><div class="p" id="_567">This could be due to a concurrency issue of the following types.</div><div class="p" id="_568">Failure case 1:<div class="list"><ul id="_569"><li id="_570">thread 2: delete old post</li><li id="_571">thread 2: find all tags with 0 posts. Finds <code>tag0</code> from the deleted old post which is now empty.</li><li id="_572">thread 1: create new post, which we want to have tag <code>tag0</code></li><li id="_573">thread 1: try to create a new tag <code>tag0</code>, but don't because it already exists, this is done using <a href="#sqlite">SQLite</a>'s <code>INSERT OR IGNORE INTO</code> or <a href="#postgresql">PostgreSQL</a>'s <code>INSERT ... ON CONFLICT DO NOTHING</code></li><li id="_574">thread 1: assign <code>tag0</code> to the new post by adding an entry to the join table</li><li id="_575">thread 2: delete all tags with 0 posts. It still sees from its previous search that <code>tag0</code> is empty, and deletes it, which then cascades into the join table</li></ul></div>which would result in the new post incorrectly not having the <code>tag0</code>.</div><div class="p" id="_576">Failure case 2:<div class="list"><ul id="_577"><li id="_578">thread 2: delete old post</li><li id="_579">thread 2: find all tags with 0 posts</li><li id="_580">thread 1: create new post</li><li id="_581">thread 1: try to create a new tag <code>tag0</code>, but don't because it already exists</li><li id="_582">thread 2: delete all tags with 0 posts. It still sees from its previous search that <code>tag0</code> is empty, and deletes it</li><li id="_583">thread 1: assign <code>tag0</code> to the new post</li></ul></div>which leads to a foreign key failure, because the tag does not exist anymore when the assignment happens.</div><div class="p" id="_584">Failure case 3:<div class="list"><ul id="_585"><li id="_586">thread 2: delete old post</li><li id="_587">thread 1: create new post, which we want to have tag <code>tag0</code></li><li id="_588">thread 1: try to create a new tag <code>tag0</code>, and succeed because it wasn't present</li><li id="_589">thread 2: find all tags with 0 posts, finds the tag that was just created</li><li id="_590">thread 2: delete all tags with 0 posts, deleting the new tag</li><li id="_591">thread 1: assign <code>tag0</code> to the new post</li></ul></div>which leads to a foreign key failure, because the tag does not exist anymore when the assignment happens.</div><div class="p" id="_592">Sample executions:<div class="list"><ul id="_593"><li id="_594"><div class="p" id="_595"><code>node --unhandled-rejections=strict ./parallel_create_delete_empty_tag.js p 9 1000 'READ COMMITTED'</code>: <a href="#postgresql">PostgreSQL</a>, 9 tags, DELETE/CREATE the <code>tag0</code> test tag 1000 times, use <code>READ COMMITTED</code></div><div class="p" id="_596">Execution often fails, although not always. The failure is always:<div class="code" id="_597"><div><pre><code>error: insert or update on table "PostTag" violates foreign key constraint "PostTag_tagId_fkey"</code></pre></div></div>because the:<div class="code" id="_598"><div><pre><code>INSERT INTO "PostTag"</code></pre></div></div>tries to insert a tag that was deleted in the other thread, as it didn't have any corresponding posts, so this is the foreign key failure.</div><div class="p" id="_599">TODO: we've never managed to observe the failure case in which <code>tag0</code> is deleted. Is it truly possible? And if not, by which guarantee?</div></li><li id="_600"><div class="p" id="_601"><code>node --unhandled-rejections=strict ./parallel_create_delete_empty_tag.js p 9 1000 'READ COMMITTED' 'FOR UPDATE'</code>: do a <code>SELECT ... FOR UPDATE</code> before trying to <code>INSERT</code>.</div><div class="p" id="_602">This is likely correct and the fastest correct method according to our quick benchmarking, about 20% faster than <code>REPEATABLE READ</code>.</div><div class="p" id="_603">We are just now 100% sure it is corret becase we can't find out if the <code>SELECT</code> in the <code>DELETE</code> subquery could first select some rows, which are then locked by the tag creator, and only then locked by <code>DELETE</code> after selection. Or does it re-evaludate the <code>SELECT</code> even though it is in a subquery?</div></li><li id="_604"><div class="p" id="_605"><code>node --unhandled-rejections=strict ./parallel_create_delete_empty_tag.js p 9 1000 'REPEATABLE READ'</code>: repeatable read</div><div class="p" id="_606">We've never observed any failures with this level. This should likely fix the foreign key issue according to the PostgreSQL docs, since:<div class="list"><ul id="_607"><li id="_608">the <code>DELETE "Post"</code> commit cannot start to be seen only in the middle of the thread 1 transaction</li><li id="_609">and then if DELETE happened, the thread 1 transaction will detect it, ROLLBACK, and re-run. TODO how does it detect the need rollback? Is it because of the foreign key? It is very hard to be sure about this kind of thing, just can't find the information. Related: <a href="#postgresql-serialization-failure">postgreSQL serialization failure</a>.</li></ul></div></div></li><li id="_610"><code>node --unhandled-rejections=strict ./parallel_create_delete_empty_tag.js p 9 1000 'SERIALIZABLE'</code>: serializable</li><li id="_611"><code>node --unhandled-rejections=strict ./parallel_create_delete_empty_tag.js p 9 1000 'NONE'</code>: magic value, don't use any transaction. Can blow up of course, since even less restrictions than <code>READ COMMITTED</code></li></ul></div>All executions use 2 threads.</div><div class="p" id="_612">Some theoretical notes:<div class="list"><ul id="_613"><li id="_614">Failure case 3 is averted by a <code>READ COMMITTED</code> transaction, because thread 2 won't see the uncommitted tag that thread 1 created, and therefore won't be able to delete it</li></ul></div></div><div class="p" id="_615"><a href="https://stackoverflow.com/questions/10935850/when-to-use-select-for-update">stackoverflow.com/questions/10935850/when-to-use-select-for-update</a> from <a href="#select-for-update">SELECT FOR UPDATE</a> also talks about a similar example, and has relevant answers.</div><div class="p"><b>nodejs/sequelize/raw/parallel_create_delete_empty_tag.js</b> was not rendered because it is too large (&gt; 2000 bytes)</div><div class="h" id="window-function-sql"><div class="notnav"><h3><a href="window-function-sql">Window function <span class="meta">(SQL)</span></a></h3><span class="hover-meta"> <a class="split" href="window-function-sql"></a><span class="metrics"><span class="wcntr"> Words: 452</span><span class="dcnt"> Articles: 3</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sql-feature" class="u"> SQL feature</a><a href="#_toc/window-function-sql" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/window-function-sql"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="row-number"><div class="notnav"><h4><a href="row-number"><code>ROW_NUMBER</code></a></h4><span class="hover-meta"> <a class="split" href="row-number"></a><span class="metrics"><span class="wcntr"> Words: 57</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#window-function-sql" class="u"> Window function (SQL)</a><a href="#_toc/row-number" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/row-number"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_616"><div class="code" id="_617"><div><pre><code>sqlite3 ':memory:'  'WITH t (i) AS (VALUES (-1), (-1), (-2)) SELECT *, row_number() over () FROM t'</code></pre></div></div>Possible output:<div class="code" id="_618"><div><pre><code>-1|1
-1|2
-2|3</code></pre></div></div>Gives them unique IDs.</div><div class="p" id="_619">With a <code>partition by</code>:<div class="code" id="_620"><div><pre><code>sqlite3 ':memory:'  'WITH t (i) AS (VALUES (-1), (-1), (-2)) SELECT *, row_number() over ( partition by i ) FROM t'</code></pre></div></div>possible output:<div class="code" id="_621"><div><pre><code>-2|1
-1|1
-1|2</code></pre></div></div></div><div class="h" id="sql-window-range"><div class="notnav"><h4><a href="sql-window-range">SQL window <code>RANGE</code></a></h4><span class="hover-meta"> <a class="split" href="sql-window-range"></a><span class="metrics"><span class="wcntr"> Words: 214</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#window-function-sql" class="u"> Window function (SQL)</a><a href="#_toc/sql-window-range" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-window-range"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_622"><li id="_623"><a href="#sqlite">SQLite</a>: <a href="https://www.sqlite.org/windowfunctions.html#exprrange">www.sqlite.org/windowfunctions.html#exprrange</a></li></ul></div><div class="code" id="_624"><div><pre><code>rm -f tmp.sqlite
sqlite3 tmp.sqlite "create table t (id integer, val integer)"
sqlite3 tmp.sqlite &lt;&lt;EOF
insert into t values
  (0, 0),
  (1, 5),
  (2, 10),
  (3, 14),
  (4, 15),
  (5, 16),
  (6, 20),
  (7, 25),
  (8, 29),
  (9, 30),
  (10, 30),
  (11, 31),
  (12, 35),
  (13, 40)
EOF</code></pre></div></div><div class="p" id="_625">Show how many neighbours each column has with <code>val</code> between <code>val - 2</code> and <code>val + 2</code> inclusive:<div class="code" id="_626"><div><pre><code>sqlite3 tmp.sqlite &lt;&lt;EOF
SELECT id, val, COUNT(*) OVER (
  ORDER BY val RANGE BETWEEN 2 PRECEDING AND 2 FOLLOWING
) FROM t;
EOF</code></pre></div></div>Output:<div class="code" id="_627"><div><pre><code>0|0|1
1|5|1
2|10|1
3|14|3
4|15|3
5|16|3
6|20|1
7|25|1
8|29|4
9|30|4
10|30|4
11|31|4
12|35|1
13|40|1</code></pre></div></div></div><div class="p" id="_628"><code>val - 1</code> and <code>val + 1</code> inclusive instead:<div class="code" id="_629"><div><pre><code>sqlite3 tmp.sqlite &lt;&lt;EOF
SELECT id, val, COUNT(*) OVER (
  ORDER BY val RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING
) FROM t;
EOF</code></pre></div></div>Output:<div class="code" id="_630"><div><pre><code>0|0|1
1|5|1
2|10|1
3|14|2
4|15|3
5|16|2
6|20|1
7|25|1
8|29|3
9|30|4
10|30|4
11|31|3
12|35|1
13|40|1</code></pre></div></div></div><div class="p" id="_631">There seems to be no analogue to <a href="#having-sql">HAVING</a> for window functions, so we can just settle for a subquery for once, e.g.:<div class="code" id="_632"><div><pre><code>sqlite3 tmp.sqlite &lt;&lt;EOF
SELECT * FROM (
  SELECT id, val, COUNT(*) OVER (
    ORDER BY val RANGE BETWEEN 1 PRECEDING AND 1 FOLLOWING
  ) as c FROM t
) WHERE c &gt; 2
EOF</code></pre></div></div>which outputs:<div class="code" id="_633"><div><pre><code>4|15|3
8|29|3
9|30|4
10|30|4
11|31|3</code></pre></div></div></div><div class="h" id="sql-contiguous-ranges"><div class="notnav"><h4><a href="sql-contiguous-ranges">SQL contiguous ranges</a></h4><span class="hover-meta"> <a class="split" href="sql-contiguous-ranges"></a><span class="metrics"><span class="wcntr"> Words: 181</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#window-function-sql" class="u"> Window function (SQL)</a><a href="#_toc/sql-contiguous-ranges" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/sql-contiguous-ranges"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_634"><a href="https://stackoverflow.com/questions/17046204/how-to-find-the-boundaries-of-groups-of-contiguous-sequential-numbers/17046749#17046749">stackoverflow.com/questions/17046204/how-to-find-the-boundaries-of-groups-of-contiguous-sequential-numbers/17046749#17046749</a> just works, even in <a href="#sqlite">SQLite</a> which supports all quoting types known to man including <code>[]</code> for compatibility with insane <a href="software#relational-database-management-system">RDBMSs</a>!</div><div class="p" id="_635">Here's a slightly saner version:<div class="code" id="_636"><div><pre><code>rm -f tmp.sqlite
sqlite3 tmp.sqlite "create table mytable (id integer primary key autoincrement, number integer, status integer)"
sqlite3 tmp.sqlite &lt;&lt;EOF
insert into mytable(number, status) values
  (100,0),
  (101,0),
  (102,0),
  (103,0),
  (104,1),
  (105,1),
  (106,0),
  (107,0),
  (1014,0),
  (1015,0),
  (1016,1),
  (1017,0)
EOF
sqlite3 tmp.sqlite &lt;&lt;EOF
SELECT
  MIN(id) AS "id",
  MIN(number) AS "from",
  MAX(number) AS "to"
FROM (
  SELECT ROW_NUMBER() OVER (ORDER BY number) - number AS grp, id, number
  FROM mytable
  WHERE status = 0
)
GROUP BY grp
ORDER BY MIN(number)
EOF</code></pre></div></div></div><div class="p" id="_637">output:</div><div class="code" id="_638"><div><pre><code>1|100|103
7|106|107
9|1014|1015
12|1017|1017</code></pre></div></div><div class="p" id="_639">To get only groups of length greater than 1:<div class="code" id="_640"><div><pre><code>sqlite3 tmp.sqlite &lt;&lt;EOF
SELECT "id", "from", "to", "to" - "from" + 1 as "len" FROM (
  SELECT
    MIN("id") AS "id",
    MIN(number) AS "from",
    MAX(number) AS "to"
  FROM (
    SELECT ROW_NUMBER() OVER (ORDER BY "number") - "number" AS "grp", "id", "number"
    FROM "mytable"
    WHERE "status" = 0
  )
  GROUP BY "grp"
  ORDER BY MIN("number")
) WHERE "len" &gt; 1
EOF</code></pre></div></div></div><div class="p" id="_641">Output:<div class="code" id="_642"><div><pre><code>1|100|103|4
7|106|107|2
9|1014|1015|2</code></pre></div></div></div><h2 id="_ancestors"><a href="#_ancestors"><span class="fa-solid-900 icon">ÔÅ¢</span> Ancestors <span class="meta">(10)</span></a></h2><div class="list"><ol><li><a href="software#relational-database-management-system">Relational database management system</a></li><li><a href="software#relational-database">Relational database</a></li><li><a href="software#type-of-database">Type of database</a></li><li><a href="software#database">Database</a></li><li><a href="software">Software</a></li><li><a href="computer">Computer</a></li><li><a href="technology#information-technology">Information technology</a></li><li><a href="technology#area-of-technology">Area of technology</a></li><li><a href="technology">Technology</a></li><li><a href="."><span title="Home" class="fa-solid-900 icon">ÔÄï</span> Home</a></li></ol></div><h2 id="_incoming-links"><a href="#_incoming-links"><span title="Incoming links" class="fa-solid-900 icon">ÔÅ†</span> Incoming links <span class="meta">(15)</span></a></h2><div class="list"><ul><li><a href="cool-data-embedded-in-the-bitcoin-blockchain#etchablock-com">etchablock.com</a></li><li><a href="software#database-management-system">Database management system</a></li><li><a href="stack-overflow#gordon-linoff">Gordon Linoff</a></li><li><a href="software#how-to-decide-if-an-orm-is-good">How to decide if an ORM is good?</a></li><li><a href="computer#ibm">IBM</a></li><li><a href="software#isolation-database-systems">Isolation (database systems)</a></li><li><a href="mathematics#nested-set-model">Nested set model</a></li><li><a href="#nested-set-model-in-sql">Nested set model in SQL</a></li><li><a href="software#oracle-corporation">Oracle Corporation</a></li><li><a href="sequelize#sequelize-raw-query">Sequelize raw query</a></li><li><a href="sponsor/updates/8#list-topics-on-home-page">List topics on home page</a></li><li><a href="#sql-example">SQL example</a></li><li><a href="#sql-trigger">SQL TRIGGER</a></li><li><a href="stack-overflow#stack-exchange-data-explorer">Stack Exchange Data Explorer</a></li><li><a href="updates#metrics-and-rationales">Metrics and rationales</a></li></ul></div>
</main>
<footer>
<div>Powered by <a href="https://docs.ourbigbook.com">OurBigBook</a></div>
<div>License: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> unless noted</div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io/issues">Suggestions and corrections</a></div>
<div><a href="contact">Contact Ciro Santilli</a></div>
<div><a href="_dir">Website source code</a></div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io">Website source code on GitHub</a></div>
<div><a href="_file/sql.bigb">Source code for this page: sql.bigb</a></div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io/blob/a4d833d32a963800b7b90b69207f6802c6bb72d2/sql.bigb">Source code for this page on GitHub</a></div>
<div>Cite with: <a href="https://zenodo.org/badge/latestdoi/16453261">this DOI</a></div>
<div><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_left_eye_200_100.jpg" loading="lazy" alt="ID photo of Ciro Santilli taken in 2013 right eye"></div>
</footer>
<script>
window.ourbigbook_split_headers = true;
window.ourbigbook_html_x_extension = false;
window.ourbigbook_redirect_prefix = "";
</script>
<script src="_obb/dist/ourbigbook_runtime.js"></script><script>ourbigbook_runtime.ourbigbook_runtime()</script><script src="_raw/main.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-47867706-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DEE2HEJW9X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DEE2HEJW9X');
</script>
<script src="https://giscus.app/client.js"
        data-repo="cirosantilli/cirosantilli.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNjQ1MzI2MQ=="
        data-category="giscus"
        data-category-id="DIC_kwDOAPsOjc4CZ6zZ"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark_high_contrast"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</body>
</html>
