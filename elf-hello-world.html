<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>ELF Hello World Tutorial - Ciro Santilli</title>
<meta property="og:title" content="ELF Hello World Tutorial - Ciro Santilli">
<meta property="og:type" content="website">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/ELF_Executable_and_Linkable_Format_diagram_by_Ange_Albertini.png/1280px-ELF_Executable_and_Linkable_Format_diagram_by_Ange_Albertini.png">
<meta property="og:url" content="https://cirosantilli.com/elf-hello-world">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.1/css/all.min.css" integrity="sha512-9my9Mb2+0YO+I4PUCSwUYO7sEK21Y0STBAiFEYoWtd2VzLEZZ4QARDrZ30hdM1GlioHJ8o8cWQiy8IAb1hy/Hg==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link rel="canonical" href="https://ourbigbook.com/cirosantilli/elf-hello-world">
<style>@import "_obb/dist/ourbigbook.css";

</style>
<link rel="stylesheet" type="text/css" href="_raw/main.css">
<link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_square_398.jpg">
</head>
<body>
<header>
<div class="brand-group">
<a href="." class="brand"><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_right_eye_200_100.jpg" loading="lazy" alt="ID photo of Ciro Santilli taken in 2013 right eye">Ciro Santilli</a>
<a href="https://ourbigbook.com/cirosantilli"><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ourbigbook-logo-v1.svg" loading="lazy" alt="OurBigBook logo">OurBigBook.com</a>
<a class="font-awesome-container" href="https://stackoverflow.com/users/895245"><i class="fab fa-stack-overflow fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://github.com/cirosantilli"><i class="fab fa-github fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.linkedin.com/in/cirosantilli"><i class="fab fa-linkedin fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.youtube.com/c/CiroSantilli"><i class="fab fa-youtube fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://twitter.com/cirosantilli"><i class="fab fa-twitter fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.zhihu.com/people/cirosantilli/activities"><i class="fab fa-zhihu fa-fw icon"></i></a>
<a class="font-awesome-container" href="https://www.weibo.com/p/1005055601627311"><i class="fab fa-weibo fa-fw icon"></i></a>
<a href="sponsor"><span class="icon">$£</span>&nbsp;Sponsor</a>
<a href="https://github.com/cirosantilli/china-dictatorship"><span class="icon">中国</span>独裁统治&nbsp;China Dictatorship 新疆改造中心、六四事件、法轮功、郝海东、709大抓捕、2015巴拿马文件 邓家贵、低端人口、西藏骚乱</a>
</div>
</header>
<main class="ourbigbook">
<div class="h top" id="elf-hello-world"><div class="notnav"><h1><a href="elf-hello-world-split">ELF Hello World Tutorial</a></h1></div><nav class="h-nav h-nav-toplevel"><div class="nav ancestors"><a  href="#_ancestors">&nbsp;...</a><a href="technology#information-technology"> Information technology</a><a href="computer"> Computer</a><a href="software"> Software</a><a href="systems-programming"> Systems programming</a><a href="systems-programming#executable-file-format"> Executable file format</a><a href="systems-programming#executable-and-linkable-format"> Executable and Linkable Format</a></div><div class="nav"><a href="#_toc" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a><span class="tags"> Tags: <a href="articles">The best articles by Ciro Santilli</a></span><a class="split" href="elf-hello-world-split"></a><span class="metrics"><span class="wcntr"> Words: 7k</span><span class="dcnt"> Articles: 36</span></span></div></nav></div><div class="p" id="_2">Introductory analysis of a simple example of the <a href="systems-programming#executable-and-linkable-format">executable and Linkable Format</a>.</div><div class="p" id="_3">Extracted from <a href="https://stackoverflow.com/a/30648229/895245">this Stack Overflow answer</a>.</div><div class="toc-container" id="_toc"><ul><li class="has-child toplevel"><div class="title-div"><div class="arrow"><div></div></div><span class="not-arrow"><a class="title toc" href="#_toc"> Table of contents</a><input class="search" placeholder="🔍 Search. Shortcut: / (slash)"><span class="hover-metadata"><span class="metrics"><span class="wcntr"> 7k</span><span class="dcnt"> 36</span></span></span></span></div><ul><li class="has-child"><div id="_toc/introduction"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#introduction"><i class="n">1. </i>Introduction</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 466</span><span class="dcnt"> 4</span></span></span></span></div><ul><li><div id="_toc/standards"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#standards"><i class="n">1.1. </i>Standards</a><span class="hover-metadata"><a href="#_toc/introduction" class="u"> Introduction</a><span class="metrics"><span class="wcntr"> 112</span></span></span></span></div></li><li><div id="_toc/how-to-learn"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#how-to-learn"><i class="n">1.2. </i>How to learn</a><span class="hover-metadata"><a href="#_toc/introduction" class="u"> Introduction</a><span class="metrics"><span class="wcntr"> 93</span></span></span></span></div></li><li><div id="_toc/specified-file-formats"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#specified-file-formats"><i class="n">1.3. </i>Specified file formats</a><span class="hover-metadata"><a href="#_toc/introduction" class="u"> Introduction</a><span class="metrics"><span class="wcntr"> 155</span></span></span></span></div></li><li><div id="_toc/implementations"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#implementations"><i class="n">1.4. </i>Implementations</a><span class="hover-metadata"><a href="#_toc/introduction" class="u"> Introduction</a><span class="metrics"><span class="wcntr"> 79</span></span></span></span></div></li></ul><li><div id="_toc/minimal-elf-file"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#minimal-elf-file"><i class="n">2. </i>Minimal ELF file</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 44</span></span></span></span></div></li><li><div id="_toc/generate-the-example"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#generate-the-example"><i class="n">3. </i>Generate the example</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 103</span></span></span></span></div></li><li><div id="_toc/object-hd"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#object-hd"><i class="n">4. </i>Object hd</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 979</span></span></span></span></div></li><li><div id="_toc/executable-hd"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#executable-hd"><i class="n">5. </i>Executable hd</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 1k</span></span></span></span></div></li><li><div id="_toc/global-file-structure"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#global-file-structure"><i class="n">6. </i>Global file structure</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 328</span></span></span></span></div></li><li><div id="_toc/section-vs-segment"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#section-vs-segment"><i class="n">7. </i>Section vs segment</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 111</span></span></span></span></div></li><li><div id="_toc/elf-header"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#elf-header"><i class="n">8. </i>ELF header</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 823</span></span></span></span></div></li><li><div id="_toc/section-header-table"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#section-header-table"><i class="n">9. </i>Section header table</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 252</span></span></span></span></div></li><li class="has-child"><div id="_toc/sections"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sections"><i class="n">10. </i>Sections</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 3k</span><span class="dcnt"> 20</span></span></span></span></div><ul><li class="has-child"><div id="_toc/index-0-section"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#index-0-section"><i class="n">10.1. </i>Index 0 section</a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 92</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/sht-null"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sht-null"><i class="n">10.1.1. </i><code>SHT_NULL</code></a><span class="hover-metadata"><a href="#_toc/index-0-section" class="u"> Index 0 section</a><span class="metrics"><span class="wcntr"> 14</span></span></span></span></div></li></ul><li><div id="_toc/data-section"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#data-section"><i class="n">10.2. </i><code>.data</code> section</a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 499</span></span></span></span></div></li><li><div id="_toc/text-section"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#text-section"><i class="n">10.3. </i><code>.text</code> section</a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 258</span></span></span></span></div></li><li><div id="_toc/sht-strtab"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sht-strtab"><i class="n">10.4. </i><code>SHT_STRTAB</code></a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 125</span></span></span></span></div></li><li><div id="_toc/shstrtab"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#shstrtab"><i class="n">10.5. </i><code>.shstrtab</code></a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 159</span></span></span></span></div></li><li class="has-child"><div id="_toc/symtab"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#symtab"><i class="n">10.6. </i><code>.symtab</code></a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 792</span><span class="dcnt"> 5</span></span></span></span></div><ul><li><div id="_toc/stt-file"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#stt-file"><i class="n">10.6.1. </i><code>STT_FILE</code></a><span class="hover-metadata"><a href="#_toc/symtab" class="u"> <code>.symtab</code></a><span class="metrics"><span class="wcntr"> 199</span></span></span></span></div></li><li><div id="_toc/stt-section"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#stt-section"><i class="n">10.6.2. </i><code>STT_SECTION</code></a><span class="hover-metadata"><a href="#_toc/symtab" class="u"> <code>.symtab</code></a><span class="metrics"><span class="wcntr"> 47</span></span></span></span></div></li><li class="has-child"><div id="_toc/stt-notype"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#stt-notype"><i class="n">10.6.3. </i><code>STT_NOTYPE</code></a><span class="hover-metadata"><a href="#_toc/symtab" class="u"> <code>.symtab</code></a><span class="metrics"><span class="wcntr"> 201</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/shn-abs"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#shn-abs"><i class="n">10.6.3.1. </i><code>SHN_ABS</code></a><span class="hover-metadata"><a href="#_toc/stt-notype" class="u"> <code>STT_NOTYPE</code></a><span class="metrics"><span class="wcntr"> 107</span></span></span></span></div></li></ul><li><div id="_toc/sht-symtab-on-the-executable"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#sht-symtab-on-the-executable"><i class="n">10.6.4. </i><code>SHT_SYMTAB</code> on the executable</a><span class="hover-metadata"><a href="#_toc/symtab" class="u"> <code>.symtab</code></a><span class="metrics"><span class="wcntr"> 48</span></span></span></span></div></li></ul><li><div id="_toc/strtab"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#strtab"><i class="n">10.7. </i><code>.strtab</code></a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 72</span></span></span></span></div></li><li class="has-child"><div id="_toc/rela-text"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#rela-text"><i class="n">10.8. </i><code>.rela.text</code></a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 429</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/rel-text"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#rel-text"><i class="n">10.8.1. </i><code>.rel.text</code></a><span class="hover-metadata"><a href="#_toc/rela-text" class="u"> <code>.rela.text</code></a><span class="metrics"><span class="wcntr"> 63</span></span></span></span></div></li></ul><li class="has-child"><div id="_toc/dynamic-linking-sections"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#dynamic-linking-sections"><i class="n">10.9. </i>Dynamic linking sections</a><span class="hover-metadata"><a href="#_toc/sections" class="u"> Sections</a><span class="metrics"><span class="wcntr"> 105</span><span class="dcnt"> 4</span></span></span></span></div><ul><li><div id="_toc/pt-interp"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#pt-interp"><i class="n">10.9.1. </i><code>PT_INTERP</code></a><span class="hover-metadata"><a href="#_toc/dynamic-linking-sections" class="u"> Dynamic linking sections</a><span class="metrics"><span class="wcntr"> 14</span></span></span></span></div></li><li class="has-child"><div id="_toc/dynamic-section"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#dynamic-section"><i class="n">10.9.2. </i>Dynamic section</a><span class="hover-metadata"><a href="#_toc/dynamic-linking-sections" class="u"> Dynamic linking sections</a><span class="metrics"><span class="wcntr"> 52</span><span class="dcnt"> 2</span></span></span></span></div><ul><li class="has-child"><div id="_toc/dt-flags-1"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#dt-flags-1"><i class="n">10.9.2.1. </i><code>DT_FLAGS_1</code></a><span class="hover-metadata"><a href="#_toc/dynamic-section" class="u"> Dynamic section</a><span class="metrics"><span class="wcntr"> 45</span><span class="dcnt"> 1</span></span></span></span></div><ul><li><div id="_toc/df-1-pie"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#df-1-pie"><i class="n">10.9.2.1.1. </i><code>DF_1_PIE</code></a><span class="hover-metadata"><a href="#_toc/dt-flags-1" class="u"> <code>DT_FLAGS_1</code></a><span class="metrics"><span class="wcntr"> 38</span></span></span></span></div></li></ul></li></ul></li></ul></li></ul><li><div id="_toc/program-header-table"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#program-header-table"><i class="n">11. </i>Program header table</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 759</span></span></span></span></div></li><li><div id="_toc/backlinks"><div class="arrow"><div></div></div><span class="not-arrow"><a href="#backlinks"><i class="n">12. </i>Backlinks</a><span class="hover-metadata"><a href="#_toc" class="u"> ELF Hello World Tutorial</a><span class="metrics"><span class="wcntr"> 5</span></span></span></span></div></li></ul></li></ul></div><div class="h" id="introduction"><div class="notnav"><h2><a href="elf-hello-world/introduction"><span class="number">1. </span>Introduction</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/introduction"></a><span class="metrics"><span class="wcntr"> Words: 466</span><span class="dcnt"> Articles: 4</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/introduction" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/introduction"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_4">ELF is the dominating file format for Linux. It competes with Mach-O for OS X and PE for Windows.</div><div class="p" id="_5">ELF supersedes <code>.coff</code>, which supersedes <code>a.out</code>.</div><div class="h" id="standards"><div class="notnav"><h3><a href="elf-hello-world/standards"><span class="number">1.1. </span>Standards</a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/standards"></a><span class="metrics"><span class="wcntr"> Words: 112</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#introduction" class="u"> Introduction</a><a href="#_toc/standards" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/standards"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_6">ELF is specified by the <a href="https://en.wikipedia.org/wiki/Linux_Standard_Base">LSB</a>:<div class="list"><ul id="_7"><li id="_8">core generic: <a href="https://refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-generic/LSB-Core-generic/elf-generic.html">refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-generic/LSB-Core-generic/elf-generic.html</a></li><li id="_9">core AMD64: <a href="https://refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-AMD64/LSB-Core-AMD64/book1.html">refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-AMD64/LSB-Core-AMD64/book1.html</a></li></ul></div></div><div class="p" id="_10">The LSB basically links to other standards with minor extensions, in particular:</div><div class="list"><ul id="_11"><li id="_12">Generic (both by <a href="https://en.wikipedia.org/wiki/Santa_Cruz_Operation">SCO</a>):<div class="list"><ul id="_13"><li id="_14">System V ABI 4.1 (1997) <a href="http://www.sco.com/developers/devspecs/gabi41.pdf,">www.sco.com/developers/devspecs/gabi41.pdf,</a> no 64 bit, although a magic number is reserved for it. Same for core files. <i>This</i> is the first document you should look at when searching for information.</li><li id="_15">System V ABI Update DRAFT 17 (2003) <a href="http://www.sco.com/developers/gabi/2003-12-17/contents.html,">www.sco.com/developers/gabi/2003-12-17/contents.html,</a> adds 64 bit. Only updates chapters 4 and 5 of the previous document: the others remain valid and are still referenced.</li></ul></div></li><li id="_16">Architecture specific (by the processor vendor):<div class="list"><ul id="_17"><li id="_18">IA-32: <a href="https://refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-IA32/LSB-Core-IA32/elf-ia32.html,">refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-IA32/LSB-Core-IA32/elf-ia32.html,</a> points mostly to <a href="http://www.sco.com/developers/devspecs/abi386-4.pdf">www.sco.com/developers/devspecs/abi386-4.pdf</a></li><li id="_19">AMD64: <a href="https://refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-AMD64/LSB-Core-AMD64/elf-amd64.html,">refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-AMD64/LSB-Core-AMD64/elf-amd64.html,</a> points mostly to <a href="http://www.x86-64.org/documentation/abi.pdf">www.x86-64.org/documentation/abi.pdf</a></li></ul></div></li></ul></div><div class="p" id="_20">A handy summary can be found at:<div class="code" id="_21"><div><pre><code>man elf</code></pre></div></div></div><div class="h" id="how-to-learn"><div class="notnav"><h3><a href="elf-hello-world/how-to-learn"><span class="number">1.2. </span>How to learn</a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/how-to-learn"></a><span class="metrics"><span class="wcntr"> Words: 93</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#introduction" class="u"> Introduction</a><a href="#_toc/how-to-learn" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/how-to-learn"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_22">Spin like mad between:<div class="list"><ul id="_23"><li id="_24">standards</li><li id="_25">high level generators. We use the <a href="computer-hardware#assembler-computing">assembler</a> <code>as</code> and <a href="software#linker-computing">linker</a> <code>ld</code>.</li><li id="_26">hexdumps</li><li id="_27">file decompilers. We use <code>readelf</code>. It makes it faster to read the ELF file by turning it into human readable output. But you must have seen one byte-by-byte example first, and think how <code>readelf</code> output maps to the standard.</li><li id="_28">low-level generators: stand-alone libraries that let you control every field of the ELF files you generated. <a href="https://github.com/BR903/ELFkickers,">github.com/BR903/ELFkickers,</a> <a href="https://github.com/sqall01/ZwoELF">github.com/sqall01/ZwoELF</a> and many more on GitHub.</li><li id="_29">consumer: the <code>exec</code> system call of the Linux kernel can parse ELF files to starts processes: <a href="https://github.com/torvalds/linux/blob/v4.11/fs/binfmt_elf.c,">github.com/torvalds/linux/blob/v4.11/fs/binfmt_elf.c,</a> <a href="https://stackoverflow.com/questions/8352535/how-does-kernel-get-an-executable-binary-file-running-under-linux/31394861#31394861">stackoverflow.com/questions/8352535/how-does-kernel-get-an-executable-binary-file-running-under-linux/31394861#31394861</a></li></ul></div></div><div class="h" id="specified-file-formats"><div class="notnav"><h3><a href="elf-hello-world/specified-file-formats"><span class="number">1.3. </span>Specified file formats</a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/specified-file-formats"></a><span class="metrics"><span class="wcntr"> Words: 155</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#introduction" class="u"> Introduction</a><a href="#_toc/specified-file-formats" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/specified-file-formats"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_30">The ELF standard specifies multiple file formats:<div class="list"><ul id="_31"><li id="_32"><div class="p" id="_33">Object files (<code>.o</code>).</div><div class="p" id="_34">Intermediate step to generating executables and other formats:<div class="code" id="_35"><div><pre><code>Source code

    |
    | Compilation
    |
    v

Object file

    |
    | Linking
    |
    v

Executable</code></pre></div></div></div><div class="p" id="_36">Object files exist to make compilation faster: with <code>make</code>, we only have to recompile the modified source files based on timestamps.</div><div class="p" id="_37">We have to do the linking step every time, but it is much less expensive.</div></li></ul></div></div><div class="list"><ul id="_38"><li id="_39"><div class="p" id="_40">Executable files (no standard Linux extension).</div><div class="p" id="_41">This is what the Linux kernel can actually run.</div></li></ul></div><div class="list"><ul id="_42"><li id="_43"><div class="p" id="_44">Archive files (<code>.a</code>).</div><div class="p" id="_45">Libraries meant to be embedded into executables during the Linking step.</div></li></ul></div><div class="list"><ul id="_46"><li id="_47"><div class="p" id="_48">Shared object files (<code>.so</code>).</div><div class="p" id="_49">Libraries meant to be loaded when the executable starts running.</div></li></ul></div><div class="list"><ul id="_50"><li id="_51"><div class="p" id="_52">Core dumps.</div><div class="p" id="_53">Such files may be generated by the Linux kernel when the program does naughty things, e.g. segfault.</div><div class="p" id="_54">They exist to help debugging the program.</div></li></ul></div><div class="p" id="_55">In this tutorial, we consider only object and executable files.</div><div class="h" id="implementations"><div class="notnav"><h3><a href="elf-hello-world/implementations"><span class="number">1.4. </span>Implementations</a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/implementations"></a><span class="metrics"><span class="wcntr"> Words: 79</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#introduction" class="u"> Introduction</a><a href="#_toc/implementations" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/implementations"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="list"><ul id="_56"><li id="_57"><div class="p" id="_58">Compiler toolchains generate and read ELF files.</div><div class="p" id="_59">Sane compilers should use a separate standalone library to do the dirty work. E.g., Binutils uses BFD (in-tree and canonical source).</div></li></ul></div><div class="list"><ul id="_60"><li id="_61"><div class="p" id="_62">Operating systems read and run ELF files.</div><div class="p" id="_63">Kernels cannot link to a library nor use the C stlib, so they are more likely to implement it themselves.</div><div class="p" id="_64">This is the case of the Linux kernel 4.2 which implements it in th file <code>fs/binfmt_elf.c</code>.</div></li></ul></div><div class="list"><ul id="_65"><li id="_66">Specialized libraries. Examples:<div class="list"><ul id="_67"><li id="_68"><a href="https://github.com/eliben/pyelftools.">github.com/eliben/pyelftools.</a> By a hardcore Googler: <a href="https://plus.google.com/+EliBenderskyGplus/posts">plus.google.com/+EliBenderskyGplus/posts</a></li><li id="_69"><a href="https://sourceforge.net/projects/elftoolchain">sourceforge.net/projects/elftoolchain</a></li></ul></div></li></ul></div><div class="h" id="minimal-elf-file"><div class="notnav"><h2><a href="elf-hello-world/minimal-elf-file"><span class="number">2. </span>Minimal ELF file</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/minimal-elf-file"></a><span class="metrics"><span class="wcntr"> Words: 44</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/minimal-elf-file" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/minimal-elf-file"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_70">It is non-trivial to determine what is the smallest legal ELF file, or the smaller one that will do something trivial in Linux.</div><div class="p" id="_71">Some impressive attempts:<div class="list"><ul id="_72"><li id="_73"><a href="https://codegolf.stackexchange.com/questions/5696/shortest-elf-for-hello-world-n">codegolf.stackexchange.com/questions/5696/shortest-elf-for-hello-world-n</a></li><li id="_74"><a href="https://www.muppetlabs.com/~breadbox/software/tiny/">www.muppetlabs.com/~breadbox/software/tiny/</a></li><li id="_75"><a href="http://timelessname.com/elfbin/">timelessname.com/elfbin/</a></li></ul></div></div><div class="p" id="_76">In this example we will consider a saner <code>hello world</code> example that will better capture real life cases.</div><div class="h" id="generate-the-example"><div class="notnav"><h2><a href="elf-hello-world/generate-the-example"><span class="number">3. </span>Generate the example</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/generate-the-example"></a><span class="metrics"><span class="wcntr"> Words: 103</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/generate-the-example" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/generate-the-example"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_77">Let's break down a minimal runnable Linux x86-64 example:</div><div class="p" id="_78">hello_world.asm</div><div class="code" id="_79"><div><pre><code>section .data
    hello_world db "Hello world!", 10
    hello_world_len  equ $ - hello_world
section .text
    global _start
    _start:
        mov rax, 1
        mov rdi, 1
        mov rsi, hello_world
        mov rdx, hello_world_len
        syscall
        mov rax, 60
        mov rdi, 0
        syscall</code></pre></div></div><div class="p" id="_80">Compiled with:<div class="code" id="_81"><div><pre><code>nasm -w+all -f elf64 -o 'hello_world.o' 'hello_world.asm'
ld -o 'hello_world.out' 'hello_world.o'</code></pre></div></div></div><div class="p" id="_82">TODO: use a minimal linker script with <code>-T</code> to be more precise and minimal.</div><div class="p" id="_83">Versions:<div class="list"><ul id="_84"><li id="_85">NASM 2.10.09</li><li id="_86">Binutils version 2.24 (contains <code>ld</code>)</li><li id="_87">Ubuntu 14.04</li></ul></div></div><div class="p" id="_88">We don't use a C program as that would complicate the analysis, that will be level 2 :-)</div><div class="h" id="object-hd"><div class="notnav"><h2><a href="elf-hello-world/object-hd"><span class="number">4. </span>Object hd</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/object-hd"></a><span class="metrics"><span class="wcntr"> Words: 979</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/object-hd" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/object-hd"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_89">Running:<div class="code" id="_90"><div><pre><code>hd hello_world.o</code></pre></div></div>gives:<div class="code" id="_91"><div><pre><code>00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010  01 00 3e 00 01 00 00 00  00 00 00 00 00 00 00 00  |..&gt;.............|
00000020  00 00 00 00 00 00 00 00  40 00 00 00 00 00 00 00  |........@.......|
00000030  00 00 00 00 40 00 00 00  00 00 40 00 07 00 03 00  |....@.....@.....|
00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000080  01 00 00 00 01 00 00 00  03 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 02 00 00 00 00 00 00  |................|
000000a0  0d 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000b0  04 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000c0  07 00 00 00 01 00 00 00  06 00 00 00 00 00 00 00  |................|
000000d0  00 00 00 00 00 00 00 00  10 02 00 00 00 00 00 00  |................|
000000e0  27 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |'...............|
000000f0  10 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000100  0d 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|
00000110  00 00 00 00 00 00 00 00  40 02 00 00 00 00 00 00  |........@.......|
00000120  32 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |2...............|
00000130  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000140  17 00 00 00 02 00 00 00  00 00 00 00 00 00 00 00  |................|
00000150  00 00 00 00 00 00 00 00  80 02 00 00 00 00 00 00  |................|
00000160  a8 00 00 00 00 00 00 00  05 00 00 00 06 00 00 00  |................|
00000170  04 00 00 00 00 00 00 00  18 00 00 00 00 00 00 00  |................|
00000180  1f 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|
00000190  00 00 00 00 00 00 00 00  30 03 00 00 00 00 00 00  |........0.......|
000001a0  34 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |4...............|
000001b0  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001c0  27 00 00 00 04 00 00 00  00 00 00 00 00 00 00 00  |'...............|
000001d0  00 00 00 00 00 00 00 00  70 03 00 00 00 00 00 00  |........p.......|
000001e0  18 00 00 00 00 00 00 00  04 00 00 00 02 00 00 00  |................|
000001f0  04 00 00 00 00 00 00 00  18 00 00 00 00 00 00 00  |................|
00000200  48 65 6c 6c 6f 20 77 6f  72 6c 64 21 0a 00 00 00  |Hello world!....|
00000210  b8 01 00 00 00 bf 01 00  00 00 48 be 00 00 00 00  |..........H.....|
00000220  00 00 00 00 ba 0d 00 00  00 0f 05 b8 3c 00 00 00  |............&lt;...|
00000230  bf 00 00 00 00 0f 05 00  00 00 00 00 00 00 00 00  |................|
00000240  00 2e 64 61 74 61 00 2e  74 65 78 74 00 2e 73 68  |..data..text..sh|
00000250  73 74 72 74 61 62 00 2e  73 79 6d 74 61 62 00 2e  |strtab..symtab..|
00000260  73 74 72 74 61 62 00 2e  72 65 6c 61 2e 74 65 78  |strtab..rela.tex|
00000270  74 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |t...............|
00000280  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000290  00 00 00 00 00 00 00 00  01 00 00 00 04 00 f1 ff  |................|
000002a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000002b0  00 00 00 00 03 00 01 00  00 00 00 00 00 00 00 00  |................|
000002c0  00 00 00 00 00 00 00 00  00 00 00 00 03 00 02 00  |................|
000002d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000002e0  11 00 00 00 00 00 01 00  00 00 00 00 00 00 00 00  |................|
000002f0  00 00 00 00 00 00 00 00  1d 00 00 00 00 00 f1 ff  |................|
00000300  0d 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000310  2d 00 00 00 10 00 02 00  00 00 00 00 00 00 00 00  |-...............|
00000320  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000330  00 68 65 6c 6c 6f 5f 77  6f 72 6c 64 2e 61 73 6d  |.hello_world.asm|
00000340  00 68 65 6c 6c 6f 5f 77  6f 72 6c 64 00 68 65 6c  |.hello_world.hel|
00000350  6c 6f 5f 77 6f 72 6c 64  5f 6c 65 6e 00 5f 73 74  |lo_world_len._st|
00000360  61 72 74 00 00 00 00 00  00 00 00 00 00 00 00 00  |art.............|
00000370  0c 00 00 00 00 00 00 00  01 00 00 00 02 00 00 00  |................|
00000380  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000390</code></pre></div></div></div><div class="h" id="executable-hd"><div class="notnav"><h2><a href="elf-hello-world/executable-hd"><span class="number">5. </span>Executable hd</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/executable-hd"></a><span class="metrics"><span class="wcntr"> Words: 1k</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/executable-hd" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/executable-hd"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_92">Running:<div class="code" id="_93"><div><pre><code>hd hello_world.out</code></pre></div></div>gives:<div class="code" id="_94"><div><pre><code>00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010  02 00 3e 00 01 00 00 00  b0 00 40 00 00 00 00 00  |..&gt;.......@.....|
00000020  40 00 00 00 00 00 00 00  10 01 00 00 00 00 00 00  |@...............|
00000030  00 00 00 00 40 00 38 00  02 00 40 00 06 00 03 00  |....@.8...@.....|
00000040  01 00 00 00 05 00 00 00  00 00 00 00 00 00 00 00  |................|
00000050  00 00 40 00 00 00 00 00  00 00 40 00 00 00 00 00  |..@.......@.....|
00000060  d7 00 00 00 00 00 00 00  d7 00 00 00 00 00 00 00  |................|
00000070  00 00 20 00 00 00 00 00  01 00 00 00 06 00 00 00  |.. .............|
00000080  d8 00 00 00 00 00 00 00  d8 00 60 00 00 00 00 00  |..........`.....|
00000090  d8 00 60 00 00 00 00 00  0d 00 00 00 00 00 00 00  |..`.............|
000000a0  0d 00 00 00 00 00 00 00  00 00 20 00 00 00 00 00  |.......... .....|
000000b0  b8 01 00 00 00 bf 01 00  00 00 48 be d8 00 60 00  |..........H...`.|
000000c0  00 00 00 00 ba 0d 00 00  00 0f 05 b8 3c 00 00 00  |............&lt;...|
000000d0  bf 00 00 00 00 0f 05 00  48 65 6c 6c 6f 20 77 6f  |........Hello wo|
000000e0  72 6c 64 21 0a 00 2e 73  79 6d 74 61 62 00 2e 73  |rld!...symtab..s|
000000f0  74 72 74 61 62 00 2e 73  68 73 74 72 74 61 62 00  |trtab..shstrtab.|
00000100  2e 74 65 78 74 00 2e 64  61 74 61 00 00 00 00 00  |.text..data.....|
00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000150  1b 00 00 00 01 00 00 00  06 00 00 00 00 00 00 00  |................|
00000160  b0 00 40 00 00 00 00 00  b0 00 00 00 00 00 00 00  |..@.............|
00000170  27 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |'...............|
00000180  10 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000190  21 00 00 00 01 00 00 00  03 00 00 00 00 00 00 00  |!...............|
000001a0  d8 00 60 00 00 00 00 00  d8 00 00 00 00 00 00 00  |..`.............|
000001b0  0d 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001c0  04 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001d0  11 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|
000001e0  00 00 00 00 00 00 00 00  e5 00 00 00 00 00 00 00  |................|
000001f0  27 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |'...............|
00000200  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000210  01 00 00 00 02 00 00 00  00 00 00 00 00 00 00 00  |................|
00000220  00 00 00 00 00 00 00 00  90 02 00 00 00 00 00 00  |................|
00000230  08 01 00 00 00 00 00 00  05 00 00 00 07 00 00 00  |................|
00000240  08 00 00 00 00 00 00 00  18 00 00 00 00 00 00 00  |................|
00000250  09 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|
00000260  00 00 00 00 00 00 00 00  98 03 00 00 00 00 00 00  |................|
00000270  4c 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |L...............|
00000280  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000290  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000002a0  00 00 00 00 00 00 00 00  00 00 00 00 03 00 01 00  |................|
000002b0  b0 00 40 00 00 00 00 00  00 00 00 00 00 00 00 00  |..@.............|
000002c0  00 00 00 00 03 00 02 00  d8 00 60 00 00 00 00 00  |..........`.....|
000002d0  00 00 00 00 00 00 00 00  01 00 00 00 04 00 f1 ff  |................|
000002e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000002f0  11 00 00 00 00 00 02 00  d8 00 60 00 00 00 00 00  |..........`.....|
00000300  00 00 00 00 00 00 00 00  1d 00 00 00 00 00 f1 ff  |................|
00000310  0d 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000320  00 00 00 00 04 00 f1 ff  00 00 00 00 00 00 00 00  |................|
00000330  00 00 00 00 00 00 00 00  2d 00 00 00 10 00 01 00  |........-.......|
00000340  b0 00 40 00 00 00 00 00  00 00 00 00 00 00 00 00  |..@.............|
00000350  34 00 00 00 10 00 02 00  e5 00 60 00 00 00 00 00  |4.........`.....|
00000360  00 00 00 00 00 00 00 00  40 00 00 00 10 00 02 00  |........@.......|
00000370  e5 00 60 00 00 00 00 00  00 00 00 00 00 00 00 00  |..`.............|
00000380  47 00 00 00 10 00 02 00  e8 00 60 00 00 00 00 00  |G.........`.....|
00000390  00 00 00 00 00 00 00 00  00 68 65 6c 6c 6f 5f 77  |.........hello_w|
000003a0  6f 72 6c 64 2e 61 73 6d  00 68 65 6c 6c 6f 5f 77  |orld.asm.hello_w|
000003b0  6f 72 6c 64 00 68 65 6c  6c 6f 5f 77 6f 72 6c 64  |orld.hello_world|
000003c0  5f 6c 65 6e 00 5f 73 74  61 72 74 00 5f 5f 62 73  |_len._start.__bs|
000003d0  73 5f 73 74 61 72 74 00  5f 65 64 61 74 61 00 5f  |s_start._edata._|
000003e0  65 6e 64 00                                       |end.|
000003e4</code></pre></div></div></div><div class="h" id="global-file-structure"><div class="notnav"><h2><a href="elf-hello-world/global-file-structure"><span class="number">6. </span>Global file structure</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/global-file-structure"></a><span class="metrics"><span class="wcntr"> Words: 328</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/global-file-structure" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/global-file-structure"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_95">An ELF file contains the following parts:<div class="list"><ul id="_96"><li id="_97">ELF header. Points to the position of the section header table and the program header table.</li><li id="_98">Section header table (optional on executable). Each has <code>e_shnum</code> section headers, each pointing to the position of a section.</li><li id="_99">N sections, with <code>N &lt;= e_shnum</code> (optional on executable)</li><li id="_100">Program header table (only on executable). Each has <code>e_phnum</code> program headers, each pointing to the position of a segment.</li><li id="_101">N segments, with <code>N &lt;= e_phnum</code> (only on executable)</li></ul></div></div><div class="p" id="_102">The order of those parts is <i>not</i> fixed: the only fixed thing is the ELF header that must be the first thing on the file: Generic docs say:<div><blockquote id="_103">Although the figure shows the program header table immediately after the ELF header, and the section header table following the sections, actual files may differ. Moreover, sections and segments have no specified order. Only the ELF header has a fixed position in the file.</blockquote></div></div><div class="p" id="_104">In pictures: sample object file with three sections:<div class="code" id="_105"><div><pre><code>            +-------------------+
            | ELF header        |---+
+---------&gt; +-------------------+   | e_shoff
|           |                   |&lt;--+
| Section   | Section header 0  |
|           |                   |---+ sh_offset
| Header    +-------------------+   |
|           | Section header 1  |---|--+ sh_offset
| Table     +-------------------+   |  |
|           | Section header 2  |---|--|--+
+---------&gt; +-------------------+   |  |  |
            | Section 0         |&lt;--+  |  |
            +-------------------+      |  | sh_offset
            | Section 1         |&lt;-----+  |
            +-------------------+         |
            | Section 2         |&lt;--------+
            +-------------------+</code></pre></div></div></div><div class="p" id="_106">But nothing (except sanity) prevents the following topology:<div class="code" id="_107"><div><pre><code>            +-------------------+
            | ELF header        |---+ e_shoff
            +-------------------+   |
            | Section 1         |&lt;--|--+
+---------&gt; +-------------------+   |  |
|           |                   |&lt;--+  | sh_offset
| Section   | Section header 0  |      |
|           |                   |------|---------+
| Header    +-------------------+      |         |
|           | Section header 1  |------+         |
| Table     +-------------------+                |
|           | Section header 2  |---+            | sh_offset
+---------&gt; +-------------------+   | sh_offset  |
            | Section 2         |&lt;--+            |
            +-------------------+                |
            | Section 0         |&lt;---------------+
            +-------------------+</code></pre></div></div></div><div class="p" id="_108">But some newbies may prefer PNGs :-)</div><div class="figure"><figure id="image-elf-executable-and-linkable-format-diagram-by-ange-albertini"><div class="float-wrap"><a href="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/ELF_Executable_and_Linkable_Format_diagram_by_Ange_Albertini.png/1280px-ELF_Executable_and_Linkable_Format_diagram_by_Ange_Albertini.png"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/ELF_Executable_and_Linkable_Format_diagram_by_Ange_Albertini.png/1280px-ELF_Executable_and_Linkable_Format_diagram_by_Ange_Albertini.png" loading="lazy" height="900"></a></div><figcaption><a href="#image-elf-executable-and-linkable-format-diagram-by-ange-albertini"><span class="caption-prefix">Figure 1. </span></a><div class="title">ELF Executable and Linkable Format diagram by Ange Albertini</div>. <a href="https://github.com/corkami/pics/blob/28cb0226093ed57b348723bc473cea0162dad366/binary/elf101/elf101.pdf">Source</a>. </figcaption></figure></div><div class="h" id="section-vs-segment"><div class="notnav"><h2><a href="elf-hello-world/section-vs-segment"><span class="number">7. </span>Section vs segment</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/section-vs-segment"></a><span class="metrics"><span class="wcntr"> Words: 111</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/section-vs-segment" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/section-vs-segment"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_109">We will get into more detail later, but it is good to have it in mind now:</div><div class="list"><ul id="_110"><li id="_111"><div class="p" id="_112">section: exists before linking, in object files.</div><div class="p" id="_113">One ore more sections will be put inside a single segment by the linker.</div><div class="p" id="_114">Major information sections contain for the linker: is this section:<div class="list"><ul id="_115"><li id="_116">raw data to be loaded into memory, e.g. <code>.data</code>, <code>.text</code>, etc.</li><li id="_117">or metadata about other sections, that will be used by the linker, but disappear at runtime e.g. <code>.symtab</code>, <code>.srttab</code>, <code>.rela.text</code></li></ul></div></div></li><li id="_118"><div class="p" id="_119">segment: exists after linking, in the executable file.</div><div class="p" id="_120">Contains information about how each segment should be loaded into memory by the OS, notably location and permissions.</div></li></ul></div><div class="p" id="_121">See also:<div class="list"><ul id="_122"><li id="_123"><a href="https://stackoverflow.com/questions/14361248/whats-the-difference-of-section-and-segment-in-elf-file-format">stackoverflow.com/questions/14361248/whats-the-difference-of-section-and-segment-in-elf-file-format</a></li><li id="_124"><a href="https://stackoverflow.com/questions/23379880/difference-between-program-header-and-section-header-in-elf">stackoverflow.com/questions/23379880/difference-between-program-header-and-section-header-in-elf</a></li></ul></div></div><div class="h" id="elf-header"><div class="notnav"><h2><a href="elf-hello-world/elf-header"><span class="number">8. </span>ELF header</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/elf-header"></a><span class="metrics"><span class="wcntr"> Words: 823</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/elf-header" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/elf-header"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_125">Running:<div class="code" id="_126"><div><pre><code>readelf -h hello_world.o</code></pre></div></div>outputs:<div class="code" id="_127"><div><pre><code>Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
Class:                             ELF64
Data:                              2's complement, little endian
Version:                           1 (current)
OS/ABI:                            UNIX - System V
ABI Version:                       0
Type:                              REL (Relocatable file)
Machine:                           Advanced Micro Devices X86-64
Version:                           0x1
Entry point address:               0x0
Start of program headers:          0 (bytes into file)
Start of section headers:          64 (bytes into file)
Flags:                             0x0
Size of this header:               64 (bytes)
Size of program headers:           0 (bytes)
Number of program headers:         0
Size of section headers:           64 (bytes)
Number of section headers:         7
Section header string table index: 3</code></pre></div></div></div><div class="p" id="_128">Running:<div class="code" id="_129"><div><pre><code>readelf -h hello_world.out</code></pre></div></div>outputs:<div class="code" id="_130"><div><pre><code>Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
Class:                             ELF64
Data:                              2's complement, little endian
Version:                           1 (current)
OS/ABI:                            UNIX - System V
ABI Version:                       0
Type:                              EXEC (Executable file)
Machine:                           Advanced Micro Devices X86-64
Version:                           0x1
Entry point address:               0x4000b0
Start of program headers:          64 (bytes into file)
Start of section headers:          272 (bytes into file)
Flags:                             0x0
Size of this header:               64 (bytes)
Size of program headers:           56 (bytes)
Number of program headers:         2
Size of section headers:           64 (bytes)
Number of section headers:         6
Section header string table index: 3</code></pre></div></div></div><div class="p" id="_131">Bytes in the object file:<div class="code" id="_132"><div><pre><code>00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010  01 00 3e 00 01 00 00 00  00 00 00 00 00 00 00 00  |..&gt;.............|
00000020  00 00 00 00 00 00 00 00  40 00 00 00 00 00 00 00  |........@.......|
00000030  00 00 00 00 40 00 00 00  00 00 40 00 07 00 03 00  |....@.....@.....|</code></pre></div></div></div><div class="p" id="_133">Executable:<div class="code" id="_134"><div><pre><code>00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010  02 00 3e 00 01 00 00 00  b0 00 40 00 00 00 00 00  |..&gt;.......@.....|
00000020  40 00 00 00 00 00 00 00  10 01 00 00 00 00 00 00  |@...............|
00000030  00 00 00 00 40 00 38 00  02 00 40 00 06 00 03 00  |....@.8...@.....|</code></pre></div></div></div><div class="p" id="_135">Structure represented:<div class="code" id="_136"><div><pre><code># define EI_NIDENT 16

typedef struct {
    unsigned char   e_ident[EI_NIDENT];
    Elf64_Half      e_type;
    Elf64_Half      e_machine;
    Elf64_Word      e_version;
    Elf64_Addr      e_entry;
    Elf64_Off       e_phoff;
    Elf64_Off       e_shoff;
    Elf64_Word      e_flags;
    Elf64_Half      e_ehsize;
    Elf64_Half      e_phentsize;
    Elf64_Half      e_phnum;
    Elf64_Half      e_shentsize;
    Elf64_Half      e_shnum;
    Elf64_Half      e_shstrndx;
} Elf64_Ehdr;</code></pre></div></div></div><div class="p" id="_137">Manual breakdown:</div><div class="list"><ul id="_138"><li id="_139">0 0: <code>EI_MAG</code> = <code>7f 45 4c 46</code> = <code>0x7f 'E', 'L', 'F'</code>: ELF magic number</li><li id="_140">0 4: <code>EI_CLASS</code> = <code>02</code> = <code>ELFCLASS64</code>: 64 bit elf</li><li id="_141">0 5: <code>EI_DATA</code> = <code>01</code> = <code>ELFDATA2LSB</code>: little endian data</li><li id="_142">0 6: <code>EI_VERSION</code> = <code>01</code>: format version</li><li id="_143">0 7: <code>EI_OSABI</code> (only in 2003 Update) = <code>00</code> = <code>ELFOSABI_NONE</code>: no extensions.</li><li id="_144">0 8: <code>EI_PAD</code> = 8x <code>00</code>: reserved bytes. Must be set to 0.</li><li id="_145"><div class="p" id="_146">1 0: <code>e_type</code> = <code>01 00</code> = 1 (big endian) = <code>ET_REl</code>: relocatable format</div><div class="p" id="_147">On the executable it is <code>02 00</code> for <code>ET_EXEC</code>.</div><div class="p" id="_148">Another important possibility for the executable is <code>ET_DYN</code> for PIE executables and shared libraries.</div><div class="p" id="_149"><code>ET_DYN</code> tells the Linux kernel that the code is position independent, and can loaded at a random memory location with ASLR.</div><div class="p" id="_150">This is explained further at:<div class="list"><ul id="_151"><li id="_152"><a href="https://stackoverflow.com/questions/2463150/what-is-the-fpie-option-for-position-independent-executables-in-gcc-and-ld/51308031#51308031">stackoverflow.com/questions/2463150/what-is-the-fpie-option-for-position-independent-executables-in-gcc-and-ld/51308031#51308031</a></li><li id="_153"><a href="https://stackoverflow.com/questions/34519521/why-does-gcc-create-a-shared-object-instead-of-an-executable-binary-according-to/55704865#55704865">stackoverflow.com/questions/34519521/why-does-gcc-create-a-shared-object-instead-of-an-executable-binary-according-to/55704865#55704865</a></li></ul></div></div></li><li id="_154">1 2: <code>e_machine</code> = <code>3e 00</code> = <code>62</code> = <code>EM_X86_64</code>: AMD64 architecture</li><li id="_155">1 4: <code>e_version</code> = <code>01 00 00 00</code>: must be 1</li><li id="_156"><div class="p" id="_157">1 8: <code>e_entry</code> = 8x <code>00</code>: execution address entry point, or 0 if not applicable like for the object file since there is no entry point.</div><div class="p" id="_158">On the executable, it is <code>b0 00 40 00 00 00 00 00</code>. The kernel puts the RIP directly on that value when executing. It can be configured by the linker script or <code>-e</code>. But it will segfault if you set it too low: <a href="https://stackoverflow.com/questions/2187484/why-is-the-elf-execution-entry-point-virtual-address-of-the-form-0x80xxxxx-and-n">stackoverflow.com/questions/2187484/why-is-the-elf-execution-entry-point-virtual-address-of-the-form-0x80xxxxx-and-n</a></div></li><li id="_159"><div class="p" id="_160">2 0: <code>e_phoff</code> = 8x <code>00</code>: program header table offset, 0 if not present.</div><div class="p" id="_161"><code>40 00 00 00</code> on the executable, i.e. it starts immediately after the ELF header.</div></li><li id="_162">2 8: <code>e_shoff</code> = <code>40</code> 7x <code>00</code> = <code>0x40</code>: section header table file offset, 0 if not present.</li><li id="_163"><div class="p" id="_164">3 0: <code>e_flags</code> = <code>00 00 00 00</code> Arch specific. <code>i386</code> docs say:</div><div><blockquote id="_165">The Intel386 architecture defines no flags; so this member contains zero.</blockquote></div></li><li id="_166">3 4: <code>e_ehsize</code> = <code>40 00</code>: size of this elf header. TODO why this field needed? Isn't the size fixed?</li><li id="_167"><div class="p" id="_168">3 6: <code>e_phentsize</code> = <code>00 00</code>: size of each program header, 0 if not present.</div><div class="p" id="_169"><code>38 00</code> on executable: it is 56 bytes long</div></li><li id="_170"><div class="p" id="_171">3 8: <code>e_phnum</code> = <code>00 00</code>: number of program header entries, 0 if not present.</div><div class="p" id="_172"><code>02 00</code> on executable: there are 2 entries.</div></li><li id="_173">3 A: <code>e_shentsize</code> and <code>e_shnum</code> = <code>40 00 07 00</code>: section header size and number of entries</li><li id="_174">3 E: <code>e_shstrndx</code> (<code>Section Header STRing iNDeX</code>) = <code>03 00</code>: index of the <code>.shstrtab</code> section.</li></ul></div><div class="h" id="section-header-table"><div class="notnav"><h2><a href="elf-hello-world/section-header-table"><span class="number">9. </span>Section header table</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/section-header-table"></a><span class="metrics"><span class="wcntr"> Words: 252</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/section-header-table" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/section-header-table"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_175">Array of <code>Elf64_Shdr</code> structs.</div><div class="p" id="_176">Each entry contains metadata about a given section.</div><div class="p" id="_177"><code>e_shoff</code> of the ELF header gives the starting position, 0x40 here.</div><div class="p" id="_178"><code>e_shentsize</code> and <code>e_shnum</code> from the ELF header say that we have 7 entries, each <code>0x40</code> bytes long.</div><div class="p" id="_179">So the table takes bytes from 0x40 to <code>0x40 + 7 + 0x40 - 1</code> = 0x1FF.</div><div class="p" id="_180">Some section names are reserved for certain section types: <a href="http://www.sco.com/developers/gabi/2003-12-17/ch4.sheader.html#special_sections">www.sco.com/developers/gabi/2003-12-17/ch4.sheader.html#special_sections</a> e.g. <code>.text</code> requires a <code>SHT_PROGBITS</code> type and <code>SHF_ALLOC</code> + <code>SHF_EXECINSTR</code></div><div class="p" id="_181">Running:<div class="code" id="_182"><div><pre><code>readelf -S hello_world.o</code></pre></div></div>outputs:<div class="code" id="_183"><div><pre><code>There are 7 section headers, starting at offset 0x40:

Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .data             PROGBITS         0000000000000000  00000200
       000000000000000d  0000000000000000  WA       0     0     4
  [ 2] .text             PROGBITS         0000000000000000  00000210
       0000000000000027  0000000000000000  AX       0     0     16
  [ 3] .shstrtab         STRTAB           0000000000000000  00000240
       0000000000000032  0000000000000000           0     0     1
  [ 4] .symtab           SYMTAB           0000000000000000  00000280
       00000000000000a8  0000000000000018           5     6     4
  [ 5] .strtab           STRTAB           0000000000000000  00000330
       0000000000000034  0000000000000000           0     0     1
  [ 6] .rela.text        RELA             0000000000000000  00000370
       0000000000000018  0000000000000018           4     2     4
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)
  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)
  O (extra OS processing required) o (OS specific), p (processor specific)</code></pre></div></div></div><div class="p" id="_184">The <code>struct</code> represented by each entry is:<div class="code" id="_185"><div><pre><code>typedef struct {
    Elf64_Word  sh_name;
    Elf64_Word  sh_type;
    Elf64_Xword sh_flags;
    Elf64_Addr  sh_addr;
    Elf64_Off   sh_offset;
    Elf64_Xword sh_size;
    Elf64_Word  sh_link;
    Elf64_Word  sh_info;
    Elf64_Xword sh_addralign;
    Elf64_Xword sh_entsize;
} Elf64_Shdr;</code></pre></div></div></div><div class="h" id="sections"><div class="notnav"><h2><a href="elf-hello-world/sections"><span class="number">10. </span>Sections</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/sections"></a><span class="metrics"><span class="wcntr"> Words: 3k</span><span class="dcnt"> Articles: 20</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/sections" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/sections"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="h" id="index-0-section"><div class="notnav"><h3><a href="elf-hello-world/index-0-section"><span class="number">10.1. </span>Index 0 section</a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/index-0-section"></a><span class="metrics"><span class="wcntr"> Words: 92</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/index-0-section" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/index-0-section"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_186">Contained in bytes 0x40 to 0x7F.</div><div class="p" id="_187">The first section is always magic: <a href="http://www.sco.com/developers/gabi/2003-12-17/ch4.sheader.html">www.sco.com/developers/gabi/2003-12-17/ch4.sheader.html</a> says:</div><div><blockquote id="_188">If the number of sections is greater than or equal to SHN_LORESERVE (0xff00), e_shnum has the value SHN_UNDEF (0) and the actual number of section header table entries is contained in the sh_size field of the section header at index 0 (otherwise, the sh_size member of the initial entry contains 0).</blockquote></div><div class="p" id="_189">There are also other magic sections detailed in <code>Figure 4-7: Special Section Indexes</code>.</div><div class="h" id="sht-null"><div class="notnav"><h4><a href="elf-hello-world/sht-null"><span class="number">10.1.1. </span><code>SHT_NULL</code></a></h4><span class="hover-meta"> <a class="split" href="elf-hello-world/sht-null"></a><span class="metrics"><span class="wcntr"> Words: 14</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#index-0-section" class="u"> Index 0 section</a><a href="#_toc/sht-null" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/sht-null"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_190">In index 0, <code>SHT_NULL</code> is mandatory. Are there any other uses for it: <a href="https://stackoverflow.com/questions/26812142/what-is-the-use-of-the-sht-null-section-in-elf">stackoverflow.com/questions/26812142/what-is-the-use-of-the-sht-null-section-in-elf</a> ?</div><div class="h" id="data-section"><div class="notnav"><h3><a href="elf-hello-world/data-section"><span class="number">10.2. </span><code>.data</code> section</a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/data-section"></a><span class="metrics"><span class="wcntr"> Words: 499</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/data-section" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/data-section"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_191"><code>.data</code> is section 1:<div class="code" id="_192"><div><pre><code>00000080  01 00 00 00 01 00 00 00  03 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 02 00 00 00 00 00 00  |................|
000000a0  0d 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000b0  04 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</code></pre></div></div></div><div class="list"><ul id="_193"><li id="_194"><div class="p" id="_195">80 0: <code>sh_name</code> = <code>01 00 00 00</code>: index 1 in the <code>.shstrtab</code> string table</div><div class="p" id="_196">Here, <code>1</code> says the name of this section starts at the first character of that section, and ends at the first NUL character, making up the string <code>.data</code>.</div><div class="p" id="_197"><code>.data</code> is one of the section names which has a predefined meaning according to <a href="http://www.sco.com/developers/gabi/2003-12-17/ch4.strtab.html">www.sco.com/developers/gabi/2003-12-17/ch4.strtab.html</a>:<div><blockquote id="_198">These sections hold initialized data that contribute to the program's memory image.</blockquote></div></div></li></ul></div><div class="list"><ul id="_199"><li id="_200">80 4: <code>sh_type</code> = <code>01 00 00 00</code>: <code>SHT_PROGBITS</code>: the section content is not specified by ELF, only by how the program interprets it. Normal since a <code>.data</code> section.</li><li id="_201">80 8: <code>sh_flags</code> = <code>03</code> 7x <code>00</code>: <code>SHF_WRITE</code> and <code>SHF_ALLOC</code>: <a href="http://www.sco.com/developers/gabi/2003-12-17/ch4.sheader.html#sh_flags,">www.sco.com/developers/gabi/2003-12-17/ch4.sheader.html#sh_flags,</a> as required from a <code>.data</code> section</li><li id="_202">90 0: <code>sh_addr</code> = 8x <code>00</code>: TODO: standard says:<div><blockquote id="_203">If the section will appear in the memory image of a process, this member gives the address at which the section's first byte should reside. Otherwise, the member contains 0.</blockquote></div>but I don't understand it very well yet.</li><li id="_204">90 8: <code>sh_offset</code> = <code>00 02 00 00 00 00 00 00</code> = <code>0x200</code>: number of bytes from the start of the program to the first byte in this section</li><li id="_205"><div class="p" id="_206">a0 0: <code>sh_size</code> = <code>0d 00 00 00 00 00 00 00</code></div><div class="p" id="_207">If we take 0xD bytes starting at <code>sh_offset</code> 200, we see:</div><div class="code" id="_208"><div><pre><code>00000200  48 65 6c 6c 6f 20 77 6f  72 6c 64 21 0a 00        |Hello world!..  |</code></pre></div></div><div class="p" id="_209">AHA! So our <code>"Hello world!"</code> string is in the data section like we told it to be on the NASM.</div><div class="p" id="_210">Once we graduate from <code>hd</code>, we will look this up like:</div><div class="code" id="_211"><div><pre><code>readelf -x .data hello_world.o</code></pre></div></div><div class="p" id="_212">which outputs:</div><div class="code" id="_213"><div><pre><code>Hex dump of section '.data':
  0x00000000 48656c6c 6f20776f 726c6421 0a       Hello world!.</code></pre></div></div><div class="p" id="_214">NASM sets decent properties for that section because it treats <code>.data</code> magically: <a href="https://www.nasm.us/doc/nasmdoc7.html#section-7.9.2">www.nasm.us/doc/nasmdoc7.html#section-7.9.2</a></div><div class="p" id="_215">Also note that this was a bad section choice: a good C compiler would put the string in <code>.rodata</code> instead, because it is read-only and it would allow for further OS optimizations.<div class="list"><ul id="_216"><li id="_217">a0 8: <code>sh_link</code> and <code>sh_info</code> = 8x 0: do not apply to this section type. <a href="http://www.sco.com/developers/gabi/2003-12-17/ch4.sheader.html#special_sections">www.sco.com/developers/gabi/2003-12-17/ch4.sheader.html#special_sections</a></li><li id="_218">b0 0: <code>sh_addralign</code> = <code>04</code> = TODO: why is this alignment necessary? Is it only for <code>sh_addr</code>, or also for symbols inside <code>sh_addr</code>?</li><li id="_219">b0 8: <code>sh_entsize</code> = <code>00</code> = the section does not contain a table. If != 0, it means that the section contains a table of fixed size entries. In this file, we see from the <code>readelf</code> output that this is the case for the <code>.symtab</code> and <code>.rela.text</code> sections.</li></ul></div></div></li></ul></div><div class="h" id="text-section"><div class="notnav"><h3><a href="elf-hello-world/text-section"><span class="number">10.3. </span><code>.text</code> section</a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/text-section"></a><span class="metrics"><span class="wcntr"> Words: 258</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/text-section" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/text-section"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_220">Now that we've done one section manually, let's graduate and use the <code>readelf -S</code> of the other sections:<div class="code" id="_221"><div><pre><code>  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 2] .text             PROGBITS         0000000000000000  00000210
       0000000000000027  0000000000000000  AX       0     0     16</code></pre></div></div></div><div class="p" id="_222"><code>.text</code> is executable but not writable: if we try to write to it Linux segfaults. Let's see if we really have some code there:<div class="code" id="_223"><div><pre><code>objdump -d hello_world.o</code></pre></div></div>gives:<div class="code" id="_224"><div><pre><code>hello_world.o:     file format elf64-x86-64


Disassembly of section .text:

0000000000000000 &lt;_start&gt;:
   0:       b8 01 00 00 00          mov    $0x1,%eax
   5:       bf 01 00 00 00          mov    $0x1,%edi
   a:       48 be 00 00 00 00 00    movabs $0x0,%rsi
  11:       00 00 00
  14:       ba 0d 00 00 00          mov    $0xd,%edx
  19:       0f 05                   syscall
  1b:       b8 3c 00 00 00          mov    $0x3c,%eax
  20:       bf 00 00 00 00          mov    $0x0,%edi
  25:       0f 05                   syscall</code></pre></div></div></div><div class="p" id="_225">If we grep <code>b8 01 00 00</code> on the <code>hd</code>, we see that this only occurs at <code>00000210</code>, which is what the section says. And the Size is 27, which matches as well. So we must be talking about the right section.</div><div class="p" id="_226">This looks like the right code: a <code>write</code> followed by an <code>exit</code>.</div><div class="p" id="_227">The most interesting part is line <code>a</code> which does:<div class="code" id="_228"><div><pre><code>movabs $0x0,%rsi</code></pre></div></div>to pass the address of the string to the system call. Currently, the <code>0x0</code> is just a placeholder. After linking happens, it will be modified to contain:<div class="code" id="_229"><div><pre><code>4000ba: 48 be d8 00 60 00 00    movabs $0x6000d8,%rsi</code></pre></div></div>This modification is possible because of the data of the <code>.rela.text</code> section.</div><div class="h" id="sht-strtab"><div class="notnav"><h3><a href="elf-hello-world/sht-strtab"><span class="number">10.4. </span><code>SHT_STRTAB</code></a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/sht-strtab"></a><span class="metrics"><span class="wcntr"> Words: 125</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/sht-strtab" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/sht-strtab"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_230">Sections with <code>sh_type == SHT_STRTAB</code> are called string tables.</div><div class="p" id="_231">They hold a null separated array of strings.</div><div class="p" id="_232">Such sections are used by other sections when string names are to be used. The using section says:<div class="list"><ul id="_233"><li id="_234">which string table they are using</li><li id="_235">what is the index on the target string table where the string starts</li></ul></div></div><div class="p" id="_236">So for example, we could have a string table containing:<div class="code" id="_237"><div><pre><code>Data: \0 a b c \0 d e f \0
Index: 0 1 2 3  4 5 6 7  8</code></pre></div></div></div><div class="p" id="_238">The first byte must be a 0. TODO rationale?</div><div class="p" id="_239">And if another section wants to use the string <code>d e f</code>, they have to point to index <code>5</code> of this section (letter <code>d</code>).</div><div class="p" id="_240">Notable string table sections:<div class="list"><ul id="_241"><li id="_242"><code>.shstrtab</code></li><li id="_243"><code>.strtab</code></li></ul></div></div><div class="h" id="shstrtab"><div class="notnav"><h3><a href="elf-hello-world/shstrtab"><span class="number">10.5. </span><code>.shstrtab</code></a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/shstrtab"></a><span class="metrics"><span class="wcntr"> Words: 159</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/shstrtab" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/shstrtab"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_244">Section type: <code>sh_type == SHT_STRTAB</code>.</div><div class="p" id="_245">Common name: "section header string table".</div><div class="p" id="_246">The section name <code>.shstrtab</code> is reserved. The standard says:<div><blockquote id="_247">This section holds section names.</blockquote></div></div><div class="p" id="_248">This section gets pointed to by the <code>e_shstrnd</code> field of the ELF header itself.</div><div class="p" id="_249">String indexes of this section are are pointed to by the <code>sh_name</code> field of section headers, which denote strings.</div><div class="p" id="_250">This section does not have <code>SHF_ALLOC</code> marked, so it will not appear on the executing program.<div class="code" id="_251"><div><pre><code>readelf -x .shstrtab hello_world.o</code></pre></div></div>outputs:<div class="code" id="_252"><div><pre><code>Hex dump of section '.shstrtab':
  0x00000000 002e6461 7461002e 74657874 002e7368 ..data..text..sh
  0x00000010 73747274 6162002e 73796d74 6162002e strtab..symtab..
  0x00000020 73747274 6162002e 72656c61 2e746578 strtab..rela.tex
  0x00000030 7400                                t.</code></pre></div></div></div><div class="p" id="_253">The data in this section has a fixed format: <a href="http://www.sco.com/developers/gabi/2003-12-17/ch4.strtab.html">www.sco.com/developers/gabi/2003-12-17/ch4.strtab.html</a></div><div class="p" id="_254">If we look at the names of other sections, we see that they all contain numbers, e.g. the <code>.text</code> section is number <code>7</code>.</div><div class="p" id="_255">Then each string ends when the first NUL character is found, e.g. character <code>12</code> is <code>\0</code> just after <code>.text\0</code>.</div><div class="h" id="symtab"><div class="notnav"><h3><a href="elf-hello-world/symtab"><span class="number">10.6. </span><code>.symtab</code></a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/symtab"></a><span class="metrics"><span class="wcntr"> Words: 792</span><span class="dcnt"> Articles: 5</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/symtab" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/symtab"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_256">Section type: <code>sh_type == SHT_SYMTAB</code>.</div><div class="p" id="_257">Common name: "symbol table".</div><div class="p" id="_258">First the we note that:<div class="list"><ul id="_259"><li id="_260"><code>sh_link</code> = <code>5</code></li><li id="_261"><code>sh_info</code> = <code>6</code></li></ul></div></div><div class="p" id="_262">For <code>SHT_SYMTAB</code> sections, those numbers mean that:<div class="list"><ul id="_263"><li id="_264">strings that give symbol names are in section 5, <code>.strtab</code></li><li id="_265">the relocation data is in section 6, <code>.rela.text</code></li></ul></div></div><div class="p" id="_266">A good high level tool to disassemble that section is:<div class="code" id="_267"><div><pre><code>nm hello_world.o</code></pre></div></div>which gives:<div class="code" id="_268"><div><pre><code>0000000000000000 T _start
0000000000000000 d hello_world
000000000000000d a hello_world_len</code></pre></div></div></div><div class="p" id="_269">This is however a high level view that omits some types of symbols and in which the symbol types . A more detailed disassembly can be obtained with:<div class="code" id="_270"><div><pre><code>readelf -s hello_world.o</code></pre></div></div>which gives:<div class="code" id="_271"><div><pre><code>Symbol table '.symtab' contains 7 entries:
   Num:    Value          Size Type    Bind   Vis      Ndx Name
     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS hello_world.asm
     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1
     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    2
     4: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT    1 hello_world
     5: 000000000000000d     0 NOTYPE  LOCAL  DEFAULT  ABS hello_world_len
     6: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT    2 _start</code></pre></div></div></div><div class="p" id="_272">The binary format of the table is documented at <a href="http://www.sco.com/developers/gabi/2003-12-17/ch4.symtab.html">www.sco.com/developers/gabi/2003-12-17/ch4.symtab.html</a></div><div class="p" id="_273">The data is:<div class="code" id="_274"><div><pre><code>readelf -x .symtab hello_world.o</code></pre></div></div>which gives:<div class="code" id="_275"><div><pre><code>Hex dump of section '.symtab':
  0x00000000 00000000 00000000 00000000 00000000 ................
  0x00000010 00000000 00000000 01000000 0400f1ff ................
  0x00000020 00000000 00000000 00000000 00000000 ................
  0x00000030 00000000 03000100 00000000 00000000 ................
  0x00000040 00000000 00000000 00000000 03000200 ................
  0x00000050 00000000 00000000 00000000 00000000 ................
  0x00000060 11000000 00000100 00000000 00000000 ................
  0x00000070 00000000 00000000 1d000000 0000f1ff ................
  0x00000080 0d000000 00000000 00000000 00000000 ................
  0x00000090 2d000000 10000200 00000000 00000000 -...............
  0x000000a0 00000000 00000000                   ........</code></pre></div></div></div><div class="p" id="_276">The entries are of type:<div class="code" id="_277"><div><pre><code>typedef struct {
    Elf64_Word  st_name;
    unsigned char   st_info;
    unsigned char   st_other;
    Elf64_Half  st_shndx;
    Elf64_Addr  st_value;
    Elf64_Xword st_size;
} Elf64_Sym;</code></pre></div></div></div><div class="p" id="_278">Like in the section table, the first entry is magical and set to a fixed meaningless values.</div><div class="h" id="stt-file"><div class="notnav"><h4><a href="elf-hello-world/stt-file"><span class="number">10.6.1. </span><code>STT_FILE</code></a></h4><span class="hover-meta"> <a class="split" href="elf-hello-world/stt-file"></a><span class="metrics"><span class="wcntr"> Words: 199</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#symtab" class="u"> <code>.symtab</code></a><a href="#_toc/stt-file" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/stt-file"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_279">Entry 1 has <code>ELF64_R_TYPE == STT_FILE</code>. <code>ELF64_R_TYPE</code> is continued inside of <code>st_info</code>.</div><div class="p" id="_280">Byte analysis:</div><div class="list"><ul id="_281"><li id="_282"><div class="p" id="_283">10 8: <code>st_name</code> = <code>01000000</code> = character 1 in the <code>.strtab</code>, which until the following <code>\0</code> makes <code>hello_world.asm</code></div><div class="p" id="_284">This piece of information file may be used by the linker to decide on which segment sections go: e.g. in <code>ld</code> linker script we write:</div><div class="code" id="_285"><div><pre><code>segment_name :
{
    file(section)
}</code></pre></div></div><div class="p" id="_286">to pick a section from a given file.</div><div class="p" id="_287">Most of the time however, we will just dump all sections with a given name together with:</div><div class="code" id="_288"><div><pre><code>segment_name :
{
    *(section)
}</code></pre></div></div></li><li id="_289"><div class="p" id="_290">10 12: <code>st_info</code> = <code>04</code></div><div class="p" id="_291">Bits 0-3 = <code>ELF64_R_TYPE</code> = Type = <code>4</code> = <code>STT_FILE</code>: the main purpose of this entry is to use <code>st_name</code> to indicate the name of the file which generated this object file.</div><div class="p" id="_292">Bits 4-7 = <code>ELF64_ST_BIND</code> = Binding = <code>0</code> = <code>STB_LOCAL</code>. Required value for <code>STT_FILE</code>.</div></li><li id="_293">10 13: <code>st_shndx</code> = Symbol Table Section header Index = <code>f1ff</code> = <code>SHN_ABS</code>. Required for <code>STT_FILE</code>.</li><li id="_294">20 0: <code>st_value</code> = 8x <code>00</code>: required for value for <code>STT_FILE</code></li><li id="_295">20 8: <code>st_size</code> = 8x <code>00</code>: no allocated size</li></ul></div><div class="p" id="_296">Now from the <code>readelf</code>, we interpret the others quickly.</div><div class="h" id="stt-section"><div class="notnav"><h4><a href="elf-hello-world/stt-section"><span class="number">10.6.2. </span><code>STT_SECTION</code></a></h4><span class="hover-meta"> <a class="split" href="elf-hello-world/stt-section"></a><span class="metrics"><span class="wcntr"> Words: 47</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#symtab" class="u"> <code>.symtab</code></a><a href="#_toc/stt-section" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/stt-section"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_297">There are two such entries, one pointing to <code>.data</code> and the other to <code>.text</code> (section indexes <code>1</code> and <code>2</code>).<div class="code" id="_298"><div><pre><code>Num:    Value          Size Type    Bind   Vis      Ndx Name
  2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1
  3: 0000000000000000     0 SECTION LOCAL  DEFAULT    2</code></pre></div></div></div><div class="p" id="_299">TODO what is their purpose?</div><div class="h" id="stt-notype"><div class="notnav"><h4><a href="elf-hello-world/stt-notype"><span class="number">10.6.3. </span><code>STT_NOTYPE</code></a></h4><span class="hover-meta"> <a class="split" href="elf-hello-world/stt-notype"></a><span class="metrics"><span class="wcntr"> Words: 201</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#symtab" class="u"> <code>.symtab</code></a><a href="#_toc/stt-notype" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/stt-notype"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_300">Then come the most important symbols:<div class="code" id="_301"><div><pre><code>Num:    Value          Size Type    Bind   Vis      Ndx Name
  4: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT    1 hello_world
  5: 000000000000000d     0 NOTYPE  LOCAL  DEFAULT  ABS hello_world_len
  6: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT    2 _start</code></pre></div></div></div><div class="p" id="_302"><code>hello_world</code> string is in the <code>.data</code> section (index 1). It's value is 0: it points to the first byte of that section.</div><div class="p" id="_303"><code>_start</code> is marked with <code>GLOBAL</code> visibility since we wrote:<div class="code" id="_304"><div><pre><code>global _start</code></pre></div></div></div><div class="p" id="_305">in NASM. This is necessary since it must be seen as the entry point. Unlike in C, by default NASM labels are local.</div><div class="h" id="shn-abs"><div class="notnav"><h5><a href="elf-hello-world/shn-abs"><span class="number">10.6.3.1. </span><code>SHN_ABS</code></a></h5><span class="hover-meta"> <a class="split" href="elf-hello-world/shn-abs"></a><span class="metrics"><span class="wcntr"> Words: 107</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#stt-notype" class="u"> <code>STT_NOTYPE</code></a><a href="#_toc/shn-abs" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/shn-abs"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_306"><code>hello_world_len</code> points to the special <code>st_shndx == SHN_ABS == 0xF1FF</code>.</div><div class="p" id="_307"><code>0xF1FF</code> is chosen so as to not conflict with other sections.</div><div class="p" id="_308"><code>st_value == 0xD == 13</code> which is the value we have stored there on the assembly: the length of the string <code>Hello World!</code>.</div><div class="p" id="_309">This means that relocation will not affect this value: it is a constant.</div><div class="p" id="_310">This is small optimization that our assembler does for us and which has ELF support.</div><div class="p" id="_311">If we had used the address of <code>hello_world_len</code> anywhere, the assembler would not have been able to mark it as <code>SHN_ABS</code>, and the linker would have extra relocation work on it later.</div><div class="h" id="sht-symtab-on-the-executable"><div class="notnav"><h4><a href="elf-hello-world/sht-symtab-on-the-executable"><span class="number">10.6.4. </span><code>SHT_SYMTAB</code> on the executable</a></h4><span class="hover-meta"> <a class="split" href="elf-hello-world/sht-symtab-on-the-executable"></a><span class="metrics"><span class="wcntr"> Words: 48</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#symtab" class="u"> <code>.symtab</code></a><a href="#_toc/sht-symtab-on-the-executable" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/sht-symtab-on-the-executable"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_312">By default, NASM places a <code>.symtab</code> on the executable as well.</div><div class="p" id="_313">This is only used for debugging. Without the symbols, we are completely blind, and must reverse engineer everything.</div><div class="p" id="_314">You can strip it with <code>objcopy</code>, and the executable will still run. Such executables are called "stripped executables".</div><div class="h" id="strtab"><div class="notnav"><h3><a href="elf-hello-world/strtab"><span class="number">10.7. </span><code>.strtab</code></a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/strtab"></a><span class="metrics"><span class="wcntr"> Words: 72</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/strtab" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/strtab"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_315">Holds strings for the symbol table.</div><div class="p" id="_316">This section has <code>sh_type == SHT_STRTAB</code>.</div><div class="p" id="_317">It is pointed to by <code>sh_link == 5</code> of the <code>.symtab</code> section.<div class="code" id="_318"><div><pre><code>readelf -x .strtab hello_world.o</code></pre></div></div>outputs:<div class="code" id="_319"><div><pre><code>Hex dump of section '.strtab':
  0x00000000 0068656c 6c6f5f77 6f726c64 2e61736d .hello_world.asm
  0x00000010 0068656c 6c6f5f77 6f726c64 0068656c .hello_world.hel
  0x00000020 6c6f5f77 6f726c64 5f6c656e 005f7374 lo_world_len._st
  0x00000030 61727400                            art.</code></pre></div></div></div><div class="p" id="_320">This implies that it is an ELF level limitation that global variables cannot contain NUL characters.</div><div class="h" id="rela-text"><div class="notnav"><h3><a href="elf-hello-world/rela-text"><span class="number">10.8. </span><code>.rela.text</code></a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/rela-text"></a><span class="metrics"><span class="wcntr"> Words: 429</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/rela-text" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/rela-text"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_321">Section type: <code>sh_type == SHT_RELA</code>.</div><div class="p" id="_322">Common name: "relocation section".</div><div class="p" id="_323"><code>.rela.text</code> holds relocation data which says how the address should be modified when the final executable is linked. This points to bytes of the text area that must be modified when linking happens to point to the correct memory locations.</div><div class="p" id="_324">Basically, it translates the object text containing the placeholder 0x0 address:<div class="code" id="_325"><div><pre><code>   a:       48 be 00 00 00 00 00    movabs $0x0,%rsi
  11:       00 00 00</code></pre></div></div>to the actual executable code containing the final 0x6000d8:<div class="code" id="_326"><div><pre><code>4000ba: 48 be d8 00 60 00 00    movabs $0x6000d8,%rsi
4000c1: 00 00 00</code></pre></div></div></div><div class="p" id="_327">It was pointed to by <code>sh_info</code> = <code>6</code> of the <code>.symtab</code> section.</div><div class="p" id="_328"><code>readelf -r hello_world.o</code> outputs:<div class="code" id="_329"><div><pre><code>Relocation section '.rela.text' at offset 0x3b0 contains 1 entries:
  Offset          Info           Type           Sym. Value    Sym. Name + Addend
00000000000c  000200000001 R_X86_64_64       0000000000000000 .data + 0</code></pre></div></div></div><div class="p" id="_330">The section does not exist in the executable.</div><div class="p" id="_331">The actual bytes are:<div class="code" id="_332"><div><pre><code>00000370  0c 00 00 00 00 00 00 00  01 00 00 00 02 00 00 00  |................|
00000380  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</code></pre></div></div></div><div class="p" id="_333">The <code>struct</code> represented is:<div class="code" id="_334"><div><pre><code>typedef struct {
    Elf64_Addr  r_offset;
    Elf64_Xword r_info;
    Elf64_Sxword    r_addend;
} Elf64_Rela;</code></pre></div></div></div><div class="p" id="_335">So:<div class="list"><ul id="_336"><li id="_337">370 0: <code>r_offset</code> = 0xC: address into the <code>.text</code> whose address this relocation will modify</li><li id="_338"><div class="p" id="_339">370 8: <code>r_info</code> = 0x200000001. Contains 2 fields:<div class="list"><ul id="_340"><li id="_341"><code>ELF64_R_TYPE</code> = 0x1: meaning depends on the exact architecture.</li><li id="_342"><code>ELF64_R_SYM</code> = 0x2: index of the section to which the address points, so <code>.data</code> which is at index 2.</li></ul></div></div><div class="p" id="_343">The AMD64 ABI says that type <code>1</code> is called <code>R_X86_64_64</code> and that it represents the operation <code>S + A</code> where:<div class="list"><ul id="_344"><li id="_345"><code>S</code>: the value of the symbol on the object file, here <code>0</code> because we point to the <code>00 00 00 00 00 00 00 00</code> of <code>movabs $0x0,%rsi</code></li><li id="_346"><code>A</code>: the addend, present in field <code>r_added</code></li></ul></div></div><div class="p" id="_347">This address is added to the section on which the relocation operates.</div><div class="p" id="_348">This relocation operation acts on a total 8 bytes.</div></li><li id="_349">380 0: <code>r_addend</code> = 0</li></ul></div></div><div class="p" id="_350">So in our example we conclude that the new address will be: <code>S + A</code> = <code>.data + 0</code>, and thus the first thing in the data section.</div><div class="h" id="rel-text"><div class="notnav"><h4><a href="elf-hello-world/rel-text"><span class="number">10.8.1. </span><code>.rel.text</code></a></h4><span class="hover-meta"> <a class="split" href="elf-hello-world/rel-text"></a><span class="metrics"><span class="wcntr"> Words: 63</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#rela-text" class="u"> <code>.rela.text</code></a><a href="#_toc/rel-text" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/rel-text"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_351">Besides <code>sh_type == SHT_RELA</code>, there also exists <code>SHT_REL</code>, which would have section name <code>.text.rel</code> (not present in this object file).</div><div class="p" id="_352">Those represent the same <code>struct</code>, but without the addend, e.g.:<div class="code" id="_353"><div><pre><code>typedef struct {
    Elf64_Addr  r_offset;
    Elf64_Xword r_info;
} Elf64_Rela;</code></pre></div></div></div><div class="p" id="_354">The ELF standard says that in many cases the both can be used, and it is just a matter of convenience.</div><div class="h" id="dynamic-linking-sections"><div class="notnav"><h3><a href="elf-hello-world/dynamic-linking-sections"><span class="number">10.9. </span>Dynamic linking sections</a></h3><span class="hover-meta"> <a class="split" href="elf-hello-world/dynamic-linking-sections"></a><span class="metrics"><span class="wcntr"> Words: 105</span><span class="dcnt"> Articles: 4</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#sections" class="u"> Sections</a><a href="#_toc/dynamic-linking-sections" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/dynamic-linking-sections"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_355">This program did not have certain dynamic linking related sections because we linked it minimally with <code>ld</code>.</div><div class="p" id="_356">However, if you compile a C hello world with GCC 8.2:<div class="code" id="_357"><div><pre><code>gcc -o main.out main.c</code></pre></div></div></div><div class="p" id="_358">some other interesting sections would appear.</div><div class="h" id="pt-interp"><div class="notnav"><h4><a href="elf-hello-world/pt-interp"><span class="number">10.9.1. </span><code>PT_INTERP</code></a></h4><span class="hover-meta"> <a class="split" href="elf-hello-world/pt-interp"></a><span class="metrics"><span class="wcntr"> Words: 14</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#dynamic-linking-sections" class="u"> Dynamic linking sections</a><a href="#_toc/pt-interp" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/pt-interp"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_359">Contains the path to the dynamic loader, i.e. <code>/lib64/ld-linux-x86-64.so.2</code> in Ubuntu 18.10. Explained at: <a href="https://stackoverflow.com/questions/8040631/checking-if-a-binary-compiled-with-static/55664341#55664341">stackoverflow.com/questions/8040631/checking-if-a-binary-compiled-with-static/55664341#55664341</a></div><div class="h" id="dynamic-section"><div class="notnav"><h4><a href="elf-hello-world/dynamic-section"><span class="number">10.9.2. </span>Dynamic section</a></h4><span class="hover-meta"> <a class="split" href="elf-hello-world/dynamic-section"></a><span class="metrics"><span class="wcntr"> Words: 52</span><span class="dcnt"> Articles: 2</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#dynamic-linking-sections" class="u"> Dynamic linking sections</a><a href="#_toc/dynamic-section" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/dynamic-section"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_360">Contains a lot of different flag masks.</div><div class="h" id="dt-flags-1"><div class="notnav"><h5><a href="elf-hello-world/dt-flags-1"><span class="number">10.9.2.1. </span><code>DT_FLAGS_1</code></a></h5><span class="hover-meta"> <a class="split" href="elf-hello-world/dt-flags-1"></a><span class="metrics"><span class="wcntr"> Words: 45</span><span class="dcnt"> Articles: 1</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#dynamic-section" class="u"> Dynamic section</a><a href="#_toc/dt-flags-1" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/dt-flags-1"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_361">Seems to be a GNU Binutils extension</div><div class="h" id="df-1-pie"><div class="notnav"><h6><a href="elf-hello-world/df-1-pie"><span class="number">10.9.2.1.1. </span><code>DF_1_PIE</code></a></h6><span class="hover-meta"> <a class="split" href="elf-hello-world/df-1-pie"></a><span class="metrics"><span class="wcntr"> Words: 38</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="#dt-flags-1" class="u"> <code>DT_FLAGS_1</code></a><a href="#_toc/df-1-pie" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/df-1-pie"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_362">Determines if an executable is a position independent executable (PIE).</div><div class="p" id="_363">Seems to be informational only, since not used by Linux kernel 5.0 or glibc 2.29.</div><div class="p" id="_364"><code>file</code> 5.36 however does use it to display file type as explained at: <a href="https://stackoverflow.com/questions/34519521/why-does-gcc-create-a-shared-object-instead-of-an-executable-binary-according-to/55704865#55704865">stackoverflow.com/questions/34519521/why-does-gcc-create-a-shared-object-instead-of-an-executable-binary-according-to/55704865#55704865</a></div><div class="h" id="program-header-table"><div class="notnav"><h2><a href="elf-hello-world/program-header-table"><span class="number">11. </span>Program header table</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/program-header-table"></a><span class="metrics"><span class="wcntr"> Words: 759</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/program-header-table" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/program-header-table"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_365">Only appears in the executable.</div><div class="p" id="_366">Contains information of how the executable should be put into the process virtual memory.</div><div class="p" id="_367">The executable is generated from object files by the linker. The main jobs that the linker does are:</div><div class="list"><ul id="_368"><li id="_369"><div class="p" id="_370">determine which sections of the object files will go into which segments of the executable.</div><div class="p" id="_371">In Binutils, this comes down to parsing a linker script, and dealing with a bunch of defaults.</div><div class="p" id="_372">You can get the linker script used with <code>ld --verbose</code>, and set a custom one with <code>ld -T</code>.</div></li><li id="_373">do relocation according to the <code>.rela.text</code> section. This depends on how the multiple sections are put into memory.</li></ul></div><div class="p" id="_374"><code>readelf -l hello_world.out</code> gives:<div class="code" id="_375"><div><pre><code>Elf file type is EXEC (Executable file)
Entry point 0x4000b0
There are 2 program headers, starting at offset 64

Program Headers:
  Type           Offset             VirtAddr           PhysAddr
                 FileSiz            MemSiz              Flags  Align
  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000
                 0x00000000000000d7 0x00000000000000d7  R E    200000
  LOAD           0x00000000000000d8 0x00000000006000d8 0x00000000006000d8
                 0x000000000000000d 0x000000000000000d  RW     200000

 Section to Segment mapping:
  Segment Sections...
   00     .text
   01     .data</code></pre></div></div></div><div class="p" id="_376">On the ELF header, <code>e_phoff</code>, <code>e_phnum</code> and <code>e_phentsize</code> told us that there are 2 program headers, which start at <code>0x40</code> and are <code>0x38</code> bytes long each, so they are:<div class="code" id="_377"><div><pre><code>00000040  01 00 00 00 05 00 00 00  00 00 00 00 00 00 00 00  |................|
00000050  00 00 40 00 00 00 00 00  00 00 40 00 00 00 00 00  |..@.......@.....|
00000060  d7 00 00 00 00 00 00 00  d7 00 00 00 00 00 00 00  |................|
00000070  00 00 20 00 00 00 00 00                           |.. .....        |</code></pre></div></div>and:<div class="code" id="_378"><div><pre><code>00000070                           01 00 00 00 06 00 00 00  |        ........|
00000080  d8 00 00 00 00 00 00 00  d8 00 60 00 00 00 00 00  |..........`.....|
00000090  d8 00 60 00 00 00 00 00  0d 00 00 00 00 00 00 00  |..`.............|
000000a0  0d 00 00 00 00 00 00 00  00 00 20 00 00 00 00 00  |.......... .....|</code></pre></div></div></div><div class="p" id="_379">Structure represented <a href="http://www.sco.com/developers/gabi/2003-12-17/ch5.pheader.html">www.sco.com/developers/gabi/2003-12-17/ch5.pheader.html</a>:<div class="code" id="_380"><div><pre><code>typedef struct {
    Elf64_Word  p_type;
    Elf64_Word  p_flags;
    Elf64_Off   p_offset;
    Elf64_Addr  p_vaddr;
    Elf64_Addr  p_paddr;
    Elf64_Xword p_filesz;
    Elf64_Xword p_memsz;
    Elf64_Xword p_align;
} Elf64_Phdr;</code></pre></div></div></div><div class="p" id="_381">Breakdown of the first one:<div class="list"><ul id="_382"><li id="_383">40 0: <code>p_type</code> = <code>01 00 00 00</code> = <code>PT_LOAD</code>: this is a regular segment that will get loaded in memory.</li><li id="_384">40 4: <code>p_flags</code> = <code>05 00 00 00</code> = execute and read permissions. No write: we cannot modify the text segment. A classic way to do this in C is with string literals: <a href="https://stackoverflow.com/a/30662565/895245">stackoverflow.com/a/30662565/895245</a> This allows kernels to do certain optimizations, like sharing the segment amongst processes.</li><li id="_385"><div class="p" id="_386">40 8: <code>p_offset</code> = 8x <code>00</code> TODO: what is this? Standard says:</div><div><blockquote id="_387">This member gives the offset from the beginning of the file at which the first byte of the segment resides.</blockquote></div><div class="p" id="_388">But it looks like offsets from the beginning of segments, not file?</div></li><li id="_389">50 0: <code>p_vaddr</code> = <code>00 00 40 00 00 00 00 00</code>: initial virtual memory address to load this segment to</li><li id="_390">50 8: <code>p_paddr</code> = <code>00 00 40 00 00 00 00 00</code>: unspecified effect. Intended for systems in which physical addressing matters. TODO example?</li><li id="_391"><div class="p" id="_392">60 0: <code>p_filesz</code> = <code>d7 00 00 00 00 00 00 00</code>: size that the segment occupies in memory. If smaller than <code>p_memsz</code>, the OS fills it with zeroes to fit when loading the program. This is how BSS data is implemented to save space on executable files. i368 ABI says on <code>PT_LOAD</code>:</div><div><blockquote id="_393">The bytes from the file are mapped to the beginning of the memory segment. If the segment’s memory size (p_memsz) is larger than the file size (p_filesz), the ‘‘extra’’ bytes are defined to hold the value 0 and to follow the segment’s initialized area. The file size may not be larger than the memory size.</blockquote></div></li></ul></div></div><div class="list"><ul id="_394"><li id="_395">60 8: <code>p_memsz</code> = <code>d7 00 00 00 00 00 00 00</code>: size that the segment occupies in memory</li><li id="_396"><div class="p" id="_397">70 0: <code>p_align</code> = <code>00 00 20 00 00 00 00 00</code>: 0 or 1 mean no alignment required. TODO why is this required? Why not just use <code>p_addr</code> directly, and get that right? Docs also say:</div><div><blockquote id="_398">p_vaddr should equal p_offset, modulo p_align</blockquote></div></li></ul></div><div class="p" id="_399">The second segment (<code>.data</code>) is analogous. TODO: why use offset <code>0x0000d8</code> and address <code>0x00000000006000d8</code>? Why not just use <code>0</code> and <code>0x00000000006000d8</code>?</div><div class="p" id="_400">Then the:<div class="code" id="_401"><div><pre><code> Section to Segment mapping:</code></pre></div></div>section of the <code>readelf</code> tells us that:<div class="list"><ul id="_402"><li id="_403">0 is the <code>.text</code> segment. Aha, so this is why it is executable, and not writable</li><li id="_404">1 is the <code>.data</code> segment.</li></ul></div></div><div class="p" id="_405">TODO where does this information come from? <a href="https://stackoverflow.com/questions/23018496/section-to-segment-mapping-in-elf-files">stackoverflow.com/questions/23018496/section-to-segment-mapping-in-elf-files</a></div><div class="h" id="backlinks"><div class="notnav"><h2><a href="elf-hello-world/backlinks"><span class="number">12. </span>Backlinks</a></h2><span class="hover-meta"> <a class="split" href="elf-hello-world/backlinks"></a><span class="metrics"><span class="wcntr"> Words: 5</span></span></span></div><nav class="h-nav h-nav-toplevel"><div class="nav"><a href="" class="u"> ELF Hello World Tutorial</a><a href="#_toc/backlinks" class="toc"></a><a href="https://ourbigbook.com/cirosantilli/elf-hello-world/backlinks"><img src="_obb/logo.svg" class="logo" alt=""> OurBigBook.com</a></div></nav></div><div class="p" id="_406">News aggregators:<div class="list"><ul id="_407"><li id="_408">2017-05: <a href="https://news.ycombinator.com/item?id=14359159">news.ycombinator.com/item?id=14359159</a> <a href="https://web.archive.org/web/20170517174951/https://news.ycombinator.com/news">web.archive.org/web/20170517174951/https://news.ycombinator.com/news</a></li></ul></div></div><div class="p" id="_409">Personal websites:<div class="list"><ul id="_410"><li id="_411"><a href="https://www.etherington.xyz/elfguide">www.etherington.xyz/elfguide</a></li></ul></div></div><h2 id="_ancestors"><a href="#_ancestors"><span class="fa-solid-900 icon"></span> Ancestors <span class="meta">(9)</span></a></h2><div class="list"><ol><li><a href="systems-programming#executable-and-linkable-format">Executable and Linkable Format</a></li><li><a href="systems-programming#executable-file-format">Executable file format</a></li><li><a href="systems-programming">Systems programming</a></li><li><a href="software">Software</a></li><li><a href="computer">Computer</a></li><li><a href="technology#information-technology">Information technology</a></li><li><a href="technology#area-of-technology">Area of technology</a></li><li><a href="technology">Technology</a></li><li><a href="."><span title="Home" class="fa-solid-900 icon"></span> Home</a></li></ol></div><h2 id="_incoming-links"><a href="#_incoming-links"><span title="Incoming links" class="fa-solid-900 icon"></span> Incoming links <span class="meta">(2)</span></a></h2><div class="list"><ul><li><a href="articles">The best articles by Ciro Santilli</a></li><li><a href="systems-programming#executable-and-linkable-format">Executable and Linkable Format</a></li></ul></div>
</main>
<footer>
<div>Powered by <a href="https://docs.ourbigbook.com">OurBigBook</a></div>
<div>License: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> unless noted</div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io/issues">Suggestions and corrections</a></div>
<div><a href="contact">Contact Ciro Santilli</a></div>
<div><a href="_dir">Website source code</a></div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io">Website source code on GitHub</a></div>
<div><a href="_file/elf-hello-world.bigb">Source code for this page: elf-hello-world.bigb</a></div>
<div><a href="https://github.com/cirosantilli/cirosantilli.github.io/blob/f7dac29d5224c15015eee520ccee15a3adb07b98/elf-hello-world.bigb">Source code for this page on GitHub</a></div>
<div>Cite with: <a href="https://zenodo.org/badge/latestdoi/16453261">this DOI</a></div>
<div><img src="https://raw.githubusercontent.com/cirosantilli/media/master/ID_photo_of_Ciro_Santilli_taken_in_2013_left_eye_200_100.jpg" loading="lazy" alt="ID photo of Ciro Santilli taken in 2013 right eye"></div>
</footer>
<script>
window.ourbigbook_split_headers = true;
window.ourbigbook_html_x_extension = false;
window.ourbigbook_redirect_prefix = "elf-hello-world/";
</script>
<script src="_obb/dist/ourbigbook_runtime.js"></script><script>ourbigbook_runtime.ourbigbook_runtime()</script><script src="_raw/main.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-47867706-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DEE2HEJW9X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DEE2HEJW9X');
</script>
<script src="https://giscus.app/client.js"
        data-repo="cirosantilli/cirosantilli.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNjQ1MzI2MQ=="
        data-category="giscus"
        data-category-id="DIC_kwDOAPsOjc4CZ6zZ"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark_high_contrast"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</body>
</html>
